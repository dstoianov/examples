<html><body>
<a name="top"></a>
<h1>Elemental <em>Se</em>lenium</h1>
<hr color="purple">
<h2>Tips Content</h2>
1. How To Upload a File <a href="#tips_1">read</a><br>
2. How To Download a File <a href="#tips_2">read</a><br>
3. How To Work with Frames <a href="#tips_3">read</a><br>
4. How To Work with Multiple Windows <a href="#tips_4">read</a><br>
5. How To Select from a Dropdown List <a href="#tips_5">read</a><br>
6. Exporting from Selenium IDE <a href="#tips_6">read</a><br>
7. Using a Page Object <a href="#tips_7">read</a><br>
8. How To Download a File Without a Browser <a href="#tips_8">read</a><br>
9. Using a Base Page Object <a href="#tips_9">read</a><br>
10. Retrying Test Actions <a href="#tips_10">read</a><br>
11. Building an Interactive Prompt <a href="#tips_11">read</a><br>
12. How To Opt Out Of A/B Tests <a href="#tips_12">read</a><br>
13. How To Access Basic Auth <a href="#tips_13">read</a><br>
14. Interactive Prompts Revisited <a href="#tips_14">read</a><br>
15. How To Download Secure Files <a href="#tips_15">read</a><br>
16. How To Take A Screenshot On Failure <a href="#tips_16">read</a><br>
17. How To Test HTTP Status Codes <a href="#tips_17">read</a><br>
18. Figuring Out What To Test <a href="#tips_18">read</a><br>
19. How To Create a Data Driven Test <a href="#tips_19">read</a><br>
20. How To Chat with the Selenium Community <a href="#tips_20">read</a><br>
21. How To Pick a Programming Language <a href="#tips_21">read</a><br>
22. Choosing a Locator Strategy <a href="#tips_22">read</a><br>
23. How To Test Dynamic Pages <a href="#tips_23">read</a><br>
24. Fast and Reliable Test Setup with REST Ap Is <a href="#tips_24">read</a><br>
25. How To Work with Tables <a href="#tips_25">read</a><br>
26. How To Run Your Tests In the Cloud <a href="#tips_26">read</a><br>
27. How To Speed Up Your Tests with Parallelization <a href="#tips_27">read</a><br>
28. How To Upgrade from Selenium RC To Web Driver <a href="#tips_28">read</a><br>
29. How To Run Your Tests Locally Against Chrome <a href="#tips_29">read</a><br>
30. How To Test Your Mobile App <a href="#tips_30">read</a><br>
31. How To Access Previous Tips <a href="#tips_31">read</a><br>
32. Css Vs. X Path <a href="#tips_32">read</a><br>
33. Css Vs. X Path, Under a Microscope <a href="#tips_33">read</a><br>
34. Css Vs. X Path, Under a Microscope (Part 2) <a href="#tips_34">read</a><br>
35. How To Verify Your Locators Without Selenium <a href="#tips_35">read</a><br>
36. Available Selenium Resources <a href="#tips_36">read</a><br>
37. How To Structure Your Test Code <a href="#tips_37">read</a><br>
38. How To Run Your Tests Headlessly with Xvfb <a href="#tips_38">read</a><br>
39. How To Test HTML5 Drag and Drop <a href="#tips_39">read</a><br>
40. How To Test For Disabled Elements <a href="#tips_40">read</a><br>
41. How To Run A Test On Multiple Browsers <a href="#tips_41">read</a><br>
42. How To Run A Test On Multiple Browsers, In Parallel <a href="#tips_42">read</a><br>
43. How To Test Forgot Password <a href="#tips_43">read</a><br>
44. How To Handle Exceptions <a href="#tips_44">read</a><br>
45. How To Test Checkboxes <a href="#tips_45">read</a><br>
46. How To Run Your Tests Headlessly with Ghost Driver <a href="#tips_46">read</a><br>
47. Explicit Vs Implicit Waits <a href="#tips_47">read</a><br>
48. How To Do Load Testing <a href="#tips_48">read</a><br>
49. How To Do Performance Testing <a href="#tips_49">read</a><br>
50. How To Work with Hovers <a href="#tips_50">read</a><br>
51. How To Work with Java Script Alerts <a href="#tips_51">read</a><br>
52. How To Use Selenium Grid <a href="#tips_52">read</a><br>
53. How To Add Growl Notifications To Your Tests <a href="#tips_53">read</a><br>
54. How To Access Selenium Logs In Real Time <a href="#tips_54">read</a><br>
55. How To Add A Wrapper To Your Selenium Tests <a href="#tips_55">read</a><br>
56. How To Automatically Retry Failed Tests <a href="#tips_56">read</a><br>
57. How To Prepare Your Tests For Continuous Integration <a href="#tips_57">read</a><br>
58. How To Slice and Dice Your Tests with Tags <a href="#tips_58">read</a><br>
59. How To Generate an HTML Test Report <a href="#tips_59">read</a><br>
60. How To Generate A List Of Tags from Your Tests <a href="#tips_60">read</a><br>
61. How To Press Keyboard Keys <a href="#tips_61">read</a><br>
62. An Introduction To Web Consistency Testing <a href="#tips_62">read</a><br>
63. How To Right Click <a href="#tips_63">read</a><br>
64. How To Simulate Slow Connections <a href="#tips_64">read</a><br>
65. How To Visually Verify Your Locators <a href="#tips_65">read</a><br>
66. How To Remove Third Party Resources <a href="#tips_66">read</a><br>
67. How To Test For Broken Images <a href="#tips_67">read</a><br>
68. How To Do Load Testing with J Meter and Selenium <a href="#tips_68">read</a><br>
69. How To Use Safari <a href="#tips_69">read</a><br>
70. How To Use Selenium Grid Reliably <a href="#tips_70">read</a><br>
<hr color="purple">
<a name ="tips_1"></a>
<h2>1. How To Upload a File <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/1-upload-a-file">http://elementalselenium.com/tips/1-upload-a-file</a></h2>
<h3>BEGINNER TESTING</h3>
<h4>#file #upload #file_upload</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Uploading a file is a common piece of functionality found on the web. But when trying to automate it you get prompted with a with a dialog box that is just out of reach for Selenium.</p>

<p>In these cases, people often look to a third-party tool to manipulate this window (e.g., <a href="http://www.toolsqa.com/selenium-webdriver/autoit-selenium-webdriver/">AutoIt</a>). While this can help solve your short-term need, it sets you up for failure later by chaining you to a specific platform (e.g., AutoIt only works on Windows) -- effectively limiting your ability to test this functionality on different browser/OS combinations.</p>

<h2>A Solution</h2>

<p>A work-around for this problem is to side-step the system dialog box experience entirely. We can do this by using Selenium to insert the path of the file we want to upload into the form, and then submit the form.</p>

<p>Let's step through an example.</p>

<h2>An Example</h2>

<p><strong>NOTE: You can see the application we are testing against <a href="http://the-internet.herokuapp.com/upload">here</a>.</strong></p>

<p>For our test script, we'll first need to include our requisite libraries (<code>selenium-webdriver</code> to drive the browser, and <code>rspec/expectations</code> for our assertion) and wire-up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: upload.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now we're ready to write our file upload test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="n">filename</span> <span class="o">=</span> <span class="s1">'some-file.txt'</span>
  <span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/upload'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'file-upload'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">file</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'file-submit'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">uploaded_file</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'uploaded-files'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">uploaded_file</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="n">filename</span>
<span class="k">end</span>
</pre></div>

<p>This test assumes that the file is living in the same directory as the test script. After specifying the <code>filename</code>, we then want to get the full path to the file, which we're doing with <code>File.join(Dir.pwd, filename)</code>.</p>

<p>Next we visit the page with the upload form and upload the file. After the file is uploaded the page displays the filename that it just processed. We use this to perform our assertion (making sure the uploaded file is what we expect).</p>

<h2>Expected Behavior</h2>

<p>If we save this file and run it (<code>ruby upload.rb</code> from the command-line) here is what you would see:</p>

<ul>
<li>Visit the upload form page</li>
<li>Find the element in the upload form that stores the path of the file to be uploaded</li>
<li>Inject the file path into the form element</li>
<li>Find the form submit button and click it</li>
<li>Grab the filename text from the page after it processes the upload</li>
<li>Assert that the filename text matches the filename we provided</li>
</ul>

<h2>Outro</h2>

<p>This approach will work across all browsers. But if you want to use it with a remote instance (e.g., a Selenium Grid or Sauce Labs), then you'll want to have a look at <a href="https://selenium.googlecode.com/svn/trunk/docs/api/rb/Selenium/WebDriver/DriverExtensions/UploadsFiles.html">the <code>file_detector</code> driver extension</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_2"></a>
<h2>2. How To Download a File <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/2-download-a-file">http://elementalselenium.com/tips/2-download-a-file</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#file #download #file_download</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Just like with <a href="http://elementalselenium.com/tips/1-upload-a-file">uploading files</a>, we hit the same issue with downloading them. A dialog box just out of Selenium's reach.</p>

<h2>A Solution</h2>

<p>By specifying some configuration parameters when loading Selenium we can easily side-step the dialog box. This is done by instructing the browser to download files to a specific location without prompting.</p>

<p>After the file is downloaded we can perform some simple checks to make sure the file is what we expect.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>We start off by pulling in our requisite libraries (<code>selenium-webdriver</code> to drive the browser, <code>rspec/expectations</code> and <code>RSpec::Matchers</code> for assertions, <code>uuid</code> to help create a uniquely named temp directory, and <code>fileutils</code> to create and destroy temp directories).</p>
<div class="highlight"><pre><span class="c1"># filename: download.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>
<span class="nb">require</span> <span class="s1">'uuid'</span>
<span class="nb">require</span> <span class="s1">'fileutils'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@download_dir</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="p">,</span> <span class="no">UUID</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">generate</span><span class="p">)</span>
  <span class="no">FileUtils</span><span class="o">.</span><span class="n">mkdir_p</span> <span class="vi">@download_dir</span>

  <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.download.dir'</span><span class="o">]</span> <span class="o">=</span> <span class="vi">@download_dir</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.download.folderList'</span><span class="o">]</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'browser.helperApps.neverAsk.saveToDisk'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'images/jpeg, application/pdf'</span>
  <span class="n">profile</span><span class="o">[</span><span class="s1">'pdfjs.disabled'</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">profile</span>
<span class="k">end</span>
</pre></div>

<p>The <code>setup</code> method is where the magic is happening in this example. In it we're creating a uniquely named temp directory and storing the absolute path in an instance variable that we'll use throughout this file.</p>

<p>We're also configuring a browser profile object (for Firefox in this case) and plying it with configuration parameters. Here's a breakdown of each of them:</p>

<ul>
<li><code>browser.download.folderList</code> takes a number. It tells Firefox which download directory to use. <code>2</code> tells it to use a custom download path, wheras <code>1</code> would use the browser's default path, and <code>0</code> would place them on the Desktop.</li>
<li><code>browser.download.dir</code> accepts a string. This is how we set the custom download path. It needs to be an absolute path.</li>
<li><code>browser.helperApps.neverAsk.saveToDisk</code> tells Firefox when not to prompt for a file download. It accepts a string of <a href="http://en.wikipedia.org/wiki/Internet_media_type">the file's MIME type</a>. If you want to specify more than one, you do it with a comma-separated string.</li>
<li><code>pdfjs.disabled</code> is for when downloading PDFs. This overrides the sensible default in Firefox that previews PDFs in the browser. It accepts a boolean.</li>
</ul>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="no">FileUtils</span><span class="o">.</span><span class="n">rm_rf</span> <span class="vi">@download_dir</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>In <code>teardown</code> we make sure to clean up the temp directory after closing the browser. Other than that, it's business as usual.</p>

<p>Now onto the test itself.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/download'</span>
  <span class="n">download_link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'.example a'</span><span class="p">)</span>
  <span class="n">download_link</span><span class="o">.</span><span class="n">click</span>

  <span class="n">files</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="vi">@download_dir</span><span class="si">}</span><span class="s2">/**"</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">files</span><span class="o">.</span><span class="n">empty?</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="kp">false</span>

  <span class="n">sorted_files</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span> <span class="no">File</span><span class="o">.</span><span class="n">mtime</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">expect</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">sorted_files</span><span class="o">.</span><span class="n">last</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="k">end</span>
</pre></div>

<p>After loading the page we find the first download link and click it. Alternatively, we could have clicked the second link.</p>
<div class="highlight"><pre><span class="n">download_link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'.example a'</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</pre></div>

<p>The click triggers an automatic download to the temp directory specified and created in <code>setup</code>. After that, we perform some rudimentary checks to make sure the directory isn't empty and that the most recently downloaded file has a file size greater than <code>0</code>.</p>

<h2>Expected Behavior</h2>

<p>If you save this file and run it (e.g., <code>ruby download.rb</code> from the command-line) here is what would occur:</p>

<ul>
<li>Create temp directory with a unique ID</li>
<li>Load the browser</li>
<li>Visit the page</li>
<li>Find and click one of the download links on the page</li>
<li>Automatically download the file to the specified location on disk without prompting</li>
<li>Check that a file was downloaded and that it's not empty</li>
<li>Close the browser</li>
<li>Delete the temp directory</li>
</ul>

<h2>Outro</h2>

<p>A similar approach can be applied to other browsers with varying configurations, but really, <a href="http://ardesco.lazerycode.com/index.php/2012/07/how-to-download-files-with-selenium-and-why-you-shouldnt/">downloading files this way is not sustainable or advised</a>.</p>

<p>Stay tuned to a future tip where I'll cover a more reliable, faster, and scalable browser agnostic approach to downloading files.</p>

<p>Until then, Happy Testing!</p><br>
<hr>
<a name ="tips_3"></a>
<h2>3. How To Work with Frames <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/3-work-with-frames">http://elementalselenium.com/tips/3-work-with-frames</a></h2>
<h3>BEGINNER TESTING</h3>
<h4>#frames</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>On occasion you'll run into a relic of the front-end world -- frames. And when writing a test against them, you can easily get tripped if you're not paying attention.</p>

<h2>A Solution</h2>

<p>Rather than gnash your teeth when authoring your tests, you can easily work with the elements in a frame by telling Selenium to switch to that frame first. Then the rest of your test is business as usual.</p>

<p>Let's dig in with some examples.</p>

<h2>An Example</h2>

<p>We'll first need to pull in our requisite libraries (<code>selenium-webdriver</code> to drive the browser, and <code>rspec/expecations</code> &amp; <code>RSpec::Matchers</code> to perform our assertions) and wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now onto our test. In it, we'll walk through an example of nested frames. You can see the page we are testing <a href="http://the-internet.herokuapp.com/nested_frames">here</a>.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/nested_frames'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="s1">'frame-top'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="s1">'frame-middle'</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'content'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'MIDDLE'</span>
<span class="k">end</span>
</pre></div>

<p>With Selenium's <a href="https://selenium.googlecode.com/svn/trunk/docs/api/rb/Selenium/WebDriver/TargetLocator.html#frame-instance_method"><code>.switch_to.frame</code></a> method we can easily switch to the frame we want. It accepts an ID or name attribute. But in order to get the text of the middle frame (e.g., a frame nested within another frame), we first need to switch to the parent frame, and then switch to the child frame (e.g., the middle frame).</p>

<p>Once we've done that, we're able to find the element we need, grab it's text, and assert that it's what we expect.</p>

<p>While this example helps illustrate the point of frame switching, it's not very practical. So let's step through one more example.</p>

<h2>Another Example</h2>

<p>Here is a more likely example you'll run into -- working with a WYSIWYG (TinyMCE) Editor. You can see the page we're testing <a href="http://the-internet.herokuapp.com/tinymce">here</a>.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tinymce'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">frame</span><span class="p">(</span><span class="s1">'mce_0_ifr'</span><span class="p">)</span>
  <span class="n">editor</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'tinymce'</span><span class="p">)</span>
  <span class="n">before_text</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">text</span>
  <span class="n">editor</span><span class="o">.</span><span class="n">clear</span>
  <span class="n">editor</span><span class="o">.</span><span class="n">send_keys</span> <span class="s1">'Hello World!'</span>
  <span class="n">after_text</span> <span class="o">=</span> <span class="n">editor</span><span class="o">.</span><span class="n">text</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">after_text</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">eql</span> <span class="n">before_text</span>
<span class="k">end</span>
</pre></div>

<p>Once the page loads we switch into the frame that contains TinyMCE. After that we:</p>

<ul>
<li>grab the original text and store it</li>
<li>clear and input new text</li>
<li>grab the new text value</li>
<li>assert that the original and altered texts are not the same</li>
</ul>

<p>Keep in mind that if we need to access a part of the page outside of the frame we are currently in we'll need to switch to it. Thankfully Selenium has another method that enables us to quickly jump back to the top level -- <a href="https://selenium.googlecode.com/svn/trunk/docs/api/rb/Selenium/WebDriver/TargetLocator.html#default_content-instance_method"><code>switch_to.default_content</code></a>.</p>

<p>Here is what it looks like, along with an assertion to confirm that it works correctly on our example app.</p>
<div class="highlight"><pre>  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">default_content</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">be_empty</span>
</pre></div>

<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Switch to a specified frame</li>
<li>Find and take an action against an element in the frame specified</li>
<li>Switch to another frame or the default content</li>
<li>Assert that the desired outcome has occurred</li>
</ul>

<h2>Outro</h2>

<p>Now you're ready to handily defeat frames when they cross your path.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_4"></a>
<h2>4. How To Work with Multiple Windows <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/4-work-with-multiple-windows">http://elementalselenium.com/tips/4-work-with-multiple-windows</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#windows</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Occasionally you'll run into a link or action in the application you're testing that will open a new window. In order to work with them (e.g., the new and originating windows), you need to switch between them.</p>

<p>On the face of it, this is a pretty straightforward thing. But lurking within it is a small gotcha to watch out for.</p>

<p>Let's step through a couple of examples to demonstrate.</p>

<h2>An Example</h2>

<p>First, let's wire up our simple test harness by pulling the requisite libraries and adding some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: new_window.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now let's write a test that exercises new window functionality from an application.</p>
<div class="highlight"><pre><span class="c1"># filename: new_window.rb</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/windows'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'.example a'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">window_handles</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">eql</span> <span class="s1">'New Window'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">window_handles</span><span class="o">.</span><span class="n">last</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'New Window'</span>
<span class="k">end</span>
</pre></div>

<p>After loading the page, we click the link which spawns a new window. We then grab the window handles (a.k.a. unique identifier strings which represent each open browser window) and switch between them based on their order (assuming that the first one is the originating window, and that the last one is the new window). We round this test out by performing a simple check against the title of the page to make sure Selenium is focused on the correct window.</p>

<p><strong>While this may seem like a good approach, it's going to bite you later. That's because the order of the window handles is not consistent across all browsers. Some return in the order opened, others alphabetically.</strong></p>

<p>Here's a more effective approach. One that will work across all browsers.</p>

<h2>A Better Example</h2>
<div class="highlight"><pre><span class="c1"># filename: new_window.rb</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/windows'</span>

  <span class="n">first_window</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">window_handle</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'.example a'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="n">all_windows</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">window_handles</span>
  <span class="n">new_window</span> <span class="o">=</span> <span class="n">all_windows</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">this_window</span><span class="o">|</span> <span class="n">this_window</span> <span class="o">!=</span> <span class="n">first_window</span> <span class="p">}</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">first_window</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">eql</span> <span class="s1">'New Window'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">new_window</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'New Window'</span>
<span class="k">end</span>
</pre></div>

<p>After loading the page we store the window handle (e.g., <code>first_window</code>) and then proceed with clicking the new window link.</p>

<p>We then grab all window handles and search through them to look for the new window handle -- looking for the handle that doesn't match the first one. We store the result (e.g., <code>second_window</code>) and switch between the windows, checking the page title to make sure the correct window is in focus.</p>

<p>This approach will work cross-browser, and is extendible in the event that you need to work with more than two windows at a time.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Get the window handle for the current window</li>
<li>Take an action that opens a new window</li>
<li>Find the window handle for the new window</li>
<li>Switch between the windows as needed</li>
</ul>

<h2>Outro</h2>

<p>A big thanks to <a href="https://twitter.com/jimevansmusic">Jim Evans</a> for providing the info for this tip!</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_5"></a>
<h2>5. How To Select from a Dropdown List <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/5-select-from-a-dropdown">http://elementalselenium.com/tips/5-select-from-a-dropdown</a></h2>
<h3>BEGINNER TESTING</h3>
<h4>#dropdown #forms</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Selecting from a dropdown list <em>seems</em> like one of those simple things. Just grab the list by it's element and select an item within it based on the text you want.</p>

<p>While it sounds pretty straightforward, there is a bit more finesse to it.</p>

<p>Let's take a look at a couple of different approaches.</p>

<h2>An Example</h2>

<p>First let's load pull in our requisite libraries and wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: dropdown.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now to wire up our test.</p>
<div class="highlight"><pre><span class="c1"># filename: dropdown.rb</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dropdown'</span>

  <span class="n">dropdown_list</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'dropdown'</span><span class="p">)</span>
  <span class="n">options</span> <span class="o">=</span> <span class="n">dropdown_list</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">tag_name</span><span class="p">:</span> <span class="s1">'option'</span><span class="p">)</span>
  <span class="n">options</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">option</span><span class="o">|</span> <span class="n">option</span><span class="o">.</span><span class="n">click</span> <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">'Option 1'</span> <span class="p">}</span>

  <span class="n">selected_option</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">option</span><span class="o">|</span> <span class="n">option</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">selected?</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">selected_option</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'Option 1'</span>
<span class="k">end</span>
</pre></div>

<p>After visiting <a href="http://the-internet.herokuapp.com/dropdown">the example application</a> we find the dropdown list by its ID and store it in a variable. Then it's a matter of pulling out each option (a.k.a. the clickable bits) in the dropdown element with <code>find_elements</code>.</p>

<p>Grabbing the list's options returns a collection that we then iterate over. When the text matches what we want, the test will click on it.</p>

<p>And to polish things off, we check to see that our selection was made correctly by reiterating over the dropdown options collection, getting the text of the item that was selected, returning its text, storing it in a variable, and making an assertion against it.</p>

<p>While this works, there is a simpler, built-in way to do this with Selenium. Let's give that a go.</p>

<h2>Another Example</h2>
<div class="highlight"><pre><span class="c1"># filename: dropdown.rb</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dropdown'</span>

  <span class="n">dropdown</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'dropdown'</span><span class="p">)</span>
  <span class="n">select_list</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Support</span><span class="o">::</span><span class="no">Select</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">dropdown</span><span class="p">)</span>
  <span class="n">select_list</span><span class="o">.</span><span class="n">select_by</span><span class="p">(</span><span class="ss">:text</span><span class="p">,</span> <span class="s1">'Option 1'</span><span class="p">)</span>

  <span class="n">selected_option</span> <span class="o">=</span> <span class="n">select_list</span><span class="o">.</span><span class="n">selected_options</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="n">text</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">selected_option</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'Option 1'</span>
<span class="k">end</span>
</pre></div>

<p>Similar to the first example, we are finding the dropdown list by ID. But instead of iterating over it and clicking based on a conditional, we are leveraging a built-in helper function of Selenium, <a href="http://selenium.googlecode.com/svn-history/r15117/trunk/docs/api/rb/Selenium/WebDriver/Support/Select.html"><code>Select</code></a>, and it's <a href="http://selenium.googlecode.com/svn-history/r15117/trunk/docs/api/rb/Selenium/WebDriver/Support/Select.html#select_by-instance_method"><code>select_by</code></a> method to choose the item we want.</p>

<p>We then ask the <code>select_list</code> what option was selected by using the <a href="http://selenium.googlecode.com/svn-history/r15117/trunk/docs/api/rb/Selenium/WebDriver/Support/Select.html#selected_options-instance_method"><code>selected_options</code></a> method. This returns an array of Selenium Elements (which in this case is an array of just one element). So we need to reference the first element by it's index (e.g., <code>[0]</code>), ask for it's text, and store it in a variable (e.g., <code>selected_option</code>).</p>

<p>Then we perform our assertion against this variable (just like in the previous example).</p>

<p><strong>NOTE: In addition to selecting by text, you can also select by value.</strong></p>
<div class="highlight"><pre>  <span class="n">select_list</span><span class="o">.</span><span class="n">select_by</span><span class="p">(</span><span class="ss">:value</span><span class="p">,</span> <span class="s1">'1'</span><span class="p">)</span>
</pre></div>

<h2>Expected Behavior</h2>

<p>If you save this file with either of these examples and run it (e.g., <code>ruby dropdown.rb</code> from the command-line) here is what will happen:</p>

<ul>
<li>Open the browser</li>
<li>Visit the example application</li>
<li>Find the dropdown list</li>
<li>Select the requested item from the dropdown list</li>
<li>Assert that the selected option is the one you expect</li>
</ul>

<h2>Outro</h2>

<p>Hopefully this tip will help you breeze through selecting items from a dropdown list.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_6"></a>
<h2>6. Exporting from Selenium IDE <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/6-export-from-selenium-ide">http://elementalselenium.com/tips/6-export-from-selenium-ide</a></h2>
<h3>INTERMEDIATE TOOLS</h3>
<h4>#selenium_ide #exporting</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Selenium IDE is a useful tool if you're new to Selenium. While it enables you to quickly record and playback test cases that you can save and re-use later, it is not a good long-term solution for several reasons.</p>

<p>The biggest one being that its just not that fashionable. The Selenium Community advocates and helps support a much more reliable and robust approach. And the first step in getting there is to export your tests from Selenium IDE.</p>

<p>While it sounds simple, it's actually the start of a long journey.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>With a simple test case set up in Selenium IDE we're ready to get started.</p>

<p><img src="/img/se-ide-script.png" alt="Selenium IDE Script"></p>

<p>It does the following:
+ Loads Google
+ Searches 'element selenium tips'
+ Asserts that the page contains the text we expect</p>

<p>Exporting a test is just a couple of clicks away. The best option given our preference (Ruby and WebDriver) is to use the 'Ruby / RSpec / WebDriver' option from the menu.</p>

<p><img src="/img/se-ide-script-export.png" alt="Exporting Selenium IDE Script"></p>

<p>After saving this Ruby file to somewhere on disk we open it up and behold the massive amount of code that was generated.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s2">"selenium-webdriver"</span>
<span class="nb">require</span> <span class="s2">"rspec"</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Expectations</span>

<span class="n">describe</span> <span class="s2">"SeIdeExampleExported"</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
    <span class="vi">@base_url</span> <span class="o">=</span> <span class="s2">"https://www.google.com/"</span>
    <span class="vi">@accept_next_alert</span> <span class="o">=</span> <span class="kp">true</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">timeouts</span><span class="o">.</span><span class="n">implicit_wait</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="vi">@verification_errors</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
    <span class="vi">@verification_errors</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="o">[]</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s2">"test_se_ide_example_exported"</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="vi">@base_url</span> <span class="o">+</span> <span class="s2">"/"</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="s2">"gbqfq"</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="s2">"gbqfq"</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="s2">"elemental selenium tips"</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="s2">"gbqfb"</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
    <span class="o">!</span><span class="mi">60</span><span class="o">.</span><span class="n">times</span><span class="p">{</span> <span class="k">break</span> <span class="k">if</span> <span class="p">(</span><span class="n">element_present?</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="s2">"#rso .g"</span><span class="p">)</span> <span class="k">rescue</span> <span class="kp">false</span><span class="p">);</span> <span class="nb">sleep</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="c1"># Warning: assertTextPresent may require manual changes</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="s2">"BODY"</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/^[\s\S]*Receive a Free, Weekly Tip[\s\S]*$/</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">element_present?</span><span class="p">(</span><span class="n">how</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">how</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span>
    <span class="kp">true</span>
  <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">NoSuchElementError</span>
    <span class="kp">false</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">alert_present?</span><span class="p">()</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span>
    <span class="kp">true</span>
  <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">NoAlertPresentError</span>
    <span class="kp">false</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span><span class="o">&amp;</span><span class="n">blk</span><span class="p">)</span>
    <span class="k">yield</span>
  <span class="k">rescue</span> <span class="no">ExpectationNotMetError</span> <span class="o">=&gt;</span> <span class="n">ex</span>
    <span class="vi">@verification_errors</span> <span class="o">&lt;&lt;</span> <span class="n">ex</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">close_alert_and_get_its_text</span><span class="p">(</span><span class="n">how</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span>
    <span class="n">alert</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="p">()</span><span class="o">.</span><span class="n">alert</span><span class="p">()</span>
    <span class="n">alert_text</span> <span class="o">=</span> <span class="n">alert</span><span class="o">.</span><span class="n">text</span>
    <span class="k">if</span> <span class="p">(</span><span class="vi">@accept_next_alert</span><span class="p">)</span> <span class="k">then</span>
      <span class="n">alert</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
    <span class="k">else</span>
      <span class="n">alert</span><span class="o">.</span><span class="n">dismiss</span><span class="p">()</span>
    <span class="k">end</span>
    <span class="n">alert_text</span>
  <span class="k">ensure</span>
    <span class="vi">@accept_next_alert</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>This code will work if you run it, but a lot of it is not being used in this example. And there are some things going on that are not very efficient or effective. So we're going to gut most of it, pull out what we want, rework a couple of bits, and wrap it in a leaner shell.</p>

<h2>A Better Example</h2>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="vi">@base_url</span> <span class="o">=</span> <span class="s1">'http://www.google.com'</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>First we load the gems we want to use and wire up our setup, teardown, and run actions. We've kept the base_url instance variable from the exported example to use in our test.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">displayed?</span><span class="p">(</span><span class="n">how</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">how</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
  <span class="kp">true</span>
  <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">NoSuchElementError</span>
    <span class="kp">false</span>
<span class="k">end</span>

<span class="n">run</span> <span class="p">{</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="vi">@base_url</span> <span class="o">+</span> <span class="s2">"/"</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="s2">"gbqfq"</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="s2">"gbqfq"</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="s2">"elemental selenium tips"</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="s2">"gbqfb"</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
    <span class="n">wait_for</span> <span class="p">{</span> <span class="n">displayed?</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="s1">'#rso .g'</span><span class="p">)</span> <span class="p">}</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="s1">'#rso .g'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/Receive a Free, Weekly Tip/</span>
<span class="p">}</span>
</pre></div>

<p>We've defined a couple of new methods. The first one is <code>wait_for</code>. It takes an optional argument of time (in seconds). This is used to wait a certain amount of time (which can be set on each use) for a specific action to occur.</p>

<p>This is what's known as an <strong>explicit wait</strong> and it is a far more effective way to wait for elements than the approach taken in the exported example (e.g. an implicit wait).</p>

<p>In addition to this method we have also added one called <code>displayed?</code>. This is the same thing as <code>element_present?</code> but modified to make sure that an element is visible within the browser. This distinction is important since an element can be present without it being visible.</p>

<p>And in our run action most of the Selenium actions should look familiar from the exported example -- with the big differences being the use of <code>wait_for</code> and <code>displayed?</code>. Also, instead of searching the entire body for the text we want, we are now scoping in on the first search result, getting its text, and using a simpler regular expression match for comparison.</p>

<h2>Expected Outcome</h2>

<ul>
<li>Load Google</li>
<li>Search for <em>elemental selenium tips</em></li>
<li>Wait for the first search result to render</li>
<li>Grab the text from it</li>
<li>Assert that the text we want is within it</li>
</ul>

<h2>Outro</h2>

<p>If you see a lot of Selenium IDE exporting in your future then I recommend adding your own formatter to Selenium IDE and using that to instead of the built in ones. This can be done from the Options menu within Selenium IDE (Click Options &gt; Options, then select the Formats tab, and click Add). It should be pretty straight-forward to wire one up and customize it after you look at the other formatters as examples.</p>

<p>But ideally, with enough practice and proper abstractions in place, you should be able to rewrite your scripts quickly without the need to export from the IDE. Stay tuned for future tips where I demonstrate how to accomplish this.</p>

<p>Until then, Happy Testing!</p><br>
<hr>
<a name ="tips_7"></a>
<h2>7. Using a Page Object <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/7-use-a-page-object">http://elementalselenium.com/tips/7-use-a-page-object</a></h2>
<h3>INTERMEDIATE PATTERNS</h3>
<h4>#page_object #abstraction</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>One of the biggest challenges with Selenium tests is that they can be brittle and challenging to maintain over time. This is largely due to the fact that things in the app you're testing change, breaking your tests.</p>

<p>But the reality of a software project is that change is a constant. So we need to account for this reality somehow in our test code in order to be successful.</p>

<h2>A Solution</h2>

<p>Enter Page Objects.</p>

<p>Rather than write your test code directly against your app, you can model the behavior of your application into simple objects -- and write your tests against them instead. That way when your app changes and your tests break, you only have to update your test code in one place to fix it.</p>

<p>And with this approach, we not only get the benefit of controlled chaos, we also get the benefit of reusable behavior.</p>

<h2>An Example</h2>

<p>In this example we are going to take the following example code from a previous tip (<a href="http://elemental-selenium.com/tips/6-export-from-selenium-ide">Exporting from Selenium IDE</a>) and upgrade it with the use of a Page Object.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="vi">@base_url</span> <span class="o">=</span> <span class="s1">'http://www.google.com'</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">displayed?</span><span class="p">(</span><span class="n">how</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">how</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
  <span class="kp">true</span>
  <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">NoSuchElementError</span>
    <span class="kp">false</span>
<span class="k">end</span>

<span class="n">run</span> <span class="p">{</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="vi">@base_url</span> <span class="o">+</span> <span class="s2">"/"</span><span class="p">)</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="s2">"gbqfq"</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="s2">"gbqfq"</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="s2">"elemental selenium tips"</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:id</span><span class="p">,</span> <span class="s2">"gbqfb"</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
    <span class="n">wait_for</span> <span class="p">{</span> <span class="n">displayed?</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="s1">'#rso .g'</span><span class="p">)</span> <span class="p">}</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="s1">'#rso .g'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/Receive a Free, Weekly Tip/</span>
<span class="p">}</span>
</pre></div>

<p>The first order of business is pretty simple. We keep our setup, teardown, and run actions mostly the same. But we change the base_url from an instance variable to an environment variable. Doing this will enable us to access it from anywhere in our test suite.</p>

<p>While the usage of environment variables can be a slippery slope, this is an ideal candidate for it since it effects the overall behavior of the suite.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://www.google.com'</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Next we create a Page Object for Google Search by using a standard Ruby class and add some relevant bits to it.</p>

<p>At the top of it we pull out the CSS locators used in our test steps and put them into helpfully named constants to use instead. And instead of using the two part 'how', 'what' approach, we are using a hash to store the locator type and its value.</p>

<p>Next we use attr_reader to create a place to store the Selenium WebDriver instance for use throughout the class.</p>

<p>The class expects an argument (e.g. the Selenium WebDriver instance) which is received through the initialize method. Inside the initialize method we take care of passing the Selenium object into the attr_reader object along with visiting the page and verifying that we are in the correct place. All of these things will execute in order when this class is instantiated.</p>

<p>We then break out each of the test steps into methods that execute the behavior specific to the page while also swapping out the hard-coded CSS locators for our new CSS locator constant variables.</p>

<p>At the bottom of the class we have private helper methods. These methods aren't necessarily specific to the page this class represents, but they are useful for it to function. So we want to access them within the class, but make it so they're not available outside of the class. Using the private classification gets us this behavior nicely.</p>

<p>And lastly, we update the <code>displayed?</code> private method to take a single argument for a 'locator' object (e.g. one of our CSS locator constant variables).</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">GoogleSearch</span>

  <span class="no">SEARCH_BOX</span>        <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'gbqfq'</span>     <span class="p">}</span>
  <span class="no">SEARCH_BOX_SUBMIT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'gbqfb'</span>     <span class="p">}</span>
  <span class="no">TOP_SEARCH_RESULT</span> <span class="o">=</span> <span class="p">{</span> <span class="n">css</span><span class="p">:</span> <span class="s1">'#rso .g'</span>  <span class="p">}</span>

  <span class="kp">attr_reader</span> <span class="ss">:driver</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="n">driver</span>
    <span class="n">visit</span>
    <span class="n">verify_page</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">visit</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">search_term</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">SEARCH_BOX</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">SEARCH_BOX</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">search_term</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">SEARCH_BOX_SUBMIT</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">search_result_present?</span><span class="p">(</span><span class="n">search_result</span><span class="p">)</span>
    <span class="n">wait_for</span> <span class="p">{</span> <span class="n">displayed?</span><span class="p">(</span><span class="no">TOP_SEARCH_RESULT</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">TOP_SEARCH_RESULT</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">include?</span> <span class="n">search_result</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">verify_page</span>
      <span class="n">driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'Google'</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
      <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">displayed?</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
      <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
      <span class="kp">true</span>
      <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">NoSuchElementError</span>
        <span class="kp">false</span>
    <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>With our new Page Object in hand, our run action cleans up considerably. Making it more succinct and readable.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="n">google</span> <span class="o">=</span> <span class="no">GoogleSearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="p">)</span>
  <span class="n">google</span><span class="o">.</span><span class="n">search_for</span> <span class="s1">'elemental selenium tips'</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">search_result_present?</span> <span class="s1">'Receive a Free, Weekly Tip'</span>
  <span class="n">result</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
<span class="p">}</span>
</pre></div>

<p>It's worth noting that while we are peforming an assertion in the Page Object in our <code>verify_page</code> action <strong>assertions should only be performed in your test scripts</strong> (just like the run action above). Using a <code>verify_page</code> action is just a helpful exception to the rule.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Load Google</li>
<li>Search for <em>elemental selenium tips</em></li>
<li>Wait for the first search result to render</li>
<li>Grab the text from it</li>
<li>Assert that the text we want is within it</li>
</ul>

<h2>Outro</h2>

<p>Hopefully this tip has helped you wade into the waters of Page Objects in Selenium.</p>

<p>Stay tuned for a future tip where we implement a Base Page Object class to abstract things even further and roll our own Domain Specific Language (DSL) for our test suite.</p>

<p>Until then, Happy Testing!</p><br>
<hr>
<a name ="tips_8"></a>
<h2>8. How To Download a File Without a Browser <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/8-download-a-file-revisited">http://elementalselenium.com/tips/8-download-a-file-revisited</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#files #downloading</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In a <a href="http://elemental-selenium.com/tips/2-download-a-file">previous tip</a> we stepped through how to download files with Selenium by configuring the browser to download them locally.</p>

<p>While this works it requires a custom configuration that is inconsistent from browser to browser.</p>

<p>Ultimately we shouldn't care if a file was downloaded or not. Instead we should care that a file <em>can</em> be downloaded. This is a subtle but important distinction.</p>

<h2>A Solution</h2>

<p>Alongside Selenium we can leverage an HTTP library to perform a <code>HEAD</code> request for the file and inspect the response to confirm it contains what we expect.</p>

<p>This will give us the benefit of finding out details of the file without having to trigger a download.</p>

<p>Let's dig with an example.</p>

<h2>An Example</h2>

<p>We start things off by pulling in our requisite libraries (e.g., <code>selenium-webdriver</code> to drive the browser, <code>rspec/expectations</code> and <code>RSpec::Matchers</code> for our assertions, and <code>rest-client</code> for our HTTP request) and wiring up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: download_revisited.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="nb">require</span> <span class="s1">'rest-client'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now we're ready to wire up our test.</p>

<p>It's just a simple matter of visiting the page with download links, grabbing the URL from one of them, and performing a <code>HEAD</code> request with it.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/download'</span>
  <span class="n">link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'.example a'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="no">RestClient</span><span class="o">.</span><span class="n">head</span> <span class="n">link</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_type</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'application/pdf'</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_length</span><span class="o">].</span><span class="n">to_i</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="k">end</span>
</pre></div>

<p>Once we receive the response we check it's header for the <code>content_type</code> and <code>content_length</code> to make sure the file is the correct type and not empty.</p>

<h2>Expected Behavior</h2>

<p>If you save this and run it (e.g., <code>ruby download_revisited.rb</code> from the command-line) here is what will will happen:</p>

<ul>
<li>Open the browser</li>
<li>Load the page</li>
<li>Get the URL of the first download link</li>
<li>Perform a <code>HEAD</code> request against the URL with an HTTP library</li>
<li>Store the response</li>
<li>Check the response headers to see that the file type is correct</li>
<li>Check the response headers to see that the file is not empty</li>
</ul>

<h2>Outro</h2>

<p>Compared to the browser specific configuration with Selenium this is hands-down a leaner, faster, and more maintainable approach.</p>

<p>For a more in-depth look check out my write-up on <a href="http://elementalselenium.com/tips/15-download-secure-files">downloading secure files</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_9"></a>
<h2>9. Using a Base Page Object <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/9-use-a-base-page-object">http://elementalselenium.com/tips/9-use-a-base-page-object</a></h2>
<h3>ADVANCED PATTERNS</h3>
<h4>#page_object #abstraction</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In a <a href="http://elemental-selenium.com/tips/7-use-a-page-object">previous example</a> we stepped through creating a simple Page Object to capture the behavior of a page we were interacting with. While this was a good start, it leaves a lot of room for improvement.</p>

<p>The most obvious problem is that there are common actions we will likely need across multiple Page Objects. And with our current approach we would end up with duplicative code.</p>

<p>And less obviously, we are using Selenium actions directly in the Page Object. While on the face of it this may seem fine it has some long term impacts like...
+ the inability to drive your tests with a different driver if needbe
+ test maintenance issues when Selenium actions change
+ slower test writing due to the lack of a Domain Specific Language (DSL)</p>

<h2>A Solution</h2>

<p>With a Base Page Object (a.k.a. a facade layer) we can abstract all common actions into a central location and leverage them in any Page Object we see fit.</p>

<h2>An Example</h2>

<p>In this example we are going to take the code from our previous tip (<a href="http://elemental-selenium.com/tips/7-use-a-page-object">Using a Page Object</a>) and upgrade it to use a Base Page Object.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://www.google.com'</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">GoogleSearch</span>

  <span class="no">SEARCH_BOX</span>        <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'gbqfq'</span>     <span class="p">}</span>
  <span class="no">SEARCH_BOX_SUBMIT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'gbqfb'</span>     <span class="p">}</span>
  <span class="no">TOP_SEARCH_RESULT</span> <span class="o">=</span> <span class="p">{</span> <span class="n">css</span><span class="p">:</span> <span class="s1">'#rso .g'</span>  <span class="p">}</span>

  <span class="kp">attr_reader</span> <span class="ss">:driver</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="n">driver</span>
    <span class="n">visit</span>
    <span class="n">verify_page</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">visit</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">search_term</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">SEARCH_BOX</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">SEARCH_BOX</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">search_term</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">SEARCH_BOX_SUBMIT</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">search_result_present?</span><span class="p">(</span><span class="n">search_result</span><span class="p">)</span>
    <span class="n">wait_for</span> <span class="p">{</span> <span class="n">displayed?</span><span class="p">(</span><span class="no">TOP_SEARCH_RESULT</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="no">TOP_SEARCH_RESULT</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">include?</span> <span class="n">search_result</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">verify_page</span>
      <span class="n">driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'Google'</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
      <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">displayed?</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
      <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
      <span class="kp">true</span>
      <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">NoSuchElementError</span>
        <span class="kp">false</span>
    <span class="k">end</span>

<span class="k">end</span>

<span class="n">run</span> <span class="p">{</span>
  <span class="n">google</span> <span class="o">=</span> <span class="no">GoogleSearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="p">)</span>
  <span class="n">google</span><span class="o">.</span><span class="n">search_for</span> <span class="s1">'elemental selenium tips'</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">search_result_present?</span> <span class="s1">'Receive a Free, Weekly Tip'</span>
  <span class="n">result</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
<span class="p">}</span>
</pre></div>

<p>Everything stays the same in the beginning of our example. We include our libraries and wire up our setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'http://www.google.com'</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Next we create our Base Page Object. It's a simple Ruby class that our other Page Objects will inherit from.</p>

<p>At the top of it we set an <code>attr_reader</code> to store the Selenium driver object that gets passed to it through the <code>initialize</code> method. And the rest of the class is filled with a series of common Selenium actions that we pull from the GoogleSearch Page Object.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">Base</span>

  <span class="kp">attr_reader</span> <span class="ss">:driver</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="n">driver</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">visit</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="s1">'/'</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'base_url'</span><span class="o">]</span> <span class="o">+</span> <span class="n">url</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span> <span class="n">locator</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">type</span><span class="p">(</span><span class="n">locator</span><span class="p">,</span> <span class="n">input</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">input</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">click_on</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">displayed?</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
    <span class="kp">true</span>
    <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">NoSuchElementError</span>
      <span class="kp">false</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">text_of</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
    <span class="n">find</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">title</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">title</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>With the Base class in hand we simply update the GoogleSearch Page Object to inherit from it (with <code>&lt; Base</code> after the class name) and wire it up and clean things up.</p>

<p>Since we have some actions we want to execute when we load the GoogleSearch object, we keep them in the <code>initialize</code> method. But since we are inheriting from the Base class we need to call <code>super</code> before them. This is responsible for passing the driver object into the Base class and making all of its methods run smoothly.</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">GoogleSearch</span> <span class="o">&lt;</span> <span class="no">Base</span>

  <span class="no">SEARCH_BOX</span>        <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'gbqfq'</span>     <span class="p">}</span>
  <span class="no">SEARCH_BOX_SUBMIT</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'gbqfb'</span>     <span class="p">}</span>
  <span class="no">TOP_SEARCH_RESULT</span> <span class="o">=</span> <span class="p">{</span> <span class="n">css</span><span class="p">:</span> <span class="s1">'#rso .g'</span>  <span class="p">}</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="k">super</span>
    <span class="n">visit</span>
    <span class="n">verify_page</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">search_for</span><span class="p">(</span><span class="n">search_term</span><span class="p">)</span>
    <span class="nb">type</span> <span class="no">SEARCH_BOX</span><span class="p">,</span> <span class="n">search_term</span>
    <span class="n">click_on</span> <span class="no">SEARCH_BOX_SUBMIT</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">search_result_present?</span><span class="p">(</span><span class="n">search_result</span><span class="p">)</span>
    <span class="n">wait_for</span> <span class="p">{</span> <span class="n">displayed?</span><span class="p">(</span><span class="no">TOP_SEARCH_RESULT</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">text_of</span><span class="p">(</span><span class="no">TOP_SEARCH_RESULT</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span> <span class="n">search_result</span>
  <span class="k">end</span>

  <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">verify_page</span>
      <span class="n">title</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'Google'</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
    <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>Once that's done, our actual test script remains unchanged.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="n">google</span> <span class="o">=</span> <span class="no">GoogleSearch</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="p">)</span>
  <span class="n">google</span><span class="o">.</span><span class="n">search_for</span> <span class="s1">'elemental selenium tips'</span>
  <span class="n">result</span> <span class="o">=</span> <span class="n">google</span><span class="o">.</span><span class="n">search_result_present?</span> <span class="s1">'Receive a Free, Weekly Tip'</span>
  <span class="n">result</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
<span class="p">}</span>
</pre></div>

<h2>Expected Behavior</h2>

<ul>
<li>Load Google</li>
<li>Search for <em>elemental selenium tips</em></li>
<li>Wait for the first search result to render</li>
<li>Grab the text from it</li>
<li>Assert that the text we want is within it</li>
</ul>

<h2>Outro</h2>

<p>Now we are in a position to write more Page Objects that leverage common actions without duplication or any Selenium code directly in them.</p>

<p>Hopefully this tip has helped you find your way further down the rabbit hole of Page Objects (in a good way).</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_10"></a>
<h2>10. Retrying Test Actions <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/10-retry-test-actions">http://elementalselenium.com/tips/10-retry-test-actions</a></h2>
<h3>INTERMEDIATE PATTERNS</h3>
<h4>#reliability</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>We all write tests with the best intention of having them pass, and when they fail, to reveal legitimate issues in the application we're testing. But that's not always easy to accomplish. Especially when your application is dependent upon third-party service providers (e.g. payment providers, social networks, etc).</p>

<h2>A Solution</h2>

<p>Rather than have your tests fail intermittently for reasons that don't actually reflect an issue in your application (or that are really difficult to track down), we'd like to trigger a context specific retry for a specific set of actions (rather than the whole test) that will back-off after a few attempts.</p>

<p>If it finds what it needs, the tests passes. If it doesn't, the test fails -- and you know you have a legitimate problem on your hands.</p>

<h2>An Example</h2>

<p>The example application is a page that displays a notification message at the top of the page. It will either say <strong>Action successful</strong> or <strong>Action unsuccessful, please try again</strong>. You can see it <a href="http://the-internet.herokuapp.com/notification_message">here</a>.</p>

<p>Our goal in this example is verify an <strong>Action successful</strong> message.</p>

<p>The beginning of our test script starts off simply with accessing our libraries (Selenium and RSpec) and creating our setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>A first pass at this example would look something like this:</p>
<div class="highlight"><pre><span class="n">run</span> <span class="p">{</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/notification_message'</span>
  <span class="n">notification_message</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'flash'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">notification_message</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/Action successful/</span>
<span class="p">}</span>
</pre></div>

<p>The problem with this approach is that it will fail intermittently because the page's notification message could very well be something else. But the next time you load it, it could be the correct thing.</p>

<p>Perhaps something like this would be better suited:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">get_notification_message</span>
  <span class="vi">@notification_message</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'flash'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">retry_if_notification_message_contains</span><span class="p">(</span><span class="n">fail_message</span><span class="p">)</span>
  <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">yield</span>
  <span class="k">until</span> <span class="o">!</span><span class="vi">@notification_message</span><span class="o">.</span><span class="n">include?</span> <span class="n">fail_message</span> <span class="o">||</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">3</span>
    <span class="k">yield</span>
    <span class="n">count</span> <span class="o">=+</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">run</span> <span class="p">{</span>
  <span class="n">retry_if_notification_message_contains</span> <span class="s1">'please try again'</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/notification_message'</span>
    <span class="n">get_notification_message</span>
  <span class="k">end</span>
  <span class="vi">@notification_message</span><span class="o">.</span><span class="n">should</span> <span class="o">=~</span> <span class="sr">/Action successful/</span>
<span class="p">}</span>
</pre></div>

<p>In this approach we have abstracted out the text grab of the notification message into a method which sets what it finds into an instance variable. And we've added a new method called <code>retry_if_notification_message_contains</code> that accepts an argument of <code>fail_message</code>. In it we accept a yield in 2 places and have constructed a simple loop that runs 3 times or until the notification message does not match the <code>fail_message</code>, whichever comes first. And the yields will execute whatever code is passed both before and during the loop.</p>

<p>In the run block we pass our navigation and text grab actions as a block into <code>retry_if_notification_message_contains</code>, passing the failure message of <strong>please try again</strong> as the argument for <code>fail_message</code> to receive.</p>

<p>And we top everything off with an assertion.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Grab the notification message text</li>
<li>Compare it to the failure message</li>
<li>If it matches, retry</li>
<li>If 3 retries attempted, end loop, and fail test</li>
<li>If it doesn't match, pass the test</li>
</ul>

<h2>Outro</h2>

<p>With this approach there may be a concern that we could be obfuscating a real issue that could bubble up to our users. That's why it is important to use this approach sparingly, and on issues you more or less understand (e.g. a third-party test environment having one-off service blips, or expensive tests that involve sharing something to a third-party and checking to see that it appeared).</p>

<p>Hopefully this example will help you build a more resilient and relevant set of tests.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_11"></a>
<h2>11. Building an Interactive Prompt <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/11-build-an-interactive-prompt">http://elementalselenium.com/tips/11-build-an-interactive-prompt</a></h2>
<h3>INTERMEDIATE TOOLS</h3>
<h4>#repl #debugging</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Working with Selenium straight in code gets you a lot of advantages. But when you run into a tricky scenario to automate it becomes challenging to step through it to completion.</p>

<p>The typical approach is to walk through the scenario manually and inspect its markup, identify the bits you want to interact with, write up the test script, run it, and watch it. If it passes, then pat yourself on the back. If it fails, make some tweaks and run it again -- repeating until it passes.</p>

<p>This is a real pain, and it's even more frustrating when debugging tests that fail intermittently.</p>

<h2>A Solution</h2>

<p>One way to take the sting out of this, and make it easier for folks to transition from Selenium IDE, is to build an interactive prompt -- also known as a read-eval-print-loop (REPL).</p>

<p>Upon loading the prompt it will launch a browser and accept Selenium commands just the same as they are written in test code. And if a command is issued that errors (or that it doesn't recognize) the prompt will provide that information and continue to function.</p>

<p>This will enable us to step through specific Selenium actions and locators to verify that they work before putting them into test code.</p>

<h2>An Example</h2>

<p>In the first half of our example we include our libraries and wire up setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>In the run action we define our loop and its behavior, creating the interactive prompt we want.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="kp">loop</span> <span class="k">do</span>
    <span class="nb">print</span> <span class="s1">'&gt;&gt; '</span>
    <span class="n">input</span> <span class="o">=</span> <span class="nb">gets</span><span class="o">.</span><span class="n">chomp</span>
    <span class="k">if</span> <span class="n">input</span> <span class="o">==</span> <span class="s1">'q'</span>
      <span class="nb">puts</span> <span class="s1">'Quitting...'</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
      <span class="nb">exit</span> <span class="mi">0</span>
    <span class="k">end</span>
    <span class="k">begin</span>
      <span class="nb">eval</span> <span class="n">input</span>
    <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="nb">puts</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>The <code>print</code> command is used instead of <code>puts</code> because we want <code>&gt;&gt;</code> to appear on the same line as the input that we are issuing. This gives us the look and feel of a prompt. And we use <code>gets.chomp</code> to take in input. <code>gets</code> is responsible for receiving the input. And <code>chomp</code> removes the carriage return character (e.g. '\n') from the input.</p>

<p>Before executing the input we perform a check to see if the letter <strong>q</strong> is issued. If so, the script will post a message to the terminal, close the browser, and exit the prompt.</p>

<p>We then execute the input provided with <code>eval</code> and rescue exceptions, posting their message to the terminal when they occur.</p>

<p>Here is an example command you may issue to start: <code>@driver.get 'http://www.elemental-selenium.com'</code>.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Firefox loads</li>
<li>An interactive prompt is presented</li>
<li>Issue a Selenium command and see it execute in the browser</li>
<li>Issue a command that it does not recognize (or that errors), and see a message stating the issue in the prompt</li>
<li>Issue <strong>q</strong>, the browser will close and the prompt will terminate</li>
</ul>

<h2>Outro</h2>

<p>We hope this REPL will help save you some time and frustration -- making it easier to write and debug your tests.</p>

<p>And if you'd like a more advanced way to debug your tests, check out <a href="http://elemental-selenium.com/tips/14-interactive-prompts-revisited">Tip 14 - Interactive Prompts Revisited with Pry</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_12"></a>
<h2>12. How To Opt Out Of A/B Tests <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/12-opt-out-of-ab-tests">http://elementalselenium.com/tips/12-opt-out-of-ab-tests</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#ab_tests #optimizely #opt-out</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Occasionally when running tests you may see unexpected behavior due to <a href="http://en.wikipedia.org/wiki/A/B_testing">A/B testing (a.k.a. split testing)</a> of the application you're working with.</p>

<p>In order to keep your tests running without issue we need a clean way to opt-out of these split tests.</p>

<h2>A quick primer on A/B testing</h2>

<p>Split testing is a simple way to experiment with an application's features to see which changes lead to higher user engagement. A simple example would be testing variations of an e-mail landing page to see if more people sign up. In such a split test there would be the control (how the application looks and behaves now) and variants (e.g., 2 or 3 changes you want to test that could include changing text on the page, element positioning, color of the submit button, etc).</p>

<p>Once the variants are configured, they are put into rotation, and the experiment starts. During this experiment each user will see a different version of the feature and their engagement with it will be tracked.</p>

<p>Split tests live for the length of the experiment or until a winner is found (e.g., tracking indicates that a variant converted higher than the control). If no winner is found, new variants may be created and another experiment tried. If a winner is found, the feature gets updated accordingly.</p>

<h2>A Solution</h2>

<p>Thankfully there are some standard opt-out mechanisms with A/B testing platforms. They come in the form of an appended URL or forging a cookie. Let's dig in with an example of each approach.</p>

<h2>An Example</h2>

<p>Our example page is from <a href="http://github.com/tourdedave/the-internet">the-internet</a> and can be seen <a href="http://the-internet.herokuapp.com/abtest">here</a>. A/B tests for this page are controlled by <a href="https://www.optimizely.com/">Optimizely</a> (a popular A/B testing platform).</p>

<p>There are three different versions of the page that are available. On each page the heading text of the page will vary:</p>

<ul>
<li>Control: <code>A/B Test Control</code></li>
<li>Variation 1: <code>A/B Test Variation 1</code></li>
<li>Opt-out: <code>No A/B Test</code></li>
</ul>

<p>Let's start off the example by loading our libraries and preparing our <code>setup</code>, <code>teardown</code>, and <code>run</code> actions.</p>
<div class="highlight"><pre><span class="c1"># filename: ab.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="o">::</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now let's wire up our first test to step through loading the split testing page and verifying that the text changes as we form an opt-out cookie.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/abtest'</span>
  <span class="n">heading_text</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">expect</span><span class="p">(</span><span class="o">[</span><span class="s1">'A/B Test Variation 1'</span><span class="p">,</span> <span class="s1">'A/B Test Control'</span><span class="o">].</span><span class="n">include?</span> <span class="n">heading_text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_truthy</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">add_cookie</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">'optimizelyOptOut'</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s1">'true'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">navigate</span><span class="o">.</span><span class="n">refresh</span>
  <span class="n">heading_text</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">heading_text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'No A/B Test'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>After navigating to the page we confirm that we are in one of the A/B test groups by grabbing the heading text and seeing if has the proper content. After that we add the opt-out cookie, refresh the page, and then confirm that we are no longer in the A/B test group by checking the heading text again.</p>

<p>We could also load the opt-out cookie before navigating to this page.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">add_cookie</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s1">'optimizelyOptOut'</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s1">'true'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/abtest'</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'No A/B Test'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>Here we are navigating to the main page of the site first, then adding the opt-out cookie, navigating to split testing page, and then performing our checks.</p>

<p>Alternatively, we could opt out without forging a cookie. Instead we could append an opt out request to our URL.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/abtest?optimizely_opt_out=true'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span><span class="o">.</span><span class="n">dismiss</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'h3'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'No A/B Test'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>By appending <code>?optimizely_opt_out=true</code> we achieve the same outcome as before. This will trigger a JavaScript alert, so we make sure to dismiss it before performing our check.</p>

<h2>Expected Behavior</h2>

<p>If you were to save this file and run it (e.g., <code>ruby ab.rb</code> from the command-line), here is what you would see for each of the tests.</p>

<ul>
<li>Opt-out of A/B Tests (either by cookie or appended URL)</li>
<li>Load the A/B Testing page</li>
<li>Grab the header text</li>
<li>Assert that it is correct</li>
</ul>

<h2>Outro</h2>

<p>Hopefully this tip has helped you avoid getting tripped up by A/B tests.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_13"></a>
<h2>13. How To Access Basic Auth <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/13-work-with-basic-auth">http://elementalselenium.com/tips/13-work-with-basic-auth</a></h2>
<h3>BEGINNER TESTING</h3>
<h4>#authentication</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Some times you may work with applications that are secured behind <a href="http://en.wikipedia.org/wiki/Basic_access_authentication">Basic HTTP Authentication</a> (a.k.a. Basic Auth). In order to access them you will need to pass credentials to the server when requesting a page. Otherwise you'll get a system level pop-up prompting you for a username and password -- rendering Selenium helpless.</p>

<p>Before Selenium 2 we were able to accomplish this by injecting credentials into a custom header, but now the cool kid way to do it it was something like <a href="http://bmp.lightbody.net/">BrowserMob Proxy</a>. And some people are solving this with browser specific configurations too.</p>

<p>But all of this feels heavy. Instead, let's look at a simple approach that is browser agnostic.</p>

<h2>A Solution</h2>

<p>By specifying the username and password in the URL when visiting a page with Selenium, we can a side-step the system level dialog box, and avoid setting up a proxy server. This approach will work for both HTTP or HTTPS pages.</p>

<p>Let's take a look at an example.</p>

<h2>An Example</h2>

<p>Let's start by requiring our requisite libraries (e.g., <code>selenium-webdriver</code> to driver the browser and <code>rspec/expectations</code> &amp; <code>RSpec::Matchers</code> to handle our assertions) and implementing some helper methods (e.g., <code>setup</code>, <code>teardown</code>, and <code>run</code>) to handle our test configuration.</p>
<div class="highlight"><pre><span class="c1"># filename: basic_auth.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now to add our test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://admin:admin@the-internet.herokuapp.com/basic_auth'</span>
  <span class="n">page_message</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'.example p'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">page_message</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'Congratulations! You must have the proper credentials.'</span>
<span class="k">end</span>
</pre></div>

<p>In the test we're loading the page by passing in the username and password in the URL (e.g., <code>http://admin:admin@</code>). Once it loads we grab text from the page to make sure we ended up in the right place.</p>

<p>Alternatively, we could have accessed this page as part of the test setup (after creating an instance of Selenium). This would have cached the Basic Auth session in the browser, enabling us to visit the page again without having to specify credentials. This is particularly useful if you have numerous pages behind Basic Auth.</p>

<p>Here's what that would look like.</p>
<div class="highlight"><pre><span class="c1"># filename: basic_auth_setup.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://admin:admin@the-internet.herokuapp.com/basic_auth'</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/basic_auth'</span>
  <span class="n">page_message</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'.example p'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">page_message</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'Congratulations! You must have the proper credentials.'</span>
<span class="k">end</span>
</pre></div>

<p><strong>NOTE: If your application serves both HTTP and HTTPS pages from behind Basic Auth then you will need to load one of each type before executing your test steps. Otherwise you will get authorization errors when switching between HTTP and HTTPS because the browser can't use Basic Auth credentials interchangeably (e.g. HTTP for HTTPS and vice versa).</strong></p>

<h2>Expected Behavior</h2>

<p>If you save the first example and run it (e.g., <code>ruby basic_auth.rb</code>), here is what would happen:</p>

<ul>
<li>Open the browser</li>
<li>Visit the page using Basic Auth</li>
<li>Get the page text</li>
<li>Assert that the text is what we expect</li>
</ul>

<p>And if you save the second example and run it (e.g., <code>ruby basic_auth_setup.rb</code>), here is what would happen:</p>

<ul>
<li>Open the browser</li>
<li>Visit the page using Basic Auth</li>
<li>Navigate away from the Basic Auth path</li>
<li>Navigate back to the Basic Auth page (without providing credentials)</li>
<li>Get the page text</li>
<li>Assert that the text is what we expect</li>
</ul>

<h2>Outro</h2>

<p>Hopefully this tip will help save you from getting tripped by Basic Auth when you come across it.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_14"></a>
<h2>14. Interactive Prompts Revisited <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/14-interactive-prompts-revisited">http://elementalselenium.com/tips/14-interactive-prompts-revisited</a></h2>
<h3>ADVANCED TOOLS</h3>
<h4>#repl #pry #debugging #guest_post</h4>
<hr width="40%" align="left">
<p>NOTE: This is a guest post chocked full of knowledge from Brian Goad of <a href="http://www.digitalsmiths.com/">Digitalsmiths</a>. You can follow him on Twitter at <a href="https://twitter.com/bbbco">@bbbco</a> and check out his testing blog <a href="http://swdandruby.wordpress.com/">here</a>.</p>

<h2>The Problem</h2>

<p>In <a href="http://elemental-selenium.com/tips/11-build-an-interactive-prompt">Tip 11</a> we covered how a REPL can help you determine what code to write in your scripts by testing locators and actions through an interactive prompt. This is great for simple tasks, but its starts to falter when debugging more complex scripts.</p>

<p>Often times you will find yourself puzzling over an error or failure occuring in the middle of your script. It is not very efficient to have to run through each command in your script, line by line, to get to the context of the place you are attempting to debug in a simple REPL. Usually, you have already setup some framework, boilerplate, and helper code to assist you in writing your script. This just adds on to the problem, as you have no easy way to view the objects or methods available to you while debugging in your script.</p>

<p>Sometimes you just need to be able to <em>pry</em> into the code, jump in, open it up and explore the area in order to solve the error you are experiencing.</p>

<h2>A Solution</h2>

<p>A common utility most programmers in the Ruby community are familiar with is the Interactive Ruby Shell (IRB). This is a REPL that comes with Ruby that enables you to send and receive Ruby commands. While this is useful, it leaves much to be desired, and <a href="https://www.ruby-toolbox.com/categories/irb_Alternatives">an excellent alternative</a> is the <a href="http://pryrepl.org">Pry gem</a>. It not only lets you execute Ruby commands to test your input and output, but it also allows you to <em>pry</em> inside your code and interact with it while running.</p>

<p>You can use the Pry gem to help you construct your scripts (like a simple REPL), but you can also use it as a helpful debugging tool.</p>

<p>To install Pry, you can either add it to your Gemfile like so:</p>
<div class="highlight"><pre><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>

<span class="n">gem</span> <span class="s1">'pry'</span>
</pre></div>

<p>And then run <code>bundle install</code>. Or, you can install it from the commandline with <code>gem install pry</code>.</p>

<h2>An Example</h2>

<p>Here I will walk you through a real life example of how I recently used Pry to debug an issue in one of my test scripts.</p>

<p>To give you some context, here is a simple example of some of my test code.</p>
<div class="highlight"><pre><span class="kp">include</span> <span class="no">SiteCheckers</span>

<span class="vi">@driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"http://www.mysite.com"</span><span class="p">)</span>

<span class="n">everything_ready</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>

<span class="c1"># ... other code that tests other aspects of the site</span>
</pre></div>

<p>We include a module of helpful methods for use in our scripts by including <code>SiteCheckers</code>. We assume that the driver is already setup and our tests are using Rspec. And <code>everything_ready</code> is a method mixed in from <code>SiteCheckers</code>. It dynamically checks the page to ensure that we are on the right one and that it is rendered correctly.</p>

<p>With this context in mind, here is the specific example I was working with recently:</p>
<div class="highlight"><pre><span class="kp">include</span> <span class="no">SiteCheckers</span>
<span class="kp">include</span> <span class="no">FeatureItems</span>

<span class="vi">@driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"http://www.mysite.com/some-feature"</span><span class="p">)</span>
<span class="n">everything_ready</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>

<span class="c1"># ... other code that tests other aspects of the feature</span>
</pre></div>

<p>Uh oh. When I ran this test, I got an error.</p>
<div class="highlight"><pre><span class="no">RSpec</span><span class="o">::</span><span class="no">Expectations</span><span class="o">::</span><span class="no">ExpectationNotMetError</span><span class="p">:</span> <span class="n">expected</span><span class="p">:</span> <span class="kp">true</span>
     <span class="n">got</span><span class="p">:</span> <span class="kp">nil</span> <span class="p">(</span><span class="n">using</span> <span class="o">==</span><span class="p">)</span>
</pre></div>

<p>That is real funny, because when I looked at the code for this method, nothing should have caused it to return nil:</p>
<div class="highlight"><pre><span class="k">module</span> <span class="nn">SiteCheckers</span>

<span class="k">def</span> <span class="nf">everything_ready</span>
  <span class="c1"># redacted code checks to ensure the page is rendered</span>
  <span class="c1"># and raises error if there is an issue</span>
  <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># ... other helper methods defined here</span>

<span class="k">end</span>
</pre></div>

<p>So, what did I do to solve this issue? I used Pry to debug the error and discover my real issue!</p>

<p>To initialize Pry in your code, you have to require the gem, and then place <code>binding.pry</code> wherever you want execution of your code to pause so you can jump in and look around for yourself. For example:</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'pry'</span>

<span class="kp">include</span> <span class="no">SiteCheckers</span>
<span class="kp">include</span> <span class="no">FeatureItems</span>

<span class="vi">@driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"http://www.mysite.com/some-feature"</span><span class="p">)</span>

<span class="c1"># With this, we jump right in before the error in the script</span>
<span class="nb">binding</span><span class="o">.</span><span class="n">pry</span>

<span class="n">everything_ready</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
</pre></div>

<p>And when we run the test, we will get a prompt like this:</p>
<div class="highlight"><pre><span class="no">Frame</span> <span class="n">number</span><span class="p">:</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>

<span class="no">From</span><span class="p">:</span><span class="sr"> /home/</span><span class="n">bgoad</span><span class="o">/</span><span class="n">es</span><span class="o">-</span><span class="n">pry</span><span class="o">/</span><span class="n">pry_test</span><span class="o">.</span><span class="n">rb</span> <span class="err">@</span> <span class="n">line</span> <span class="mi">38</span> <span class="p">:</span>

    <span class="mi">33</span><span class="p">:</span>     <span class="kp">include</span> <span class="no">FeatureItems</span>
    <span class="mi">34</span><span class="p">:</span>
    <span class="mi">35</span><span class="p">:</span>     <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"http://www.mysite.com/some-feature"</span><span class="p">)</span>
    <span class="mi">36</span><span class="p">:</span>
    <span class="mi">37</span><span class="p">:</span>     <span class="c1"># We'll jump right in before the error in the script</span>
 <span class="o">=&gt;</span> <span class="mi">38</span><span class="p">:</span>     <span class="nb">binding</span><span class="o">.</span><span class="n">pry</span>
    <span class="mi">39</span><span class="p">:</span>
    <span class="mi">40</span><span class="p">:</span>     <span class="n">everything_ready</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>

<span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span>
</pre></div>

<p>Which means that we have jumped right into the context of our code at the spot where the rocket-arrow is pointing (binding.pry). From here, we can use Unix-like commands to explore our code inside the REPL prompt.</p>

<p><code>ls</code> will provide a list of Classes, Modules, methods, instance variables, and private variables available in this context. This is a great command to learn more about what is available to you at this point. Two other helpful commands are <code>cd</code> and <code>help</code>. You can use <code>cd</code> to change the context to inside an object, class or module. And <code>help</code> provides you with a quick access of commands available to Pry.</p>

<p>Browsing through these commands will allow you to discover other neat tricks you can do with Pry. You can also execute any Ruby code you want from Pry's prompt.</p>

<p>Let's take a closer look at the <code>everything_ready</code> method:</p>
<div class="highlight"><pre><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">everything_ready</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</pre></div>

<p>Hmm, this method is not returning <code>true</code> as we expect in the test.</p>

<p>Let's see if Pry can <code>help</code> us. One such command available from Pry is <code>show-method</code>, which will print out the code of the method you pass it. Let's do that:</p>
<div class="highlight"><pre><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">show</span><span class="o">-</span><span class="nb">method</span> <span class="n">everything_ready</span>

<span class="no">From</span><span class="p">:</span> <span class="n">pry_test</span><span class="o">.</span><span class="n">rb</span> <span class="err">@</span> <span class="n">line</span> <span class="mi">21</span><span class="p">:</span>
<span class="no">Owner</span><span class="p">:</span> <span class="no">FeatureItems</span>
<span class="no">Visibility</span><span class="p">:</span> <span class="kp">public</span>
<span class="no">Number</span> <span class="n">of</span> <span class="n">lines</span><span class="p">:</span> <span class="mi">6</span>

<span class="k">def</span> <span class="nf">everything_ready</span>
  <span class="k">super</span>
  <span class="k">if</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span> <span class="o">=&gt;</span> <span class="s2">"#modal_dialog"</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span> <span class="o">=&gt;</span> <span class="s2">"#modal_dialog_close"</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Oh, look! I was expecting the #everything_ready method from SiteCheckers, but according to the Owner field from Pry's output, we are overriding the method inside the <code>FeatureItems</code> module in order to add some extra functionality (presumably, closing a modal if it is shown on the page).</p>

<p>The reason the method is not returning true is because the last line, which is what will be returned, does not result in true. Instead, when an <code>if..end</code> statement is executed, it always returns a nil. We can test this in Pry:</p>
<div class="highlight"><pre><span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">if</span> <span class="kp">true</span>
<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="nb">puts</span> <span class="s2">"yay"</span>
<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span> <span class="k">end</span>
<span class="n">yay</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="k">if</span> <span class="kp">false</span>
<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span>   <span class="nb">puts</span> <span class="s2">"boo"</span>
<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">*</span> <span class="k">end</span>
<span class="o">=&gt;</span> <span class="kp">nil</span>
</pre></div>

<p>The rocket-arrows after the command we executed indicate the result of the command, which is nil. So, I need to update the overridden #everything_ready method to return the result of <code>super</code> instead of the <code>if..end</code> statement.</p>

<p>What's really cool is that I can do so right inside of Pry using the <code>edit</code> command! Typing <code>edit everything_ready</code> will pop me inside the FeatureItems#everything_ready method using my favorite terminal editor. Here, I can make the updates to my code:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">everything_ready</span>
  <span class="n">result</span> <span class="o">=</span> <span class="k">super</span>
  <span class="k">if</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span> <span class="o">=&gt;</span> <span class="s2">"#modal_dialog"</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span> <span class="o">=&gt;</span> <span class="s2">"#modal_dialog_close"</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="k">end</span>
  <span class="n">result</span>
<span class="k">end</span>
</pre></div>

<p>Now I save and quit the editor. Once I am back in the Pry prompt, it reloads the file I edited and allows me to try my code again.</p>
<div class="highlight"><pre><span class="no">Frame</span> <span class="n">number</span><span class="p">:</span> <span class="mi">0</span><span class="o">/</span><span class="mi">1</span>

<span class="no">From</span><span class="p">:</span><span class="sr"> /home/</span><span class="n">bgoad</span><span class="o">/</span><span class="n">es</span><span class="o">-</span><span class="n">pry</span><span class="o">/</span><span class="n">pry_test</span><span class="o">.</span><span class="n">rb</span> <span class="err">@</span> <span class="n">line</span> <span class="mi">38</span> <span class="p">:</span>

    <span class="mi">33</span><span class="p">:</span>     <span class="kp">include</span> <span class="no">FeatureItems</span>
    <span class="mi">34</span><span class="p">:</span>
    <span class="mi">35</span><span class="p">:</span>     <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"http://www.mysite.com/some-feature"</span><span class="p">)</span>
    <span class="mi">36</span><span class="p">:</span>
    <span class="mi">37</span><span class="p">:</span>     <span class="c1"># We'll jump right in before the error in the script</span>
 <span class="o">=&gt;</span> <span class="mi">38</span><span class="p">:</span>     <span class="nb">binding</span><span class="o">.</span><span class="n">pry</span>
    <span class="mi">39</span><span class="p">:</span>
    <span class="mi">40</span><span class="p">:</span>     <span class="n">everything_ready</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>

<span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">everything_ready</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
<span class="o">=&gt;</span> <span class="kp">true</span>
</pre></div>

<p>To exit out of Pry and let my test finish running, I simply type <code>exit</code>. And now both tests succeed! Don't forget to remove the <code>binding.pry</code> line from inside the test, or else Pry will start right back up again inside the code.</p>

<h2>Outro</h2>

<p>Nice! I was able to use Pry to jump into my code right before a failure in my test, have a look around in the environment, debug why my code was failing, and make a quick fix. And I was finally able to verify that my fix was working by running the command in my test again. Pry is pretty darn sweet!</p>

<p>There are plenty of other uses for pry, this tip just scratches the surface. In fact, <a href="https://github.com/pry/pry/wiki/Available-plugins">the Pry comnmunity</a> includes several useful plugins to enhance your Pry experience. Some of the most popular ones include pry-rescue (deposits you into Pry at the point and context of a failure or error in your code), pry-stack_explorer (enables you to travel up and down the stack), and pry-debug (includes actual debugger funtionality like step and continue).</p>

<p>I encourage you to <a href="http://pryrepl.org">take a look around the community</a> and see <a href="https://github.com/pry/pry/wiki">how Pry can make your construction and debugging of tests</a> so much more efficient. And not only that, you'll also begin to learn why your code works in certain ways and how it is structured. Making you a much better test automator and coder as a result.</p>

<p>Happy Prying!</p><br>
<hr>
<a name ="tips_15"></a>
<h2>15. How To Download Secure Files <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/15-download-secure-files">http://elementalselenium.com/tips/15-download-secure-files</a></h2>
<h3>ADVANCED TESTING</h3>
<h4>#files #downloading #authentication</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In <a href="http://elementalselenium.com/tips/8-download-a-file-revisited">a previous tip</a> we covered how to write tests to download files in a browser agnostic way by leveraging Selenium Webdriver and an HTTP library in tandem.</p>

<p>This approach is great, but there are often times where the file you want to download is behind authentication, presenting a hurdle to overcome.</p>

<h2>A Solution</h2>

<p>In order to access secure files with an HTTP library, we want to pull the authenticated session information out of Selenium's cookie store and pass it into the HTTP library when we perform the request.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>We start by requiring our libraries (<code>selenium-webdriver</code> to drive the browser, <code>rspec-expectations</code> for our assertions, and <code>rest-client</code> for our HTTP requests) and wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: secure_download.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="nb">require</span> <span class="s1">'rest-client'</span>

<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Next we'll wire up our test actions.</p>

<p>We first access access a page of download links that is behind Basic HTTP Authentication on <a href="http://github.com/tourdedave/the-internet">the-internet</a>.</p>

<p>Once the page loads, we grab the authentication session cookie and the URL for the first file listed. Once we have that we fire up <code>RestClient</code> and perform a <code>HEAD</code> request using both the download link and the session cookie. We then check the response headers to make sure the file is the correct type and that it is not empty.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://admin:admin@the-internet.herokuapp.com/download_secure'</span>
  <span class="n">cookie</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">cookie_named</span> <span class="s1">'rack.session'</span>
  <span class="n">link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'.example a'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
  <span class="n">response</span> <span class="o">=</span> <span class="no">RestClient</span><span class="o">.</span><span class="n">head</span> <span class="n">link</span><span class="p">,</span> <span class="n">cookie</span><span class="p">:</span> <span class="p">{</span> <span class="n">cookie</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="n">cookie</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span> <span class="p">}</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_type</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'image/jpeg'</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_length</span><span class="o">].</span><span class="n">to_i</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="k">end</span>
</pre></div>

<p>It's worth noting that we are using a <code>HEAD</code> request instead of a <code>GET</code> request. Since we only care about the header information this will perform a partial fetch of data, rather than a full download of the file.</p>

<p>If we run this it will pass. But it's only limited to the first download link and it's unfortunately quite brittle (since the test assumes that the file will always be an image). Let's update our example to remedy this.</p>

<h2>An Improved Example</h2>

<p>First, let's create a helper method to tease out the filename from a given URL and return the correct content type. If we don't recognize the file type, then we'll stop the test and raise an exception.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">content_type</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
  <span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">include?</span> <span class="s1">'.jpg'</span>
    <span class="s1">'image/jpeg'</span>
  <span class="k">elsif</span> <span class="n">file</span><span class="o">.</span><span class="n">include?</span> <span class="s1">'.pdf'</span>
    <span class="s1">'application/pdf'</span>
  <span class="k">else</span>
    <span class="k">raise</span> <span class="s1">'Unknown file type'</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Now we can update our test to use this method in addition to grabbing all download links from the page and iterating through them.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://admin:admin@the-internet.herokuapp.com/download_secure'</span>
  <span class="n">cookie</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">cookie_named</span> <span class="s1">'rack.session'</span>
  <span class="n">links</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'.example a'</span><span class="p">)</span>
  <span class="n">links</span><span class="o">.</span><span class="n">map!</span> <span class="p">{</span> <span class="o">|</span><span class="n">link</span><span class="o">|</span> <span class="n">link</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">links</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">link</span><span class="o">|</span>
    <span class="n">response</span> <span class="o">=</span> <span class="no">RestClient</span><span class="o">.</span><span class="n">head</span> <span class="n">link</span><span class="p">,</span> <span class="n">cookie</span><span class="p">:</span> <span class="p">{</span> <span class="n">cookie</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="n">cookie</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span> <span class="p">}</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_type</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="n">content_type</span><span class="p">(</span><span class="n">link</span><span class="p">))</span>
    <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="ss">:content_length</span><span class="o">].</span><span class="n">to_i</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be</span> <span class="o">&gt;</span> <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>By using <code>find_elements</code> we get all of the download links returned in an Array. We then use <code>map!</code> to update the collection to give us just the URLs (instead of a collection of Selenium objects which contain URLs).</p>

<p>After that, we're able to iterate over the Array of URLs, perform a <code>HEAD</code> request, and perform our assertions just like before (but this time, using our new <code>content_type</code> helper method).</p>

<h2>Expected Behavior</h2>

<p>If we save this file and run it (e.g., <code>ruby secure_download.rb</code> from the command-line), here is what will happen.</p>

<ul>
<li>Browser opens</li>
<li>The secure file downloads page loads</li>
<li>The authenticated cookie information is retrieved</li>
<li>All download links are retrieved</li>
<li>An HTTP library performs a HEAD request against the download link using the retrieved cookie information</li>
<li>The response headers are checked to make sure the file is the correct type and not empty</li>
<li>The previous two steps are repeated until all download links are verified</li>
</ul>

<h2>Outro</h2>

<p>From here, it's simple enough to add in additional content types and file types. And while this example demonstrates accessing files behind Basic HTTP Authentication it should also work with files behind form-based authentication.</p>

<p>Hopefully this helps save you some time, enabling you to build a more lean and fast set of download tests.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_16"></a>
<h2>16. How To Take A Screenshot On Failure <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/16-take-screenshot-on-failure">http://elementalselenium.com/tips/16-take-screenshot-on-failure</a></h2>
<h3>INTERMEDIATE REPORTING</h3>
<h4>#reporting #screenshot</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>With browser tests it can often be challenging to track down the issue that triggered a failure.</p>

<h2>A Solution</h2>

<p>A simple way to gain insight into your test failures is by capturing screenshots at the moment of failure. This is not only a quick and easy thing to add ot your tests. It's also a cornerstone of good automated testing practice.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>Let's start by including our requisite libraries (<code>selenium-webdriver</code> to drive the browser and <code>rspec/expectations</code> for our assertions) and wire up <code>setup</code> and <code>teardown</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: screenshot.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>
</pre></div>

<p>Next we'll want to create a <code>run</code> method that will tie our test actions together with <code>setup</code> and <code>teardown</code>.</p>

<p>In it we'll not only want to use <code>setup</code> and <code>teardown</code> but we'll also want to wrap our test actions (e.g., the <code>yield</code> command) so we can <code>rescue</code> failed assertions. That way, when a failure occurs, we can specify some commands to capture additional information.</p>

<p>In this case, let's output the test failure message and leverage Selenium's screenshotting capability.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">begin</span>
    <span class="k">yield</span>
  <span class="k">rescue</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Expectations</span><span class="o">::</span><span class="no">ExpectationNotMetError</span> <span class="o">=&gt;</span> <span class="n">error</span>
    <span class="nb">puts</span> <span class="n">error</span><span class="o">.</span><span class="n">message</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">save_screenshot</span> <span class="s2">"./</span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"failshot__%d_%m_%Y__%H_%M_%S"</span><span class="p">)</span><span class="si">}</span><span class="s2">.png"</span>
  <span class="k">end</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p><code>.save_screenshot</code> accepts a filename as a string (e.g., <code>'failshot.png'</code>). When this command executes it will save an image file to your local system in the current working directory.</p>

<p>Note the use of <code>Time.now.strftime</code> in the screenshot filename. This is using a timestamp (down to the second). This will provide a (reasonably) unique file name and has the added benefit of listing the files in the order taken.</p>

<p>Now let's wire up our test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'h1'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'Welcome to the Internet!'</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<p>If we save this file and run it (<code>ruby screenshot.rb</code> from the command-line) here is what you would see:</p>

<ul>
<li>Load the homepage of <a href="http://github.com/tourdedave/the-internet">the-internet</a></li>
<li>Check the text of the page header</li>
<li>Output a failure message in the terminal</li>
<li>Capture a timestamped screenshot in the current working directory</li>
</ul>

<h2>Outro</h2>

<p>For more info on <code>strftime</code> (a.k.a. String Formatted Time) go <a href="http://apidock.com/ruby/DateTime/strftime">here</a>.</p>

<p>But if you want truly unique filenames, then you should use a unique ID in the filename instead of a timestamp (e.g., something like <a href="https://github.com/assaf/uuid"><code>uuid</code></a>). This will prevent screenshots from getting overwritten when you have two (or more) tests taking screenshots at the same time.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_17"></a>
<h2>17. How To Test HTTP Status Codes <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/17-retrieve-http-status-codes">http://elementalselenium.com/tips/17-retrieve-http-status-codes</a></h2>
<h3>ADVANCED TOOLS</h3>
<h4>#test_http_status #retrieve_http_status #http_status_codes #proxy #proxy_server #browsermob-proxy</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>There are times when you are testing a page (or numerous pages) and you want to verify that it responded correctly. A great way to handle this is by checking the HTTP Status Code that the browser received. However this functionality is not available in Selenium WebDriver.</p>

<h2>A Solution</h2>

<p>The tried and true approach that Selenium Committers and Practitioners recommend is to use a proxy server. With it, we will be able to watch and manipulate network traffic to and from the application under test -- giving us access to a whole host of functionality that we wouldn't have otherwise had.</p>

<p>Let's step through an example using <a href="http://bmp.lightbody.net/">BrowserMob Proxy</a>.</p>

<h2>An Example</h2>

<p>We first need to download a copy of <a href="http://bmp.lightbody.net/">BrowserMob Proxy</a>. Next, we'll write our script in a file called <code>status_codes.rb</code>.</p>

<p>At the top of the file we'll pull in our requisite libraries (e.g., <code>selenium-webdriver</code> to drive the browser, <code>rspec-expectations</code> for our assertion, and <code>browsermob/proxy</code> to control the proxy server).</p>

<p><strong>NOTE: You can find more info on the <code>browsermob-proxy</code> gem we are using <a href="https://rubygems.org/gems/browsermob-prox://github.com/jarib/browsermob-proxy-rb">here</a>.</strong></p>
<div class="highlight"><pre><span class="c1"># filename: status_codes.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>
<span class="nb">require</span> <span class="s1">'browsermob/proxy'</span>
</pre></div>

<p>Next we create a method to prepare the proxy for use with Selenium. In it we start the proxy server, configure a browser profile (Firefox in this case) to use it, and return the profile object.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">configure_proxy</span>
  <span class="n">server</span> <span class="o">=</span> <span class="no">BrowserMob</span><span class="o">::</span><span class="no">Proxy</span><span class="o">::</span><span class="no">Server</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
    <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="p">,</span> <span class="s1">'browsermob-proxy-2.0.0/bin/browsermob-proxy'</span><span class="p">))</span>
  <span class="vi">@proxy</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">start</span><span class="o">.</span><span class="n">create_proxy</span>
  <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="n">profile</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="vi">@proxy</span><span class="o">.</span><span class="n">selenium_proxy</span>
  <span class="n">profile</span>
<span class="k">end</span>
</pre></div>

<p>Next we wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">configure_proxy</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">close</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>In <code>setup</code> we use <code>configure_proxy</code> when specifying the profile object. And we close the proxy in <code>teardown</code> after quitting the Selenium session.</p>

<p>Now let's create a helper method to pull the status code out of the <a href="http://www.softwareishard.com/blog/har-12-spec/">HTTP Archive</a> (a.k.a. HAR) when an action is performed.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">retrieve_status_code</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">new_har</span>
  <span class="k">yield</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">har</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status</span>
<span class="k">end</span>
</pre></div>

<p>Now we can wire up our Selenium actions and assertion in a <code>run</code> method.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="n">status_code</span> <span class="o">=</span> <span class="n">retrieve_status_code</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/status_codes/404'</span>
  <span class="k">end</span>

  <span class="n">expect</span><span class="p">(</span><span class="n">status_code</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="mi">404</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<p>When we save this file and run it (e.g., <code>ruby status_codes.rb</code> from the command-line), here is what will happen:</p>

<ul>
<li>Open a browser</li>
<li>Visit the URL</li>
<li>Retrieve the HTTP Status Code from loading the page</li>
<li>Assert that the status code is what was expected</li>
</ul>

<h2>Troubleshooting</h2>

<p>If you get an error when running your test that says <code>unable to launch the server</code>, be sure to append <code>log: true</code> when creating an instance of <code>Browsermob::Proxy::Server</code>.</p>
<div class="highlight"><pre>  <span class="n">server</span> <span class="o">=</span> <span class="no">BrowserMob</span><span class="o">::</span><span class="no">Proxy</span><span class="o">::</span><span class="no">Server</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
    <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="p">,</span> <span class="s1">'browsermob-proxy-2.0.0/bin/browsermob-proxy'</span><span class="p">),</span> <span class="n">log</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
</pre></div>

<p>Now when you run your test, you will recieve more detailed information as to why the server was unable to start.</p>

<h2>Outro</h2>

<p>This tip was inspired by <a href="https://twitter.com/jimevansmusic">Jim Evans</a>' multi-part blog post series on doing the same thing in C# with Fiddler (<a href="http://jimevansmusic.blogspot.com/2013/08/implementing-webdriver-http-status.html">1</a>, <a href="http://jimevansmusic.blogspot.com/2013/08/implementing-http-status-codes-in.html">2</a>, <a href="http://jimevansmusic.blogspot.com/2013/08/implementing-http-status-codes-in_17.html">3</a>) which was in response to <a href="https://code.google.com/p/selenium/issues/detail?id=141">Selenium Issue 141</a>. Thanks Jim!</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_18"></a>
<h2>18. Figuring Out What To Test <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/18-what-to-test">http://elementalselenium.com/tips/18-what-to-test</a></h2>
<h3>BEGINNER STRATEGY</h3>
<h4>#test_strategy</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>There is a lot to figure out when it comes to automated web testing, but where do you start? And if you've already started, how do you know you're on the right track? And how do you avoid testing everything in every browser without missing important issues?</p>

<h2>A Solution</h2>

<p>A great way to increase your chances of automated web testing success is to map out a testing strategy. And the best way to do it is to answer these four questions:</p>

<ol>
<li>How does your business make money?<br></li>
<li>How do your users use your application?<br></li>
<li>What browsers are your users using?<br></li>
<li>What things have broken in the application before?<br></li>
</ol>

<p><strong>NOTE: for entities that don't deal <em>directly</em> in dollars and cents (e.g. non-profits, federal agencies, etc.) you should focus on how the application generates value for the end user.</strong></p>

<p>After answering these questions you'll have a firm understanding of business critical functionality and the relevant browsers for the application you're testing. This will help you focus your test automation efforts on the things that matter most. </p>

<p>You'll want to keep track of these items somehow -- the recommended approach is to use a prioritized backlog.</p>

<h2>What To Do With The Answers</h2>

<h3>Question 1 - Money/Value</h3>

<p>Every company's application makes money (or generates value) through a core set of functionality -- a.k.a. a 'funnel'. Your answers to this question will help you determine what functionality makes up the funnel. This will be your highest priority for test automation.</p>

<h3>Question 2 - Usage Data</h3>

<p>There can be a big difference between how you think your application is used, and how yours users actually use it. And odds are your application offers a robust set of functionality that grows well beyond the core functionality of the funnel. Your answers to this question will help you determine what features are highly used and lightly used. Tack the highly used items onto your automation backlog based on order of use below the answers to question 1.</p>

<h3>Question 3 - Browsers</h3>

<p>Now that you know what functionality is business critical and widely adopted by your users, you need to determine what browsers to focus your automated web testing efforts on. Your usage data will tell you this as well. It will help you determine which browsers you can reasonably avoid testing in (e.g. based on non-existent or low usage numbers). Note the top 2 browsers (or 3 depending on your numbers), but focus on the top 1 for now. This is the browser you will start writing your automated tests in.</p>

<h3>Question 4 - Risky Bits</h3>

<p>To round out the strategy it is best to think about what things have broken in the application before. You can sometimes glean this information from a defect tracker. But the juicy information is often in the minds of your colleagues. Ask around and see what they say. What you come up with will likely read like a laundry list of browser specific issues or functionality that has been flaky or forgotten about in the past. Be sure to check this list against your automation backlog. If you've come across something that's not already in the backlog, add it and put it at the bottom. If it is there, make a note in the backlog item that this has been an issue in the past. And if the issue has happened numerous times and has the potential to occur again, move that backlog item up in priority.</p>

<p>And if issues keep cropping up that are related to a specific browser, compare this browser to your short list from question #3. If it's a browser that's not in your list but it's a small pocket of high value users, track it on the backlog but put it at the bottom.</p>

<h2>Now Your Are Ready</h2>

<p>Having answered these questions you should now have a prioritized backlog of critical business functionality that's backed up by usage data, a short list of browsers to focus on, and an understanding of the risky parts of your application. With it you can make sure you are on the right track with your test automation.</p>

<h2>Outro</h2>

<p>Hopefully this strategy will help you focus your testing efforts, avoid wasting time, and increase your confidence in the approach you are taking.</p>

<p>This strategy works best for applications with existing functionality and does not speak directly to testing new functionality that's being actively developed. That's not to say that the two couldn't co-exist. It largely depends on your available resources and pace of development. But in order to reach high quality at speed, you first have to go slow.</p><br>
<hr>
<a name ="tips_19"></a>
<h2>19. How To Create a Data Driven Test <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/19-data-driven-testing">http://elementalselenium.com/tips/19-data-driven-testing</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#data-driven_testing #csv #authentication</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>There are times when you run across functionality you want to test repeatedly with various inputs to see how the system behaves. Sometimes to test the expected outcomes, other times to see if the system breaks in a weird way.</p>

<p>Wiring all of these permutations up into a set of tests can be burdensome, rife with copied code, and hard to maintain once they reach a certain size.</p>

<h2>A Solution</h2>

<p>Enter Data-driven Testing. By storing your desired inputs and expected outcomes in a central repository of some kind (e.g. a comma separated file, database, etc) you can easily wire up tests to use each of them instead of writing numerous tests and hard-coding these values directly in your test code.</p>

<h2>An Example</h2>

<p>Let's step through a common example -- testing a login form on a website.</p>

<p>We are going to store the user attributes and expected output values in a comma-separated value (CSV) file like so:</p>
<div class="highlight"><pre><span class="n">account_type</span><span class="p">,</span><span class="n">username</span><span class="p">,</span><span class="n">password</span><span class="p">,</span><span class="n">notification_message</span>
<span class="n">bad_password</span><span class="p">,</span><span class="n">tomsmith</span><span class="p">,</span><span class="n">badPassword</span><span class="p">,</span><span class="no">Your</span> <span class="n">password</span> <span class="n">is</span> <span class="n">invalid!</span>
<span class="n">bad_username</span><span class="p">,</span><span class="n">badUsername</span><span class="p">,</span><span class="no">SuperSecretPassword</span><span class="o">!</span><span class="p">,</span><span class="no">Your</span> <span class="n">username</span> <span class="n">is</span> <span class="n">invalid!</span>
<span class="n">standard_user</span><span class="p">,</span><span class="n">tomsmith</span><span class="p">,</span><span class="no">SuperSecretPassword</span><span class="o">!</span><span class="p">,</span><span class="no">You</span> <span class="n">logged</span> <span class="n">into</span> <span class="n">a</span> <span class="n">secure</span> <span class="n">area!</span>
</pre></div>

<p>In our example code we start out by including our libraries for driving the browser (selenium-webdriver), performing assertions (rspec/expectations), and working with the CSV file (csv). After that, we wire up our <code>setup</code>, <code>teardown</code>, and <code>run</code> actions.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="nb">require</span> <span class="s1">'csv'</span>
<span class="kp">include</span> <span class="o">::</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Next we wire up CSV parsing.</p>

<p>In <code>user_data</code> we read the CSV file in and pull the first row from it -- storing it to a variable called <code>descriptor</code> and then converting each value in it to a symbol. We then iterate over the rest of the CSV data and create a hash for each batch of user data. In each hash we are binding the relevant descriptor to each value through the use of <code>.zip</code>. This enables us to reference each of the user values by looking them up in the hash with a descriptor symbol.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">user_data</span>
  <span class="n">user_data</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">read</span> <span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span> <span class="o">+</span> <span class="s1">'/user_data.csv'</span>
  <span class="n">descriptor</span> <span class="o">=</span> <span class="n">user_data</span><span class="o">.</span><span class="n">shift</span>
  <span class="n">descriptor</span> <span class="o">=</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span> <span class="n">key</span><span class="o">.</span><span class="n">to_sym</span> <span class="p">}</span>
  <span class="n">user_data</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="no">Hash</span><span class="o">[</span> <span class="n">descriptor</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>We then add two helper methods -- <code>wait_until</code> and <code>notification_text</code>. In <code>wait_until</code> we use the stock Selenium Wait action to continuously perform an action until either the timeout is reached or the action is true (whichever comes first). We then turn around and immediately use this in <code>notification_text</code> where we wait for the notification message to appear before grabbing it's text. Once we have the text, we clean it up by deleting non-letter characters while preserving <code>!</code> and <code>.</code>.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">wait_until</span>
  <span class="n">wait</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">)</span>
  <span class="n">wait</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">notification_text</span>
  <span class="n">wait_until</span> <span class="p">{</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">class</span><span class="p">:</span> <span class="s1">'flash'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span> <span class="p">}</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">class</span><span class="p">:</span> <span class="s1">'flash'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'^a-zA-z !.'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>And lastly, we wire up our test. In it we iterate through each of the user entries in the CSV file and use their data to both complete a login action and verify the notification message.</p>

<p>We <code>rescue</code> the notification message assertion so that when an exception occurs we output it to the screen but make sure the test continues so that all of the data permutations are tried.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="n">user_data</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/login'</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">user</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">user</span><span class="o">[</span><span class="ss">:password</span><span class="o">]</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
    <span class="k">begin</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">notification_text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="n">user</span><span class="o">[</span><span class="ss">:notification_message</span><span class="o">]</span>
    <span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
      <span class="nb">puts</span> <span class="n">e</span><span class="o">.</span><span class="n">message</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<ul>
<li>Parse the CSV file</li>
<li>Iterate over each of the entries found in the CSV file</li>
<li>Load the login page</li>
<li>Complete in the login form using the user data</li>
<li>Assert that the notification message matches what is listed in the user data</li>
<li>Repeat until all user entries are tried</li>
</ul>

<h2>Outro</h2>

<p>Hopefully this tip has helped save you some time by offering up a way to quickly data drive your tests through the use of a CSV file.</p>

<p>Alternatively, you can use spreadsheets of different file types (e.g., Open Office, Excel, and Google Spreadsheets). But CSV is a nice sweet spot since it's simple to construct and doesn't require anything special to use or open and manipulate it by hand.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_20"></a>
<h2>20. How To Chat with the Selenium Community <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/20-irc-chat">http://elementalselenium.com/tips/20-irc-chat</a></h2>
<h3>BEGINNER COMMUNITY</h3>
<h4>#community #ask_questions #get_help #irc</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In your time working with Selenium you've likely run into some stumbling block or issue that's left you Googling for a solution.</p>

<p>Sometimes you find what you need in a forum or blog post somewhere. But there are times you're not so fortunate and you want to find an answer quickly but you're not sure where to turn. Or maybe you've had people tell you to "hop on IRC" but aren't sure what that means or how to do it.</p>

<h2>A Solution</h2>

<p>Go to the heart of the Selenium Community and talk directly with the developers of the Selenium project and other practitioners without ever leaving your house. You can do this by hopping on to the Selenium IRC Chat Channel.</p>

<p>It is a great place to ask questions, find answers, and get pointed in the right direction when you're stuck.</p>

<h2>An IRC Primer</h2>

<p>Internet Relay Chat (IRC) is a protocol that freely enables live chatting both in groups and person-to-person. It's been around for a while (circa 1988) and is the preferred method of communication among certain tech circles.</p>

<p>Within the realm of IRC there are numerous networks you can connect to. Each one contains people and bots logged in and joined to one or more chat rooms talking, sharing files, etc.</p>

<p>One of the beautiful things about IRC is that there is no sign-up required to join the party. You just need to download a client that handles the IRC protocol (there's at least one available for every operating system), point it at a network, and specify a nickname for yourself.</p>

<p>Once you're connected you can join a chat room and start jib-jabbing.</p>

<h2>How To Get Connected</h2>

<h3>Step 1: Get an IRC Chat Client</h3>

<p>First thing's first, get a chat client that supports IRC.</p>

<p>You may already have one and not even know. For example, <a href="https://adium.im/">Adium</a> (for OSX) supports a staggering number of chat protocols. If you already have it (or something like it) then use that to connect. If you don't, then you'll need to grab one.</p>

<p>Here are some worthwhile IRC chat clients (broken out by operating system). They are free unless otherwise noted.</p>

<p><strong>OSX</strong></p>

<ul>
<li><a href="http://limechat.net/mac/">LimeChat</a></li>
<li><a href="http://www.codeux.com/textual/">Textual</a> ($4.99 to buy)</li>
</ul>

<p><strong>Windows</strong></p>

<ul>
<li><a href="http://www.mirc.com/?/">mIRC</a> (free, but asks for donations)</li>
</ul>

<p><strong>Linux</strong></p>

<ul>
<li><a href="http://www.irssi.org/">Irssi</a></li>
</ul>

<p><strong>Web-only</strong></p>

<ul>
<li><a href="http://webchat.freenode.net/">Webchat</a></li>
<li><a href="https://www.irccloud.com/">IRCCloud</a> (free, but premium features available)</li>
</ul>

<h3>Step 2: Connect to the proper server</h3>

<p>The Selenium chat channel lives on the freenode server. To connect to it use <code>irc.freenode.net</code>.</p>

<p>Before connecting you should be able to set a nickname and perhaps even specify which channel you would like to join after connecting (e.g. <code>#selenium</code>). If you don't see these bits, don't sweat it. Connect and proceed to the next step.</p>

<p><strong>NOTE: If you're using Webchat, it will automatically connect you to freenode.</strong></p>

<h3>Step 3: Join the chat channel</h3>

<p>Chat channels in IRC start with a <code>#</code> and are all lower-case. So the Selenium channel is <code>#selenium</code>.</p>

<p>If you were able to configure your chat client to join the channel for you, then proceed to the next step. Otherwise, you'll need to issue a command in the status window after connecting to freenode. There are a series of commands you can issue in IRC. They all start with a <code>/</code>. To join a chat channel type <code>/join #selenium</code> and press <code>Enter</code>.</p>

<p>This will open a new window within the chat application. In it will be the Selenium chat channel. Woohoo!</p>

<h3>Step 4: Talk &amp; Hangout</h3>

<p>Feel free to say hello and introduce yourself. But more importantly, ask your question. And if it looks like no one is chatting, ask it anyway. Someone will see it and eventually respond. They always do.</p>

<p>In order to get your answer, you'll probably want to hang around for a bit. But the benefit of being a fly on the wall in this chat channel is that you quickly gain insight into other Selenium problems people have, possible solutions to them, and the current status of the Selenium project in real time.</p>

<h2>Outro</h2>

<p>Hopefully this tip will help you get more connected with the Selenium Community and find answers to challenges you're facing.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_21"></a>
<h2>21. How To Pick a Programming Language <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/21-choosing-a-language">http://elementalselenium.com/tips/21-choosing-a-language</a></h2>
<h3>BEGINNER STRATEGY</h3>
<h4>#programming_language #frameworks</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In order to work well with Selenium you need to choose a programming language to write your acceptance tests in. Conventional wisdom will tell you to choose the same language as what the application is written in. That way if you get stuck you can ask the Developers on your team for help.</p>

<p>But if you're not proficient in this language (or new to development) then your progress will be slow and you'll likely end up asking for more Developer help than they have time -- hindering your automation efforts and setting you up for failure.</p>

<h2>A Solution</h2>

<p>A great way to determine which language to go with is to answer one simple question: <strong>Who will own the automated tests?</strong></p>

<p>The answer to this, and the discussion that unfolds from it, will help you more effectively choose a programming language for test automation.</p>

<h2>What To Do With The Answer</h2>

<p>If you're a Tester (or a team of Testers) and you will be building and maintaining the test automation, then it's best to consider what languages you (and your team) already have experience with, or are interested in gaining, rather than what the application you're testing is built in. Have a discussion with your team to see what interests them.</p>

<p>For example, there's not much advantage in writing your test automation in Java if your team has no previous development experience and will be the ones owning it. Instead, try to choose a language that is more approachable -- e.g. a scripting language like Ruby or Python. But if you're a Developer that is working on the application and just looking to add automated acceptance testing to the mix then it makes sense to continue with the same language.</p>

<h2>Some Additional Food For Thought</h2>

<p>As your suite of tests grow you will find the need to add functionality to make things easier to use, run faster, offer better reporting, etc. When this happens you will effectively be doing two jobs -- growing a framework (a.k.a. a test harness) and writing automated tests.</p>

<p>As you are considering which language to go with, consider what open source frameworks already exist for the languages you're considering. Going with one will save you a lot of time and give you a host of functionality out of the box that you would otherwise have to build and maintain yourself -- and it's FREE.</p>

<p>You can find a list of open source Selenium WebDriver frameworks and their respective languages (sorted alphabetically) <a href="http://davehaeffner.com/resources/selenium-frameworks/">here</a>.</p>

<h2>Outro</h2>

<p>Choosing a programming language for automated testing is not a decision that should be taken lightly. If you're just starting out (or looking to port your tests) then considering and discussing these things will help position you for greater success.</p>

<p>For a second and third opinion on this topic you can read Adam Goucher and Joe Colantonio's takes <a href="http://sauceio.com/index.php/2015/02/stop-being-a-language-snob-debunking-the-but-our-application-is-written-in-x-myth/">here</a> and <a href="http://www.joecolantonio.com/2015/05/31/selenium-what-programming-language-you-should-learn-to-get-into-test-automation/">here</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_22"></a>
<h2>22. Choosing a Locator Strategy <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/22-locator-strategy">http://elementalselenium.com/tips/22-locator-strategy</a></h2>
<h3>BEGINNER STRATEGY</h3>
<h4>#locators #locator_strategy #css_selectors</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>At the heart of Selenium is the ability to interact with a page through it's elements by way of various locator strategies. Identifier, Id, Name, Link, DOM, XPath, and CSS -- oh my!</p>

<p>This is the life-blood of your automated tests and as you can see there are numerous ones to choose from. But which ones do you use? And when do you use them? And why?</p>

<h2>A Solution</h2>

<p>While each locator strategy serves its purpose there is one approach that is better. One that is cross-browser performant, simpler to maintain, and powerful -- that's CSS Selectors.</p>

<h2>A Quick Primer on CSS Selectors</h2>

<p>In web design CSS (Cascading Style Sheets) is used to apply styles to the markup (HTML) on a page. CSS is able to do this by declaring which bits of the the markup it wants to interact with through the use of selectors. Selenium operates in a similar manner but instead of changing the style of elements it interacts with them by clicking, getting values from, typing, sending keys, etc.</p>

<h2>An Example</h2>

<p>With the following markup (taken from <a href="http://the-internet.herokuapp.com/download">here</a>) we can demonstrate grabbing the first link from a series of links with varying degrees of precision via CSS Selectors.</p>
<div class="highlight"><pre><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"content"</span> <span class="na">class=</span><span class="s">"large-12 columns"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"example"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3&gt;</span>File Downloader<span class="nt">&lt;/h3&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"download/hello-world.pdf"</span><span class="nt">&gt;</span>hello-world.pdf<span class="nt">&lt;/a&gt;&lt;br&gt;</span>
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"download/avatar.jpg"</span><span class="nt">&gt;</span>avatar.jpg<span class="nt">&lt;/a&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</pre></div>

<p>To play along at home here are the setup, teardown, and run actions we will use.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>The way Selenium works is by first finding the element you want and then chaining additional actions to it. So, to grab the first link and output it's URL we can do the following.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/download'</span>
  <span class="n">link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">link</span>
<span class="k">end</span>
</pre></div>

<p>Note the <code>css: a</code>. The <code>css:</code> is us telling Selenium what locator strategy to use, and the <code>a</code> is a selector for a link.</p>

<p>While this works it's far from perfect. Of all the possible links on the page Selenium will return the first one. So, if there were other links aside from the ones listed in the download list, we may not get the result we want. To help this, we can be more precise with our CSS.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/download'</span>
  <span class="n">link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#content a'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">link</span>
<span class="k">end</span>
</pre></div>

<p>Note the <code>css: '#content a'</code>. The <code>#content</code> is a selector for an HTML element with <code>id="content"</code>. With it we are able to chain together the previously used <code>a</code> (separated by spaces) to grab the first link from within the content div on the page. And if we wanted to be more precise we could scope in further.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/download'</span>
  <span class="n">link</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#content .example a'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="n">link</span>
<span class="k">end</span>
</pre></div>

<p>Note the <code>css: '#content .example a'</code>. The <code>.example</code> is a selector for an HTML element with <code>class="example"</code>. With this we are able to get the first link from within the example div which is within the content div.</p>

<p>Alternatively, we could have just scoped into <code>.example a</code>. Either would have worked and for this simple example it doesn't matter. The layout of a page will ultimately influence your CSS Selector decision. The ultimate goal is to find and use unique and reliable selectors that will get you the intended behavior you want for your test.</p>

<p>You can find a full list of CSS Selectors <a href="http://www.w3schools.com/cssref/css_selectors.asp">here</a>.</p>

<h2>How To Find CSS Selectors</h2>

<p>The simplest way to find CSS Selectors is to inspect the elements on a page. The best way to do this is from within your web browser. Fortunately popular browsers of today come pre-loaded with development tools that make this simple to accomplish.</p>

<p>When viewing the page right click on the element you want to interact with and click <strong>Inspect Element</strong>. This will bring up a small window with all of the HTML for the page but zoomed into your selection highlighted. From here you can see if there are unique attributes you can work with (e.g. <code>id</code>, <code>class</code>, etc). And at the bottom of the window a set of selectors will be listed showing you the selector for your selection and a heirarchy of the selectors on the page that lead up to your selection.</p>

<p>From here you should able to construct a CSS Selector to use in a test.</p>

<h2>Outro</h2>

<p>In a perfect world all pages would be written with sound markup and uniquely named bits. But that's more the exception than the rule. So, you will likely find as you dig into automating various sites that things will not be as straightforward as the examples above. And there are some circumstances where you have a selector dialed in but you hit issues with older browsers.</p>

<p>To that end, stay tuned for future tips where we'll cover more advanced CSS Selector techniques and strategies for dealing with older browsers.</p>

<p>Until then, Happy Testing!</p><br>
<hr>
<a name ="tips_23"></a>
<h2>23. How To Test Dynamic Pages <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/23-dynamic-pages">http://elementalselenium.com/tips/23-dynamic-pages</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#dynamic_pages #ajax #javascript #waiting #explicit_waits</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Let's say you want to test some functionality of a web application but it loads things dynamically. You might reach for a hard-coded sleep (that you constantly tweak due to test failures) or you use a blanket timeout (like an <a href="https://code.google.com/p/selenium/wiki/RubyBindings#Implicit_waits">implicit wait</a>) that you likely bump up to address test instabilities as well.</p>

<p>This <em>may</em> work in the short term, but your tests are now slower and leaving you (and your team) feeling like your test automation is on shaky ground -- uncertain of when the next break/fix cycle will happen.</p>

<h2>A Solution</h2>

<p>By using a flexible wait strategy you can easily meet the rigors of testing dynamic web applications.</p>

<p>Thankfully Selenium comes with one built in -- Explicit Waits. With them you specify a timeout and an action. Selenium will repeatedly try that action until it can either complete it successfully (at which point it will move onto the next step of the test), or it will throw a timeout exception (causing your test to error).</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p><strong>NOTE: Our tests will be written against <a href="http://the-internet.herokuapp.com/dynamic_loading">an example</a> from an open-source web application called <a href="https://github.com/tourdedave/the-internet">the-internet</a>. On it there is a <code>Start</code> button that when clicked will trigger a loading bar to appear for 5 seconds. After that time it will disappear and a new element with the text <code>'Hello World!'</code> will appear.</strong></p>

<p>We'll start by requiring our dependent libraries (<code>selenium-webriver</code> to drive the browser and <code>rspec/expectations</code> and <code>RSpec::Matchers</code> to perform our assertions) and wiring up some <code>setup</code>, <code>teardown</code>, and <code>run</code> methods to handle our test configuration.</p>
<div class="highlight"><pre><span class="c1"># filename: dynamic_loading.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now we can create our first test. In it we'll visit the page, click the start button, wait for the finish text to appear, and assert that it appeared.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dynamic_loading/2'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#start button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">timeout</span><span class="p">:</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'finish'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span> <span class="p">}</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'finish'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>

<p>In the code above we are using an explicit wait with a timeout of 6 seconds (e.g. <code>Selenium::WebDriver::Wait.new(timeout: 6).until</code>), looking for the element with the finish text (e.g., <code>@driver.find_element(id: 'finish')</code>, and seeing if it's displayed (e.g., <code>.displayed?</code>).</p>

<p>If we set the timeout too low (e.g. <code>timeout: 2</code>) Selenium won't wait long enough for the loading bar to finish, which will trigger the timeout threshold and throw an exception (e.g. <code>until': timed out after 2 seconds (Selenium::WebDriver::Error::TimeOutError)</code>).</p>

<p>And if we didn't use an explicit wait at all, the test would have errored because Selenium would have tried to check for the finish text before it displayed and return a <code>NoSuchElement</code> exception (e.g., <code>Unable to locate element: {"method":"css selector","selector":"#finish"} (Selenium::WebDriver::Error::NoSuchElementError)</code>).</p>

<p>For applications that already have the target element on the page but have it hidden, this approach will work as well.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dynamic_loading/1'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#start button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">timeout</span><span class="p">:</span> <span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'finish'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span> <span class="p">}</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'finish'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>

<h2>A Small Bit of Cleanup</h2>

<p>Explicit waits are a useful tool to have in your toolbelt since they enable you to finely tune your tests and avoid static sleeps and arbitrary timeouts. But rather than litter your test code with the verbose Selenium incantation, it's best to pull this code out into a method that accepts a timeout argument and the action you want to wait for as a block.</p>

<p>We can then clean up our test code and reuse this method whenever we need to use an explicit wait.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">seconds</span> <span class="o">=</span> <span class="mi">6</span><span class="p">)</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dynamic_loading/1'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#start button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="n">wait_for</span> <span class="p">{</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'finish'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span> <span class="p">}</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'finish'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Click the Start button</li>
<li>Wait for the loading bar to disappear and display the finish text</li>
<li>Assert that the finish text element is displayed</li>
</ul>

<h2>Outro</h2>

<p>Hopefully this tip will help you build more efficient and resilient tests when faced with dynamic pages that are constructed in various ways.</p>

<p>If you want to take the idea of abstraction a bit further then have a look at tips <a href="http://elementalselenium.com/tips/9-use-a-base-page-object">9</a> and <a href="http://elementalselenium.com/tips/28-upgrading-from-rc">28</a> where this kind of abstraction is covered in more detail. And if you want more insight into the differences between implicit and explicit waits, check out <a href="http://elementalselenium.com/tips/47-waiting">tip 47</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_24"></a>
<h2>24. Fast and Reliable Test Setup with REST Ap Is <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/24-rest-apis">http://elementalselenium.com/tips/24-rest-apis</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#rest_apis #test_setup #guest_post</h4>
<hr width="40%" align="left">
<p><strong>Note: This is a guest post from Robert Schultheis, a Test Engineer at <a href="http://www.knewton.com/">Knewton</a> who is doing great things with REST APIs in his testing practice.</strong></p>

<h2>The Problem</h2>

<p>When we list out the properties that make a test a "good test", some of things that often come up are:</p>

<ul>
<li>Precise. The test should test one thing, and one thing only. A bug in some part of the application that is unrelated to the test should not cause the test to fail.</li>
<li>Independent. A test should not have it's outcome affected by any other test in the test suite.</li>
<li>Fast. This doesn't need much explanation. The quicker a test suite runs, the more useful it is.</li>
</ul>

<p>Of course there are many other properties that might be included in such a list, but I mention these specifically because they can be particularly challenging to achieve in a Selenium test suite. The reason for this is that Selenium tests often involve setups that may include a sign-up, a login, some navigation, form submission, or other interactions with a website. Only after doing those things are you ready to assert on some aspect of the website.  If you confine your tests to only being allowed to interact with the website, there is little that can be done to alleviate this issue.</p>

<h2>A Solution</h2>

<p>REST APIs are increasingly common in the backends of newer websites. If you are fortunate enough to have such an architecture in the site you are testing it may make sense to make use of those REST APIs in your Selenium test suite. By using calls to the REST APIs in the backend to perform parts of a test setup, and using Selenium to perform the assertion within the website normally, we can end up with tests that are faster, more focused, and more reliable.</p>

<p>REST APIs are based on the HTTP protocol, which is the same protocol that powers essentially the entire internet.  Nearly every modern programming language has libraries that can be used to make HTTP requests, thus we can add support for calling into REST APIs to virtually any test suite.</p>

<h1>An Example</h1>

<p>I decided to pick an example that is nearly ubiquitous: sign-up. When we make a new user for a test, we have a "clean slate" which allows us great control over how to shape that user for our test. We eliminate possible corruption of our test user's state from other tests. And if we make that user using a REST API call, we avoid the time penalty of having to fill out a sign-up form (not to mention having to find any emails involved in confirming an email address).</p>

<p>Suppose our hypothetical website is backed by a REST API, and it documents a call to create a user as follows:</p>

<p><code>POST http://api.myfakeapp.com/v1/create-user</code></p>

<p>This call takes a JSON request body, and creates a user.</p>
<div class="highlight"><pre><span class="p">{</span>
  <span class="s1">'username'</span><span class="o">:</span>   <span class="s1">'example-username'</span><span class="p">,</span>
  <span class="s1">'password'</span><span class="o">:</span>   <span class="s1">'abcd1234'</span><span class="p">,</span>
  <span class="s1">'email'</span><span class="o">:</span>      <span class="s1">'bob@example.com'</span><span class="p">,</span>
  <span class="s1">'first_name'</span><span class="o">:</span> <span class="s1">'bob'</span><span class="p">,</span>
  <span class="s1">'last_name'</span><span class="o">:</span>  <span class="s1">'example'</span>
<span class="p">}</span>
</pre></div>

<p>That tells us we will have to send an <code>HTTP POST</code> request to the URL <code>/v1/create-user</code>, with a JSON object body that has valid values for all of the fields shown. If this all sounds scary, it might help to know that this is more-or-less what your browser does when you submit a form. In this case though, we are going to do it sans-browser.</p>

<p>The following module has a <code>create_test_user</code> method which we will incorporate into our test setups. It contains some helpful inline comments that describe each of the actions being taken.</p>
<div class="highlight"><pre><span class="c1"># filename: rest_api_interface.rb</span>

<span class="nb">require</span> <span class="s1">'net/http'</span>
<span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'securerandom'</span>

<span class="k">module</span> <span class="nn">RestApiInterface</span>

  <span class="no">Headers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'content-type'</span> <span class="o">=&gt;</span> <span class="s1">'application/json'</span><span class="p">,</span>
    <span class="s1">'user-agent'</span> <span class="o">=&gt;</span> <span class="s1">'Rest Api Helper'</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="k">def</span> <span class="nf">post_to_api</span> <span class="n">path</span><span class="p">,</span> <span class="n">post_body_obj</span>
    <span class="n">json_body</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">post_body_obj</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="kp">nil</span>
    <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">'api.myfakeapp.com'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
      <span class="n">response</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">json_body</span><span class="p">,</span> <span class="no">Headers</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">response</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create_test_user</span>
    <span class="c1"># Step 1: Build the user parameters randomly</span>
    <span class="n">random_test_user</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">'username'</span>   <span class="o">=&gt;</span> <span class="n">random_string</span><span class="p">,</span>
      <span class="s1">'password'</span>   <span class="o">=&gt;</span> <span class="n">random_string</span><span class="p">,</span>
      <span class="s1">'email'</span>      <span class="o">=&gt;</span> <span class="s2">"</span><span class="si">#{</span><span class="n">random_string</span><span class="si">}</span><span class="s2">@testing.com"</span><span class="p">,</span>
      <span class="s1">'first_name'</span> <span class="o">=&gt;</span> <span class="s1">'test'</span><span class="p">,</span>
      <span class="s1">'last_name'</span>  <span class="o">=&gt;</span> <span class="s1">'user'</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Step 2: Execute the API call</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">post_to_api</span> <span class="s1">'/v0/oauth/create-profile'</span><span class="p">,</span> <span class="n">random_test_user</span>

    <span class="c1"># Step 3: Ensure the api call returned a success code</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">code</span> <span class="o">!=</span> <span class="s1">'200'</span>
      <span class="k">raise</span> <span class="s1">'User creation failed'</span>
    <span class="k">end</span>

    <span class="c1"># Final Step: Return the user object so we can use it</span>
    <span class="n">random_test_user</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">random_string</span>
    <span class="c1"># This is an easy way to get a good randomized string</span>
    <span class="no">SecureRandom</span><span class="o">.</span><span class="n">hex</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>With this we are now ready to make, and then use, test users from within our Selenium code.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rest_api_interface'</span>
<span class="kp">include</span> <span class="no">RestApiInterface</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="vi">@user</span> <span class="o">=</span> <span class="n">create_test_user</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">login</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://myfakeapp.com'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="s1">'input[name="username"]'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="vi">@user</span><span class="o">[</span><span class="s1">'username'</span><span class="o">]</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="s1">'input[name="password"]'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="vi">@user</span><span class="o">[</span><span class="s1">'password'</span><span class="o">]</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="s1">'button[name="login"]'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="n">login</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>With support code like the above, we are free to write code that can assume we are logged in with a clean user. Like the following (which will output the user that is logged in).</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:css</span><span class="p">,</span> <span class="s1">'#user_id'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="k">end</span>
</pre></div>

<h2>Going beyond signups</h2>

<p>This technique of mixing in REST API calls with your Selenium code is very powerful. Admittedly, the example given is easy to criticize. Signing up a fresh user for every test is probably not an appropriate strategy for many sites. Further, the example does not get around having to login. Once the mechanics of this kind of interaction are in place however, it becomes possible to setup many kind of resources and relationships between them using REST API calls.</p>

<p>I used to work for an organization that ran highly specialized markets, with several configuration options, as well as different kinds of users including buyers and sellers. I used this technique to build test markets through all permutations of configuration with test buyers and sellers. My Selenium tests would then simply visit the test markets as the test buyers and sellers and confirm the expected features were available.This allowed my tests to provide both a high level of coverage while staying fast, precise, and wholly self-contained.</p>

<h2>Testing against REST only</h2>

<p>Once you've gotten used to using REST APIs to create test data fast, there is a question that naturally pops up: "Why not just test against the REST API itself, without using Selenium?"</p>

<p>Indeed, there are many great reasons to consider pure REST API tests to supplement a Selenium test suite. When compared to Selenium tests, pure REST API tests are:</p>

<ul>
<li>Extremely fast</li>
<li>Extremely reliable</li>
<li>Easier to build higher levels of test coverage</li>
<li>Simpler execution architecture.</li>
<li>More encouraging of testable design in the application</li>
</ul>

<p>REST API tests are very appropriate for exercising the business logic that powers an application. Of course they leave a lot of important parts of the application untested including Javascript within the website, thus they should never be considered a complete Selenium replacement.</p>

<p><strong>Note: Given the ever increasing important of mobile applications, I believe special mention concerning the testing of a mobile application is important here. There are several Selenium like tools for mobile testing out there, but the landscape is still quite immature. Fortunately, the majority of most mobile applications are in fact backed by a REST API. Pure REST API testing should be considered an important component of any test plan for every mobile application!</strong></p>

<h2>Outro</h2>

<p>When considering how to make your Selenium suite have higher coverage, run faster, and be more reliable, it is often worth looking beyond Selenium for solutions to these common problems. REST APIs are becoming very common and provide a relatively easy means for creating test data which Selenium tests can make use of. REST APIs can in fact be a powerful way to test an application all by themselves.</p>

<h2>About the Author</h2>

<p>Robert Schultheis is a Test Engineer for <a href="http://www.knewton.com/">Knewton</a>, a company devoted to personalizing education for every student globally.  He recently gave <a href="http://www.youtube.com/watch?v=WIMF7Nc1sbY">a talk</a> with more details about using REST APIs for testing and beyond.  And he has released a Ruby gem known as <a href="https://github.com/Knewton/grifter">Grifter</a> which allows for the creation of DSLs for interacting with REST APIs easily.</p>

<p>Robert wishes to express his gratitude to Dave for allowing him a chance to author this guest post, and wishes "Happy Testing" to all Elemental Selenium readers.</p><br>
<hr>
<a name ="tips_25"></a>
<h2>25. How To Work with Tables <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/25-tables">http://elementalselenium.com/tips/25-tables</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#tables #sorting #css_selectors #css_pseudo-classes</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Odds are at some point you've come across the use of tables in a web application to display data or information to a user, giving them the option to sort and manipulate it. Depending on your application it can be quite common and something you will want to write an automated test for.</p>

<p>But when the table has no helpful, semantic markup (e.g. <code>id</code> or <code>class</code> attributes) it quickly becomes more difficult to work with and write tests against. And if you're able to pull something together, it will likely not work against older browsers.</p>

<h2>A Solution</h2>

<p>You can easily traverse a table through the use of CSS Pseudo-classes.</p>

<p>But keep in mind that if you care about older browsers (e.g., Internet Explorer 8), then this approach won't work on them. In those cases your best bet is to find a workable solution for a short term fix and get your front-end developer(s) to update the table with helpful attributes for a long term solution.</p>

<h2>A quick primer on Tables and CSS Pseudo-classes</h2>

<p>Understanding the broad strokes of an HTML table's structure goes a long way in writing effective automation against it. So here's a quick primer.</p>

<p>A table has...</p>

<ul>
<li>a header (e.g. <code>&lt;thead&gt;</code>)</li>
<li>a body (e.g. <code>&lt;tbody&gt;</code>).</li>
<li>rows (e.g. <code>&lt;tr&gt;</code>) -- horizontal slats of data</li>
<li>columns -- vertical slats of data</li>
</ul>

<p>Columns are made up of cells which are represented as...</p>

<ul>
<li><code>&lt;th&gt;</code> in a header</li>
<li><code>&lt;td&gt;</code> in a body (also known as <strong>table data</strong>)</li>
</ul>

<p>CSS Pseudo-classes work by walking through the structure of an object and targeting a specific part of it based on a relative number (e.g. the <strong>third</strong> <code>&lt;td&gt;</code> cell from a row in the table body). This works well with tables since we can couple it with Selenium to grab all instances of a target (e.g. the third <code>&lt;td&gt;</code> cell from each <code>&lt;tr&gt;</code> in the table body) -- which would give us all of the data for the third column.</p>

<p>Let's dig in with an example for a common set of table functionality -- sorting columns in ascending and descending order.</p>

<h2>An Example</h2>

<p><strong>NOTE: You can see the application under test <a href="http://the-internet.herokuapp.com/tables">here</a>. There are 2 tables. We will start with Example 1 and then work with Example 2</strong></p>

<p>We kick things off by requiring our dependent libraries (<code>selenium-webriver</code> to drive the browser and <code>rspec/expectations</code> and its matchers to handle our assertions) and wiring up our <code>setup</code>, <code>teardown</code>, and <code>run</code> helper methods to abstract our test configuration.</p>
<div class="highlight"><pre><span class="c1"># filename: table_sort.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Here is a snippet from the first table we are working with. Note that it does not have any <code>id</code> or <code>class</code> attributes.</p>
<div class="highlight"><pre><span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"table1"</span> <span class="na">class=</span><span class="s">"tablesorter"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Last Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>First Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Email<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Due<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Web Site<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span&gt;</span>Action<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td&gt;</span>Smith<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>John<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>jsmith@gmail.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>$50.00<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>http://www.jsmith.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#edit'</span><span class="nt">&gt;</span>edit<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#delete'</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
</pre></div>

<p>There are 6 columns (<code>Last Name</code>, <code>First Name</code>, <code>Email</code>, <code>Due</code>, <code>Web Site</code>, and <code>Action</code>). Each one is sortable. The first click will sort them in ascending order, the second click in descending order.</p>

<p>And there is a small sampling of data in the table to work with (4 rows worth), so we should be able to sort the data, grab it, and confirm that it actually sorted correctly. So let's do that in our first test with the <code>Due</code> column using a CSS Pseudo Class.</p>
<div class="highlight"><pre><span class="c1"># ...</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(4)'</span><span class="p">)</span>
  <span class="n">due_values</span> <span class="o">=</span> <span class="n">dues</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'$'</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>

  <span class="n">expect</span><span class="p">(</span><span class="n">due_values</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span>
<span class="k">end</span>
</pre></div>

<p>After loading to the page we find and click the column heading that we want with a CSS Pseudo-class (e.g. <code>#table1 thead tr th:nth-of-type(4)</code>) which is effectively saying 'give me the 4th <code>th</code> element in the table heading' (which is the <code>Due</code> column heading).</p>

<p>We then use another pseudo-class to find all <code>&lt;td&gt;</code> elements within the <code>Due</code> column by looking for the 4th <code>&lt;td&gt;</code> of each row in the table body.</p>

<p>Once we have them we clean them up (<code>.delete($)</code>), convert them to a number (<code>.to_f</code>) and store them in a collection called <code>due_values</code>. We then compare this collection to a sorted version of itself to see if they match. If they do, then the <code>Due</code> column was sorted in ascending order and the test will pass.</p>

<p>If we wanted to test for descending order, we would need to click the <code>Due</code> heading twice after loading the page. Other than that, the code is identical except for the assertion which is checking the same thing but reversing the sort order.</p>
<div class="highlight"><pre><span class="c1"># ...</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(4)'</span><span class="p">)</span>
  <span class="n">due_values</span> <span class="o">=</span> <span class="n">dues</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'$'</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>

  <span class="n">expect</span><span class="p">(</span><span class="n">due_values</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">reverse</span>
<span class="k">end</span>
</pre></div>

<p>We can easily expand our sort check to a different column (e.g., one that doesn't deal with numbers) and see that it gets sorted correctly too. So let's focus on the <code>Email</code> column.</p>
<div class="highlight"><pre><span class="c1"># ...</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(3)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">emails</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(3)'</span><span class="p">)</span>
  <span class="n">email_values</span> <span class="o">=</span> <span class="n">emails</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">email</span><span class="o">|</span> <span class="n">email</span><span class="o">.</span><span class="n">text</span> <span class="p">}</span>

  <span class="n">expect</span><span class="p">(</span><span class="n">email_values</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="n">email_values</span><span class="o">.</span><span class="n">sort</span>
<span class="k">end</span>
</pre></div>

<p>The mechanism for this is the same except that we don't need to clean the text up or convert it before performing our assertion.</p>

<h2>But What About Older Browsers?</h2>

<p>So, now we have working tests that will load the page and check sorting for a couple of columns in both ascending and descending order. Great! But if we run these again an older browser (like Internet Explorer 8) it will throw an exception stating <code>Unable to find element</code>. This is because older browsers don't support CSS Pseudo-classes.</p>

<p>You've come a long way, so it's best to get value out of what you've just written. To do that you can run these tests on <strong>current browsers</strong>, submit a request to your front-end developers to update the table markup with some semantic <code>class</code> attributes, and later update these tests to use these new locators once the developer updates have been implemented.</p>

<p>Here is a snippet of what our original table would look like with helpful attributes added in.</p>
<div class="highlight"><pre><span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"table2"</span> <span class="na">class=</span><span class="s">"tablesorter"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'last-name'</span><span class="nt">&gt;</span>Last Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'first-name'</span><span class="nt">&gt;</span>First Name<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'email'</span><span class="nt">&gt;</span>Email<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'dues'</span><span class="nt">&gt;</span>Due<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'web-site'</span><span class="nt">&gt;</span>Web Site<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
        <span class="nt">&lt;th&gt;&lt;span</span> <span class="na">class=</span><span class="s">'action'</span><span class="nt">&gt;</span>Action<span class="nt">&lt;/span&gt;&lt;/th&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'last-name'</span><span class="nt">&gt;</span>Smith<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'first-name'</span><span class="nt">&gt;</span>John<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'email'</span><span class="nt">&gt;</span>jsmith@gmail.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'dues'</span><span class="nt">&gt;</span>$50.00<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'web-site'</span><span class="nt">&gt;</span>http://www.jsmith.com<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;td</span> <span class="na">class=</span><span class="s">'action'</span><span class="nt">&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#edit'</span><span class="nt">&gt;</span>edit<span class="nt">&lt;/a&gt;</span>
          <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">'#delete'</span><span class="nt">&gt;</span>delete<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
</pre></div>

<p><strong>NOTE: This is the second example table on our application under test.</strong></p>

<p>With these selectors our sorting tests become a lot simpler and more expressive. Let's take our previous <code>Due</code> ascending example and write a new test to demonstrate.</p>
<div class="highlight"><pre><span class="c1"># ...</span>
<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 thead .dues'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 tbody .dues'</span><span class="p">)</span>
  <span class="n">due_values</span> <span class="o">=</span> <span class="n">dues</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">'$'</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>

  <span class="n">expect</span><span class="p">(</span><span class="n">due_values</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span>
<span class="k">end</span>
</pre></div>

<p>Not only will these selectors work in both current and older browsers, but they are more resilient to changes in the table column order since they are not order specific values any more.</p>

<h2>Expected Behavior</h2>

<p>If you save this file and run it (e.g., <code>ruby table_sort.rb</code> from the command-line) four different tests would run, and here is what they would do:</p>

<ul>
<li>Open the browser</li>
<li>Load the page</li>
<li>Click the column heading</li>
<li>Grab the values for that column</li>
<li>Assert that they are sorted in the correct order (ascending or descending)</li>
<li>Close the browser</li>
</ul>

<h2>Outro</h2>

<p>CSS Pseudo-classes are a great resource and unlock a lot of potential for your tests -- enabling a bit of CSS gymnastics (assuming you've <a href="http://elementalselenium.com/tips/18-what-to-test">come up with an automation strategy</a> that rules out older browsers).</p>

<p>For more info on CSS Pseudo-classes you should check out <a href="http://sauceio.com/index.php/2010/01/selenium-totw-css-selectors-in-selenium-demystified/">a nice write-up by Sauce Labs</a>. And maybe <a href="http://www.w3.org/TR/css3-selectors/#structural-pseudos">the W3C spec</a> if you're feeling adventurous. For a more in-depth walk-through on HTML Table design you can check out Treehouse's write-up <a href="http://blog.teamtreehouse.com/how-to-code-sortable-tabular-data-with-jquery">here</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_26"></a>
<h2>26. How To Run Your Tests In the Cloud <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/26-cloud">http://elementalselenium.com/tips/26-cloud</a></h2>
<h3>BEGINNER INFRASTRUCTURE</h3>
<h4>#sauce_labs #test_infrastructure #to_the_cloud</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>If you've ever needed to test features in an older browser like Internet Explorer 6 then odds are you ran a virtual machine (VM) on your computer with a "legit" version of Windows XP.</p>

<p>Handy, but what happens when you need to check things on multiple versions of IE? Now you're looking at multiple VMs. And what about when you need to scale and cover other browser and Operating System (OS) combinations?</p>

<p>Now you're looking at provisinioning, running, and maintaining your own farm of machines and standing up something like Selenium Grid to coordinate tests across them.</p>

<p>And all you wanted to do was run your tests on the browsers you cared about...</p>

<h2>A Solution</h2>

<p>Rather than take on the overhead of a test infrastructure you can easily outsource things to a third-party cloud provider.  There are a handful of players in this space, but there's one that stands out -- Sauce Labs.</p>

<h2>Why Sauce Labs?</h2>

<p>They don't stand out because they enable you to run your tests on pretty much every browser/OS/platform combination. Or because they have great test reporting (like video recordings of your tests). Or for any of the other <a href="https://saucelabs.com/features">killer features they have</a>.</p>

<p>They stand out because they're not just building something to sell. They work hard to help make the Selenium Community (and open source software) better. And it's through their contributions that they are able to discern what to build -- so it's something that is attune with the needs of the community.</p>

<h2>A brief primer on Selenium Remote, Selenium Grid, and Sauce Labs</h2>

<p>At the heart of Selenium at scale is the use of Selenium Grid and Selenium Remote. Selenium Grid lets you distribute test execution across several machines and you connect to it with Selenium Remote -- specifying the browser type and version through the use of Selenium Remote's <code>Capabilities</code>.</p>

<p>This is fundamentally how Sauce Labs works. Behind the curtain they are ultimately running Selenium Grid, and they receive and execute your tests through Selenium Remote -- knowing which browser and operating system to use because of the <code>Capabilities</code> specified.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p><strong>NOTE: You'll need an account to use Sauce Labs. Their free one offers enough to get you started. And if you're signing up because you want to test an open source project, then give <a href="https://saucelabs.com/opensauce">their 'Open Sauce' account</a> a look.</strong></p>

<p>First we include our dependent libraries (<code>selenium-webdriver</code> to drive the browser and <code>rspec-expectations</code> to perform assertions), and wire up our setup, teardown, and run actions.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="n">caps</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Capabilities</span><span class="o">.</span><span class="n">firefox</span>
  <span class="n">caps</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s2">"23"</span>
  <span class="n">caps</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s2">"Windows XP"</span>
  <span class="n">caps</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">=</span> <span class="s2">"Testing Selenium 2 with Ruby on Sauce"</span>

  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
    <span class="ss">:remote</span><span class="p">,</span>
    <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">"http://SAUCE_USERNAME:SAUCE_API_KEY@ondemand.saucelabs.com:80/wd/hub"</span><span class="p">,</span>
    <span class="ss">:desired_capabilities</span> <span class="o">=&gt;</span> <span class="n">caps</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>In <code>setup</code> we create an instance of Selenium Remote's Capabilities -- specifying that we want to use Firefox, and storing it in a variable. We then set the browser version (e.g. Firefox 23), specify the operating system we would like to use (e.g. Windows XP), and set the test name.</p>

<p>We then create a Selenium Remote object -- specifying our test execution end-point (e.g. Sauce Labs -- replace <code>SAUCE_USERNAME</code> and <code>SAUCE_API_KEY</code> with your account's to try it out) and feeding in the capabilities we configured.</p>

<p>If you wanted to change up the browser, you would just need to alter the Capabilities slightly -- like so</p>
<div class="highlight"><pre>  <span class="c1"># For Internet Explorer 7</span>
  <span class="n">caps</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Capabilities</span><span class="o">.</span><span class="n">internet_explorer</span>
  <span class="n">caps</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s2">"7"</span>
</pre></div>

<p>Or...</p>
<div class="highlight"><pre>  <span class="c1"># For Chrome 28</span>
  <span class="n">caps</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Capabilities</span><span class="o">.</span><span class="n">chrome</span>
  <span class="n">caps</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s1">'28'</span>
</pre></div>

<p><strong>NOTE: You can find a full list of configuration options along with example code for every language <a href="https://saucelabs.com/docs/platforms/webdriver">here</a></strong></p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">wait_for</span>
  <span class="k">begin</span>
    <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
  <span class="k">rescue</span> <span class="no">NoSuchElementException</span>
    <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">wait_for</span> <span class="p">{</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#content'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span> <span class="p">}</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'The Internet'</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>

<p>Lastly we create an explicit wait helper action and wire up our test (which is effectively just a 'Hello World!').</p>

<p>You can see the final result in Sauce Labs <a href="https://saucelabs.com/tests/d68be19c691b4d03a024c82eaeba7cfb">here</a>.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Fire up a browser in Sauce Labs</li>
<li>Navigate to the page</li>
<li>Wait for the content body to become visible</li>
<li>Assert the page title is correct</li>
<li>Generate a consolidated report for the test</li>
</ul>

<h2>Outro</h2>

<p>Hopefully this tip will help you get your tests running against those hard to reach browsers.</p>

<p>Stay tuned for future tips where we'll dig a little deeper and cover how to test applications that are behind a firewall and speed things up with parallelization.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_27"></a>
<h2>27. How To Speed Up Your Tests with Parallelization <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/27-parallel">http://elementalselenium.com/tips/27-parallel</a></h2>
<h3>INTERMEDIATE PERFORMANCE</h3>
<h4>#parallelization #good_test_writing</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Compared to Unit and Integration Tests, Selenium is slow. A single test can easily take minutes to run. And when you have a lot of them, it can quickly compound your suite to take hours to complete (just for a single browser) -- hampering your ability to get fast feedback.</p>

<h2>A Solution</h2>

<p>Rather than run your tests in series (which is what you get out of the box with Selenium) you can dramatically speed things up by running them in parallel. Couple this with <a href="http://elementalselenium.com/tips/26-cloud">the ability to run your tests in any browser</a> and you're on to some solid footing with your test automation.</p>

<p>But keep in mind that doing this requires some consideration into how you structure your tests, but the pay off is well worth the effort.</p>

<h2>A brief primer on Good Test Writing</h2>

<p>In order to write tests that work well in parallel there are some simple guidelines to follow:</p>

<ul>
<li>Write atomic and autonomous tests</li>
<li>Group like tests together in small batches</li>
<li>Be descriptive</li>
<li>Use a Test Runner</li>
</ul>

<h3>Atomic &amp; Autonomous Tests</h3>

<p>Each test needs to be concise (e.g. testing a single feature rather than multiple features) and be able to be run independently (e.g. sets up it's own data rather than relying on a previous test to do it). Doing this may require a mental shift, discipline, and more up front effort. But <strong>it will make a dramatic impact on the quality, effectiveness, and maintainability of your tests</strong>.</p>

<h3>Grouping Tests</h3>

<p>As your test suite grows you should have multiple test files, each containing a small grouping of tests broken out by functionality that they're exercising. This will go a long way towards organization and maintenance as your test suite grows -- as well as faster execution times (depending on your approach to parallelization).</p>

<h3>Being Descriptive</h3>

<p>Each test file should be named appropriately, and each test within it should have an informative name (even if it may be a bit verbose). Also, each test (or grouping of tests) should be tagged for flexible execution later (e.g. on a Continuous Integration server).</p>

<p>This way you can run parts of your test suite as needed, and the results will be informative thanks to helpful naming.</p>

<h3>Test Runners</h3>

<p>At the heart of every testing framework is a test runner that does a lot of the heavy lifting (e.g. test group execution, easy global configuration for setup and teardown, reporting, etc.). So rather than reinvent the wheel, you can use one of the many that already exists (there's more than one for every language). And with it you can bolt on third party libraries to extend it's functionality if there's something missing -- like parallelization.</p>

<h2>An Example</h2>

<p><strong>NOTE: For this example we will be using <a href="http://rspec.info/">RSpec</a> as the Test Runner and <a href="https://github.com/grosser/parallel_tests">parallel-tests</a> for parallelization.</strong></p>

<p>In RSpec, test files are referred to as 'specs'. So for our initial spec I've used the test code from <a href="http://elementalselenium.com/tips/25-tables">a previous tip on working with Data Tables</a>. Don't get too distracted by what the test steps are doing, the organization and naming of things is more important for this example.</p>
<div class="highlight"><pre><span class="c1"># data_table_sorting_spec.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="n">describe</span> <span class="s1">'Data Table Sorting'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">'Without Attributes'</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s1">'in Ascending Order'</span> <span class="k">do</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(4)'</span><span class="p">)</span>
      <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
      <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span> <span class="p">}</span>
      <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'in Descending Order'</span> <span class="k">do</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(4)'</span><span class="p">)</span>
      <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
      <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span> <span class="p">}</span>
      <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">false</span>
    <span class="k">end</span>

  <span class="k">end</span>

  <span class="n">context</span> <span class="s1">'With Attributes'</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s1">'in Ascending Order'</span> <span class="k">do</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 thead .dues'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 tbody .dues'</span><span class="p">)</span>
      <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
      <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>
      <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'in Descending Order'</span> <span class="k">do</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 thead .dues'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 thead .dues'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 tbody .dues'</span><span class="p">)</span>
      <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
      <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>
      <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">false</span>
    <span class="k">end</span>

  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>At the top of the file we include our dependent library (<code>selenium-webdriver</code>) and declare the name of our test group ('Sort Data Table') with a <code>describe</code> statement. We then wire up our before and after actions which are responsible for setting up and tearing down an instance of Selenium for each test. Each of our tests are grouped into logical separations using <code>context</code> blocks and defined within an <code>it</code> block.</p>

<p>If we run this (e.g. with the command <code>rspec data_table_sorting_spec.rb</code>) it will fire up one browser at a time until each test is completed. And If we download, install, and run it through <a href="https://github.com/grosser/parallel_tests">parallel_tests</a> (e.g. with the command <code>paralell_rspec data_table_sorting_spec.rb</code>) -- the same thing would happen. Why? Because parallel_tests executes things at the file level rather than at the individual test level (this holds true even when running tests by tag).</p>

<p>In order to take advantage of parallelization we will need to break these tests up into different files.</p>

<p>But before we do that we can simplify our test code by abstracting out our setup and teardown actions into a central place (known as a <code>spec_helper</code> in the RSpec parlance).</p>
<div class="highlight"><pre><span class="c1"># spec_helper.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>Now that we have that we can create a new spec file and place some of our tests in it.</p>
<div class="highlight"><pre><span class="c1"># data_table_sorting_with_attributes_spec.rb</span>

<span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">describe</span> <span class="s1">'Sort Data Table'</span> <span class="k">do</span>

  <span class="n">context</span> <span class="s1">'With Attributes'</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s1">'in Ascending Order'</span> <span class="k">do</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 thead .dues'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 tbody .dues'</span><span class="p">)</span>
      <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
      <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>
      <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'in Descending Order'</span> <span class="k">do</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 thead .dues'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 thead .dues'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table2 tbody .dues'</span><span class="p">)</span>
      <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
      <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_f</span> <span class="p">}</span>
      <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">false</span>
    <span class="k">end</span>

  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>Notice that the require statement has changed from <code>selenium-webdriver</code> to <code>spec_helper</code>. Since we abstracted things out into a spec_helper file we now need to require it in all of our specs -- and the dependent libraries for our test suite live there instead.</p>
<div class="highlight"><pre><span class="c1"># data_table_sorting_without_attributes_spec.rb</span>

<span class="nb">require</span> <span class="s1">'spec_helper'</span>

<span class="n">describe</span> <span class="s1">'Sort Data Table'</span> <span class="k">do</span>

  <span class="n">context</span> <span class="s1">'Without Attributes'</span> <span class="k">do</span>

    <span class="n">it</span> <span class="s1">'in Ascending Order'</span> <span class="k">do</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(4)'</span><span class="p">)</span>
      <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
      <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span> <span class="p">}</span>
      <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">true</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s1">'in Descending Order'</span> <span class="k">do</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/tables'</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 thead tr th:nth-of-type(4)'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
      <span class="n">dues</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#table1 tbody tr td:nth-of-type(4)'</span><span class="p">)</span>
      <span class="n">due_values</span> <span class="o">=</span> <span class="o">[]</span>
      <span class="n">dues</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">due</span><span class="o">|</span> <span class="n">due_values</span> <span class="o">&lt;&lt;</span> <span class="n">due</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\$/</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">to_i</span> <span class="p">}</span>
      <span class="p">(</span><span class="n">due_values</span> <span class="o">==</span> <span class="n">due_values</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="kp">false</span>
    <span class="k">end</span>

  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>To get this last file we could have renamed the original test file, or created it anew and deleted the original.</p>

<p>Notice that the <code>describe</code> name is the same between test files (e.g. 'Sort Data Table'). In RSpec names do not need to be unique, and these tests logically fit together, this is a welcome consistency.</p>

<p>Now when we run our tests through parallel<em>tests we get concurrent test runs with two browsers firing at the same time, yielding (in this case) roughly a 30% drop in execution times (e.g. 17 seconds down to 12 seconds). You can easily up the number of processes being run as a command-line argument (e.g. <code>-n 5</code>). But this will only make a difference as you have more specs given how parallel</em>tests groups and executes things.</p>

<p>Now that we have a working example that runs concurrently, we can point it at a cloud offering like Sauce Labs, and have access to any browser we want. We just have to update our setup action in the <code>spec_helper</code>.</p>

<p><strong>NOTE: This was covered in a previous tip. For a full write-up, go <a href="http://elementalselenium.com/tips/26-cloud">here</a>.</strong></p>
<div class="highlight"><pre><span class="c1"># spec_helper.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">caps</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Capabilities</span><span class="o">.</span><span class="n">firefox</span>
    <span class="n">caps</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="s2">"23"</span>
    <span class="n">caps</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s2">"Windows XP"</span>
    <span class="n">caps</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">metadata</span><span class="o">[</span><span class="ss">:full_description</span><span class="o">]</span>

    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
      <span class="ss">:remote</span><span class="p">,</span>
      <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">"http://SAUCE_USERNAME:SAUCE_API_KEY@</span>
<span class="s2">        ondemand.saucelabs.com:80/wd/hub"</span><span class="p">,</span>
      <span class="ss">:desired_capabilities</span> <span class="o">=&gt;</span> <span class="n">caps</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>Now when we run our tests with parallel_tests we can see the concurrent execution happening in Sauce Labs.</p>

<p>Sauce Labs is built to handle your tests concurrently, so you should be able to turn the number of processes up with no sweat. You will just need to be cogniscent of how many parallel tests your account has access to (e.g. 3 for Sauce Open accounts).</p>

<h2>Outro</h2>

<p>Hopefully this tip has helped steer you on a path towards better test writing and parallelization.</p>

<p>Stay tuned for future tips where we'll cover how to take full advantage of your test suite by wiring it into a Continuous Integration server and making the requisite changes to your test runner.</p>

<p>Also, if you want to see some write-ups on how to do parallelization in other languages, here is one in <a href="http://sauceio.com/index.php/2013/11/parallel-testing-with-python-and-selenium-on-sauce-online-workshop-recap/">Python</a> and another in <a href="http://sauceio.com/index.php/2013/01/so-you-want-to-run-tests-in-parallel-now-what/">Java</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_28"></a>
<h2>28. How To Upgrade from Selenium RC To Web Driver <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/28-upgrading-from-rc">http://elementalselenium.com/tips/28-upgrading-from-rc</a></h2>
<h3>INTERMEDIATE UPGRADING</h3>
<h4>#selenium_rc #upgrading</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>As the Selenium project continues to evolve, Selenium RC is moving closer to end-of-life. This is especially true with the upcoming release of Selenium 3 where minimal support will be offered for RC (details of which you can learn more about from <a href="http://seleniumhq.wordpress.com/2013/10/09/selenium-hangout-2-recap/">a Selenium Hangout with Simon Stewart</a>).</p>

<p>But how do you approach an upgrade like this? Especially if you have an enormous amount of tests that you rely on?</p>

<h2>A Solution</h2>

<p>Take Jason Leyba's advice. He works at Google and oversaw the transition of their tests from Selenium RC to WebDriver. And he posits that it can be done by following 4 simple steps:  </p>

<ul>
<li>Clean up your tests<br></li>
<li>Swap in WebDriver-backed Selenium<br></li>
<li>Use WebDriver for all new features<br></li>
<li>Replace RC usage as tests break<br></li>
</ul>

<p>To give you some context, Google's Selenium tests spawn something on the order of <em>3 million unique browser sessions per day</em>. And they were able to make this transition happen with minimal disruption. If they were able to make this happen at such a scale, then hopefully this serves as inspiration for you to do the same at your organization.</p>

<p><strong>NOTE: Jason discussed this in detail in his keynote talk at Selenium Conf 2013. His talking points and code examples are recapped below. You can view his full talk <a href="http://www.youtube.com/watch?v=cSLmfegT36A">here</a>.</strong></p>

<h2>4 Simple Steps</h2>

<h3>1. Clean Up Your Tests</h3>

<blockquote>
<p>"Turns out that tests that are easy to maintain are tests that are easy to migrate." -- Jason Leyba</p>
</blockquote>

<p>The best thing you can do to keep your tests clean is to practice good abstractions. In the simplest form this means not referencing Selenium commands directly in your tests -- pulling these out into something akin to page objects instead.</p>

<p><strong>NOTE: You can read more about how to accomplish this with a Base Page Object in a previous tip <a href="http://elementalselenium.com/tips/9-use-a-base-page-object">here</a>.</strong></p>

<h3>2. Swap in WebDriver-backed Selenium</h3>

<p>With WebDriver-backed Selenium you get two driver instances to use in your tests -- one for Selenium RC and another for WebDriver. This enables you to keep your Selenium RC tests running while simultaneously building out WebDriver functionality as you transition things over.</p>

<p>You can see an example of what this looks like <a href="https://github.com/SeleniumHQ/selenium/wiki/Ruby-Bindings#webdriver-backed-selenium">here</a>.</p>

<h3>3. &amp; 4. Improve Things Incrementally</h3>

<p>For every new feature you write tests for, use WebDriver. And as your Selenium RC tests break go back and replace the broken bits with WebDriver.</p>

<p>Chip away at this over time and you'll eventually be upgraded.</p>

<h2>Common Pitfalls</h2>

<p>There are a handful of pitfalls to be aware of when stepping through this upgrade.</p>

<h3>Alert Handling</h3>

<p>WebDriver handles JavaScript alerts in a fundamentally different and incompatible way between Selenium RC and WebDriver that won't work in WebDriver-backed Selenium.</p>

<p>The best way to address this is to port your alert handling from Selenium RC to WebDriver -- which is pretty straightforward and should be easy to accomplish assuming you have things well abstracted (re: Step #1 above).</p>

<p>Here is an example of the difference:</p>
<div class="highlight"><pre><span class="c1">// Selenium RC</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">chooseCancelOnNextConfirmation</span><span class="o">();</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">click</span><span class="o">(</span><span class="s">"id=foo"</span><span class="o">);</span>

<span class="c1">// WebDriver</span>
<span class="n">webdriver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">By</span><span class="o">.</span><span class="na">id</span><span class="o">(</span><span class="s">"foo"</span><span class="o">)).</span><span class="na">click</span><span class="o">();</span>
<span class="n">webdriver</span><span class="o">.</span><span class="na">switchTo</span><span class="o">().</span><span class="na">alert</span><span class="o">().</span><span class="na">dismiss</span><span class="o">();</span>
</pre></div>

<h3>Waiting For The Page To Load</h3>

<p>There's no need to explicitly wait for the page to load anymore since WebDriver can implicitly do this for us.</p>

<p>Here's an example:</p>
<div class="highlight"><pre><span class="c1">// Selenium RC</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s">"http://www.google.com"</span><span class="o">);</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">waitForPageToLoad</span><span class="o">();</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">typeKeys</span><span class="o">(</span><span class="s">"name=q"</span><span class="o">,</span> <span class="s">"bears"</span><span class="o">);</span>

<span class="c1">// WebDriver</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="s">"http://www.google.com"</span><span class="o">);</span>
<span class="n">selenium</span><span class="o">.</span><span class="na">typeKeys</span><span class="o">(</span><span class="s">"name=q"</span><span class="o">,</span> <span class="s">"bears"</span><span class="o">);</span>
</pre></div>

<p>If you run into timing issues with this newer approach, consider adding an explicit wait for the element you want to interact with.</p>

<h3>Getting Text From The Page</h3>

<p>It's an expensive operation (and overkill) to get <strong>ALL</strong> of the text from the page to make a verification. And it takes longer to execute this in WebDriver.</p>

<p>A better approach is to find the element that has the text you want and check it's text instead. Alternatively, if you want to search the entire page, it's better to get the page's source and parse that.</p>
<div class="highlight"><pre><span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">selenium</span><span class="o">.</span><span class="na">getBodyText</span><span class="o">();</span>
<span class="n">assertTrue</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"hello"</span><span class="o">));</span>

<span class="n">WebElement</span> <span class="n">body</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="na">findElement</span><span class="o">(</span><span class="n">By</span><span class="o">.</span><span class="na">tagName</span><span class="o">(</span><span class="s">"body"</span><span class="o">));</span>
<span class="n">String</span> <span class="n">text</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="na">getText</span><span class="o">();</span>
<span class="n">assertTrue</span><span class="o">(</span><span class="n">text</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="s">"hello"</span><span class="o">));</span>
</pre></div>

<h3>Be careful with JavaScript</h3>

<p>WebDriver-backed Selenium is not built for performance, it's meant to be a transitional tool. So things will run slower in it. The worst offender being when you issue JavaScript commands directly to the Selenium Core API. So do your best to avoid things like this.</p>
<div class="highlight"><pre><span class="n">selenium</span><span class="o">.</span><span class="na">getEval</span><span class="o">(</span>
     <span class="s">"selenium.isElementPresent('id=foo') &amp;&amp; "</span> <span class="o">+</span>
     <span class="s">"selenium.isVisible('id=foo')"</span><span class="o">);</span>
</pre></div>

<h3>Inertia</h3>

<p>It's worth noting that the hardest part of Google's transition wasn't technical. Teams were really slow to adopt WebDriver -- even when the tools were readily available, well documented, and easy to use. Jason and his team were able to persevere and succeed through various means (e.g carrot, stick, elbow grease, etc.), but this really slowed their progress.</p>

<p>If you find yourself in a similar situation at your organization, it's worth giving <a href="http://www.youtube.com/watch?v=cSLmfegT36A">Jason's talk</a> a watch for inspiration.</p>

<h2>Outro</h2>

<p>If you're faced with a similar upgrade in your future hopefully this tip has helped prepare you for what lies ahead.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_29"></a>
<h2>29. How To Run Your Tests Locally Against Chrome <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/29-chrome-driver">http://elementalselenium.com/tips/29-chrome-driver</a></h2>
<h3>INTERMEDIATE SETUP</h3>
<h4>#drivers #chromedriver #chrome #different_browsers</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>It's straightforward to get your tests running locally against Firefox. But when you want to run them against a different browser like Chrome, you quickly run into configuration overhead that can seem overly complex and lacking in code examples for all of Selenium's supported programming languages.</p>

<h2>A Solution</h2>

<p>With the introduction of WebDriver (circa Selenium 2) a lot of benefits were realized (e.g. more effective &amp; faster browser execution, no more single host origin issues, etc). But with it came some architectural &amp; configuration differences that may not be widely known. Namely -- browser drivers.</p>

<p>WebDriver works with each of the major browsers through a browser driver which is (ideally) maintained by the browser manufacturer. It is an executable file (consider it a thin layer or a shim) that acts as a bridge between Selenium and the browser.</p>

<p>Let's step through an example using <a href="https://sites.google.com/a/chromium.org/chromedriver/">ChromeDriver</a>.</p>

<h2>An Example</h2>

<p>Before starting, we'll need to download the latest ChromeDriver binary executable from <a href="http://chromedriver.storage.googleapis.com/index.html">here</a>. Once we have it, we'll need to tell Selenium where it is. There are three ways to do this:</p>

<ul>
<li>Add it to the System PATH</li>
<li>Specify it in the Selenium setup</li>
<li>Launch ChromeDriver and connect to it via Selenium Remote</li>
</ul>

<p>Let's step through the latter two options.</p>

<p>In our script we'll start by pulling in our requisite libraries (e.g., <code>selenium-webdriver</code> to driver the browser and <code>rspec/expectations</code> &amp; <code>RSpec::Matchers</code> to perform an assertion) and wiring up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: chrome.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Chrome</span><span class="o">::</span><span class="no">Service</span><span class="o">.</span><span class="n">executable_path</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="p">,</span> <span class="s1">'chromedriver'</span><span class="p">)</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:chrome</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Notice that in <code>setup</code> we are telling Selenium where the ChromeDriver exectuable is with <code>executable_path</code> before instantiating the browser.</p>

<p>Now we're ready to add a simple test.</p>
<div class="highlight"><pre><span class="c1"># filename: chrome.rb</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/'</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'The Internet'</span>
<span class="k">end</span>
</pre></div>

<p>If we save this file and run it (e.g., <code>ruby chrome.rb</code>) it will launch an instance of Chrome, visit the homepage of <a href="http://the-internet.herokuapp.com/">the-internet</a>, and assert that the page title loaded.</p>

<h2>Another Example</h2>

<p>Alternatively, we can launch ChromeDriver...</p>
<div class="highlight"><pre>&gt; ./chromedriver
Starting ChromeDriver 2.14.313457 <span class="o">(</span>3d645c400edf2e2c500566c9aa096063e707c9cf<span class="o">)</span> on port 9515
Only <span class="nb">local </span>connections are allowed.
</pre></div>

<p>...and connect to it with Selenium Remote</p>
<div class="highlight"><pre><span class="c1"># filename: chrome.rb</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:remote</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="s1">'http://localhost:9515'</span><span class="p">,</span> <span class="n">desired_capabilities</span><span class="p">:</span> <span class="ss">:chrome</span>
<span class="k">end</span>
<span class="o">.</span><span class="n">.</span><span class="o">.</span>
</pre></div>

<p><strong>NOTE: This approach is faster since there isn't the overhead of having to wait for ChromeDriver to start and stop.</strong></p>

<h2>Expected Behavior</h2>

<ul>
<li>ChromeDriver starts</li>
<li>Selenium uses the ChromeDriver to open an instance of Chrome</li>
<li>Test completes</li>
<li>Browser closes</li>
<li>ChromeDriver stops</li>
</ul>

<h2>Outro</h2>

<p>Hopefully this tip has helped you get a better handle on how WebDriver works with various browsers and saved you some time in configuration setup.</p>

<p>No two browser drivers are alike, so be sure to check out the documentation for the browser you care about to find out it's specific requirements:</p>

<ul>
<li><a href="https://code.google.com/p/selenium/wiki/ChromeDriver">ChromeDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/FirefoxDriver">FirefoxDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/InternetExplorerDriver">InternetExplorer Driver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/OperaDriver">OperaDriver</a></li>
<li><a href="https://code.google.com/p/selenium/wiki/SafariDriver">SafariDriver</a></li>
</ul>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_30"></a>
<h2>30. How To Test Your Mobile App <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/30-mobile">http://elementalselenium.com/tips/30-mobile</a></h2>
<h3>INTERMEDIATE MOBILE</h3>
<h4>#mobile_testing #mobile #appium #sauce_labs</h4>
<hr width="40%" align="left">
<p><strong>NOTE: This post is outdated. I've written a more current series of getting started posts for mobile testing with Appium. You can find them <a href="https://saucelabs.com/resources/appium-bootcamp">here</a>.</strong></p>

<h2>The Problem</h2>

<p>Mobile is kind of a big deal. And if you haven't needed to test a mobile app yet, it's only a matter of time. But where do you start? And how do you do it in a way that is complimentary to your exisitng automation and experience?</p>

<h2>A Solution</h2>

<p>Give <a href="http://appium.io/">Appium</a> a try. It's open source, works for both iPhone &amp; Android, and works through the use of the Selenium WebDriver API (without having to recompile the app in order to test it).</p>

<p>That is to say -- you can write tests pretty much the same way as you do now, there are just some aditional things to think about -- like new functionality (e.g. pinch, swipe, etc.) and setup (e.g. serving your app, running simulators and a server locally, or sending things off to the cloud).</p>

<p>To simplify things, let's step through 2 examples using Sauce Labs to test native apps -- one for iPhone and another for Android. If you need a primer on what Sauce Labs is and how to use it, check out <a href="http://elementalselenium.com/tips/26-cloud">this tip</a>.</p>

<p><strong>NOTE: These examples were borrowed from <a href="https://github.com/appium/appium/tree/master/sample-code/examples/ruby">the Appium project</a> and modified for simplicity.</strong></p>

<h2>A brief primer on Native App Testing In SauceLabs</h2>

<p>In order to test your app in SauceLabs you will need to zip it up and serve it somehow. Here are some options on how to do that:
+ make it publically available (e.g. from AWS)
+ use <a href="http://saucelabs.com/docs/rest#storage">Sauce Labs' temporary storage</a>
+ use <a href="https://saucelabs.com/docs/connect">Sauce Connect</a> and grab it from a machine behind your firewall</p>

<p>Once you have that you just need to set your test's desired capabilities accordingly. You can see a list of options <a href="https://saucelabs.com/docs/platforms/appium">here</a>.</p>

<h2>An iPhone Example</h2>

<p>In this example we will be testing an application that has a form that takes 2 numbers, adds them together, and displays the result.</p>

<p><strong>NOTE: Contrary to the Appium philosophy of not needing to recompile your app, there is one SMALL tweak you'll need to make before your app is ready for Sauce (if you care about testing against an iPhone). It's to make sure that the correct simulator gets loaded. Instructions available <a href="https://saucelabs.com/appium/tutorial/2#compiling">here</a>.</strong></p>

<p>We kick off our iPhone example by requiring our dependent libraries (<code>selenium-webdriver</code> to drive the browser, and <code>rspec-expectations</code> for handling assertions). After that, we wire up our setup, teardown, and run methods.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'platform'</span>            <span class="o">=&gt;</span> <span class="s1">'Mac 10.8'</span><span class="p">,</span>
    <span class="s1">'version'</span>             <span class="o">=&gt;</span> <span class="s1">'6.1'</span><span class="p">,</span>
    <span class="s1">'device'</span>              <span class="o">=&gt;</span> <span class="s1">'iPhone Simulator'</span><span class="p">,</span>
    <span class="s1">'app'</span>                 <span class="o">=&gt;</span> <span class="s1">'http://appium.s3.amazonaws.com/TestApp6.0.app.zip'</span><span class="p">,</span>
    <span class="s1">'name'</span>                <span class="o">=&gt;</span> <span class="s1">'Ruby/iPhone Example for Appium'</span>
  <span class="p">}</span>

  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
    <span class="ss">:remote</span><span class="p">,</span>
    <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">"http://SAUCE_USERNAME:SAUCE_API_KEY@ondemand.saucelabs.com:80/wd/hub"</span><span class="p">,</span>
    <span class="ss">:desired_capabilities</span> <span class="o">=&gt;</span> <span class="n">caps</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Note that in <code>setup</code> we configure our capabilities by setting them to a hash and storing them in a variable called <code>caps</code>. In it we are specifying the platform we would like (<code>Mac 10.8</code>), the iOS version (<code>6.1</code>), the device (<code>iPhone Simulator</code>), and the app we would like to load (zipped up and served from AWS).</p>

<p>We then instantiate Selenium Remote in a <code>@driver</code> object; pointing it at Sauce Labs, and passing in our desired capabilities.</p>

<p>And in our test we wire up interaction with the app using familiar Selenium WebDriver API actions and an assertion.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
    <span class="n">values</span> <span class="o">=</span> <span class="o">[</span><span class="nb">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="nb">rand</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">]</span>
    <span class="n">expected_sum</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:+</span><span class="p">)</span>

    <span class="n">elements</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">:tag_name</span><span class="p">,</span> <span class="s1">'textField'</span><span class="p">)</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">element</span><span class="p">,</span> <span class="n">index</span><span class="o">|</span>
      <span class="n">element</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">values</span><span class="o">[</span><span class="n">index</span><span class="o">]</span>
    <span class="k">end</span>

    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:tag_name</span><span class="p">,</span> <span class="s1">'button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:tag_name</span><span class="p">,</span> <span class="s1">'staticText'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="n">expected_sum</span><span class="o">.</span><span class="n">to_s</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<ul>
<li>Open a job with Sauce Labs</li>
<li>Load an iPhone simulator on a Mac</li>
<li>Load the test app</li>
<li>Input two random numbers</li>
<li>Sum them them together</li>
<li>Assert that they are correctly added together</li>
</ul>

<p><strong>NOTE: You can see the test result complete with video <a href="https://saucelabs.com/tests/6736add27ae544409e7ae918ff74ae8d">here</a>.</strong></p>

<h2>An Android Example</h2>

<p>In this example we will be testing a simple note taking app.</p>

<p>We kick off our Android example by requiring our dependent libraries (<code>selenium-webdriver</code> to drive the browser, and <code>rspec-expectations</code> for handling assertions). After that, we wire up our setup, teardown, and run methods.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'platform'</span>            <span class="o">=&gt;</span> <span class="s1">'Linux'</span><span class="p">,</span>
    <span class="s1">'version'</span>             <span class="o">=&gt;</span> <span class="s1">'4.2'</span><span class="p">,</span>
    <span class="s1">'device'</span>              <span class="o">=&gt;</span> <span class="s1">'Android'</span><span class="p">,</span>
    <span class="s1">'app'</span>                 <span class="o">=&gt;</span> <span class="s1">'http://appium.s3.amazonaws.com/NotesList.apk'</span><span class="p">,</span>
    <span class="s1">'app-package'</span>         <span class="o">=&gt;</span> <span class="s1">'com.example.android.notepad'</span><span class="p">,</span>
    <span class="s1">'app-activity'</span>        <span class="o">=&gt;</span> <span class="s1">'.NotesList'</span><span class="p">,</span>
    <span class="s1">'name'</span>                <span class="o">=&gt;</span> <span class="s1">'Ruby/Android Example for Appium'</span>
  <span class="p">}</span>

  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
    <span class="ss">:remote</span><span class="p">,</span>
    <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">"http://SAUCE_USERNAME:SAUCE_API_KEY@ondemand.saucelabs.com:80/wd/hub"</span><span class="p">,</span>
    <span class="ss">:desired_capabilities</span> <span class="o">=&gt;</span> <span class="n">caps</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>In <code>setup</code>, we configure our capabilities by setting them to a hash and storing them in a variable called <code>caps</code>. In it we are specifying the platform (<code>Linux</code>), the Android version (<code>4.2</code>), the device (<code>Android</code>), and where to find the app (zipped and served from AWS). We then instantiate Selenium Remote in a <code>@driver</code> object; pointing it at Sauce Labs, and passing in our desired capabilities.</p>

<p>The additional bits of info we need to provide in <code>caps</code> (versus in our iPhone example) are <code>app-package</code> and <code>app-activity</code>. <code>app-package</code> being the package name of your app, and <code>app-activity</code> being the name of the activity you would like to start. <code>app-activity</code> gets appended to <code>app-package</code> and is used at Sauce run time to launch your app (e.g. <code>com.example.android.notepad.NotesList</code>).</p>

<p>And in our test we wire up interaction with the app using familiar Selenium WebDriver API actions and an assertion.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s1">'New note'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:tag_name</span><span class="p">,</span> <span class="s1">'textfield'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="s1">'This is a new note, from Ruby'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s1">'Save'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">notes</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="ss">:tag_name</span><span class="p">,</span> <span class="s1">'text'</span><span class="p">)</span>
  <span class="n">notes</span><span class="o">[</span><span class="mi">2</span><span class="o">].</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'This is a new note, from Ruby'</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<ul>
<li>Open a job with Sauce Labs</li>
<li>Load an Android simulator on a Linux machine</li>
<li>Load the test app</li>
<li>Create a new note</li>
<li>Fill in the new note</li>
<li>Grab the note text and assert that it's what we inputted</li>
</ul>

<p><strong>NOTE: You can see the test result complete with video <a href="https://saucelabs.com/tests/e0dbb98af23540d8b43f0806d743fbd8">here</a>.</strong></p>

<h2>Other Helpful Tidbits</h2>

<h3>Inspecting Elements</h3>

<p>In order to easily inspect and identify the elements in your app, you can use Appium's Inspector which comes in <a href="https://github.com/appium/appium-dot-app">appium-dot-app</a> and requires you to set up Appium locally.</p>

<p><strong>NOTE: You can see a demo of it in action with an iOS app <a href="http://www.youtube.com/watch?v=Hv9A9WfYF4g">here</a>.</strong></p>

<h3>Mobile Web Apps</h3>

<p>If instead you have a mobile web app, you can launch mobile Safari by switching out the URL in <code>app</code> with <code>safari</code>, like so:</p>
<div class="highlight"><pre>  <span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'platform'</span>            <span class="o">=&gt;</span> <span class="s1">'Mac 10.8'</span><span class="p">,</span>
    <span class="s1">'version'</span>             <span class="o">=&gt;</span> <span class="s1">'6.1'</span><span class="p">,</span>
    <span class="s1">'device'</span>              <span class="o">=&gt;</span> <span class="s1">'iPhone Simulator'</span><span class="p">,</span>
    <span class="s1">'app'</span>                 <span class="o">=&gt;</span> <span class="s1">'safari'</span><span class="p">,</span>
    <span class="s1">'name'</span>                <span class="o">=&gt;</span> <span class="s1">'Ruby/iPhone Example for Appium'</span><span class="p">,</span>
  <span class="p">}</span>
</pre></div>

<p>But it's worth noting that Sauce Labs does not currently support the ability launch a mobile browser on Android (e.g. <code>chrome</code>). This functionality is, however, available when running Appium locally (as documented <a href="https://github.com/appium/appium/blob/master/docs/mobile-web.md#mobile-chrome-on-emulator-or-real-device">here</a>).</p>

<h3>Hybrid Apps</h3>

<p>If you have a hybrid mobile app (e.g. an app with a native container that leverages the built in browser engine), then you should be good to go both locally and in Sauce. For details, go <a href="https://github.com/appium/appium/blob/master/docs/hybrid.md">here</a>.</p>

<h3>Location Services</h3>

<p>If you have an iOS app that deals with geolocation, then working with the Location Services dialog can be a little tricky.</p>

<p>You can either do a blanket dismiss (which requires some elbow grease -- see <a href="https://groups.google.com/d/msg/appium-discuss/k5gbfVFRPsE/cCkje7tczQcJ">this Appium Google Groups thread</a> for details), or capture and dismiss the dialog as it appears (using functionality found in a library like <a href="https://github.com/appium/ruby_lib/blob/master/docs/ios_docs.md#alert_click-ios">ruby_lib</a>).</p>

<p>And in Sauce Labs, Location Services is disabled by default on iOS 6.1, but enabled by default on iOS 7.1. This is not configurable, but may be in the future through desired capabilities (there's <a href="http://support.saucelabs.com/entries/25117411-Location-services-enabled-by-default-on-iOS-devices">an active thread about this on Sauce's support site</a>, feel free to chime in!).</p>

<p><strong>NOTE: Sauce Labs now supports Location Services (as noted in <a href="http://support.saucelabs.com/entries/25117411#view-post-21941225">this recent support thread comment</a>). You can set it in your desired capabilities with <code>locationServicesEnabled</code> and a <code>true</code> or <code>false</code> value.</strong></p>

<h2>Outro</h2>

<p>Hopefully this tip has helped give you enough to get started with mobile testing. In order to take full advantage of what Appium has to offer, getting it set up locally is key. I encourage you to check out the installation docs (available for <a href="https://github.com/appium/appium/blob/master/docs/running-on-osx.md">OS X</a>, <a href="https://github.com/appium/appium/blob/master/docs/running-on-linux.md">Linux</a>, and <a href="https://github.com/appium/appium/blob/master/docs/running-on-windows.md">Windows</a>).</p>

<p>And if you're curious about other mobile automation frameworks, Alister Scott has <a href="http://watirmelon.com/2013/11/04/the-current-state-of-ios-automated-functional-testing/">a good breakdown of them</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_31"></a>
<h2>31. How To Access Previous Tips <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/31-archives">http://elementalselenium.com/tips/31-archives</a></h2>
<h3>BEGINNER ARCHIVES</h3>
<h4>#archives</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Let me guess -- you subscribed to a free, weekly Selenium tip newsletter and aren't sure of how to access previously written tips (or are unaware that this is even a possibility).</p>

<h2>A Solution</h2>

<p>Check out <a href="http://elementalselenium.com/tips">the Elemental Selenium Tip Archives</a>! Each tip is available there, and it's simple to traverse.</p>

<p>All of the tips are tagged, categorized, and marked by level of difficulty. Each marking is clickable (both within the tip and when viewing all tips on the archive page), and will return a filtered result.</p>

<h2>An Example</h2>

<p>If you are viewing <a href="/tips/7-use-a-page-object">Tip 7</a>  and click on the category (e.g. 'Patterns').</p>

<p><img src="/img/in_tip.png" alt="tip 7"></p>

<p>Then it will return a list of all tips with the same category.</p>

<p><img src="/img/list_category.png" alt="category list"></p>

<p>Alternatively, you could have clicked on one of the tags (e.g. '#page_object') and it would have returned a list of tips that were tagged similarly.</p>

<p><img src="/img/list_tag.png" alt="tag list"></p>

<h2>Expected Outcome</h2>

<ul>
<li>View the tip archive (or an individual tip)</li>
<li>Click a filtering option</li>
<li>See a filtered list of tips</li>
<li>View and enjoy another relevant tip</li>
</ul>

<h2>Outro</h2>

<p>Hopefully this has helped turn you onto the bounty of freely available Selenium tips that were right at your fingertips this whole time.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_32"></a>
<h2>32. Css Vs. X Path <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/32-xpath-vs-css">http://elementalselenium.com/tips/32-xpath-vs-css</a></h2>
<h3>INTERMEDIATE BENCHMARKS</h3>
<h4>#selectors #xpath #css #css_selectors #locators #locator_strategy</h4>
<hr width="40%" align="left">
<p><strong>NOTE: This is part 1 of 3. For the second installment, <a href="http://elementalselenium.com/tips/33-xpath-vs-css-revisited">go here</a>. For the last installment, go <a href="http://elementalselenium.com/tips/34-xpath-vs-css-revisited-2">here</a>.</strong></p>

<h2>The Problem</h2>

<p>One of the most heated and subjective conversations in the Selenium community is which locator strategy is better, often circling around two -- XPath and CSS. People in favor of CSS say that it is more readable and faster (especially when running against Internet Explorer). While those in favor of XPath tout it's ability to transverse the page (while CSS cannot).</p>

<p>With such a divide it can be hard to determine the best approach for you and your team. Especially when most of these claims are outdated.</p>

<h2>A Solution</h2>

<p>Let's cut through the noise by running our own performance tests across all major browsers to see how CSS and XPath stack up and fall down. Then we will be able to determine a more helpful locator strategy.</p>

<h2>An Example</h2>

<p>To test the differences between CSS and XPath we will use two sets of tests. The first set will work with simple attributes like ID and Class, and the other will traverse the DOM top down to work with nested elements.</p>

<p>Ideally, this would be run locally and the speed of each find element action would be measured and compared. But for this we're going to use Sauce Labs and track the total test time for each run. While the prior is more precise, the latter is more accurate since it demonstrates an end-to-end workflow.</p>

<p><strong>NOTE: For a more rigorous benchmark, check out <a href="http://elementalselenium.com/tips/33-xpath-vs-css-revisited">Tip 33 -- CSS vs. XPath, Under a Microscope</a>.</strong></p>

<p>For our example application we will us <a href="http://the-internet.herokuapp.com/tables">a page with two HTML data tables</a>. One table is written without helpful attributes, and the other with them. The test code used can be seen <a href="https://gist.github.com/tourdedave/8309313">here</a>.</p>

<p>Here are the results after running the suite three consecutive times and averaging them (each linkable to a job in Sauce Labs).</p>

<h3>Finding Elements By ID and Class</h3>

<p>Browser | CSS | XPath<br>
Internet Explorer 8 | <a href="https://saucelabs.com/tests/99c76814cf9749ef83a0908af96f36e8">23 seconds</a>  | <a href="https://saucelabs.com/tests/3052b7b1d04d4a6ca8e69a78e2c7143f">22 seconds</a><br>
Chrome 31           | <a href="https://saucelabs.com/tests/57e12106969b4c27a888f34815eabade">17 seconds</a>  | <a href="https://saucelabs.com/tests/aadb81d6c7e74485aa6b4cc8b5545306">16 seconds</a><br>
Firefox 26          | <a href="https://saucelabs.com/tests/0195437ad34f41be9ccf50d2b354bca5">22 seconds</a>  | <a href="https://saucelabs.com/tests/882bb654f1f247938d9283acd687c6a7">22 seconds</a><br>
Opera 12            | <a href="https://saucelabs.com/tests/dc33e27d94ed4a6481375223bf836647">17 seconds</a>  | <a href="https://saucelabs.com/tests/0f1187556f50476484c71e182151c70c">20 seconds</a><br>
Safari 5            | <a href="https://saucelabs.com/tests/4bc307aec4d9467e85538d29ac9929d1">18 seconds</a>  | <a href="https://saucelabs.com/tests/8bd1c7fbb2604429ba903f0a814ee9df">18 seconds</a>  </p>

<h3>Finding Elements By Traversing</h3>

<p>Browser | CSS | XPath<br>
Internet Explorer 8 | <a href="https://saucelabs.com/tests/4caa9a370f234359afbd31bb86ae3089">not supported</a>  | <a href="https://saucelabs.com/tests/8405a88ef187475d9ca191fb2adf5634">29 seconds</a><br>
Chrome 31           | <a href="https://saucelabs.com/tests/cdae032631a34f87b75ca1daadbaf6cf">24 seconds</a>  | <a href="https://saucelabs.com/tests/cae82a0567d845858c35602d34558f8c">26 seconds</a><br>
Firefox 26          | <a href="https://saucelabs.com/tests/62192045bf2149e6bae5f1010b491810">27 seconds</a>  | <a href="https://saucelabs.com/tests/50dc24e1e484489cbe8eaa8eb2cebbf1">27 seconds</a><br>
Opera 12            | <a href="https://saucelabs.com/tests/399fbd76410d42ca9207ed829da93952">25 seconds</a>  | <a href="https://saucelabs.com/tests/0f4bd7a9ab8c4bdcb5d0bef91043c41b">25 seconds</a><br>
Safari 5            | <a href="https://saucelabs.com/tests/9247cb6c27c9431b8f5d555ee00e22c3">23 seconds</a>  | <a href="https://saucelabs.com/tests/7cf2656786094645b9fcf2329f452c80">22 seconds</a>  </p>

<h2>What The Results Tell Us</h2>

<p>The results help illustrate and illuminate a couple of things.</p>

<p>For starters there is no dramatic difference in performance between XPath and CSS. This is surprising since it is <a href="http://stackoverflow.com/questions/13975595/why-one-should-prefer-using-css-over-xpath-in-ie/14139380#14139380">the main reason cited in favor of CSS</a>. There may be other functionality or page structures that demonstrates this speed gap (e.g. more dense and complex pages), but it's not readily apparent -- and I'm skeptical that it would make a substantial impact (e.g. the order of magnitude difference demonstrated by <a href="https://twitter.com/santiycr">Santi</a> in <a href="http://www.youtube.com/watch?v=6vPu3TO6XZ4">a presentation at the SF Selenium Meetup back in 2011</a>).</p>

<p>Traversing the DOM in older browsers like Internet Explorer 8 does not work with CSS but is fine with XPath. And XPath can walk up the DOM (e.g. from child to parent), whereas CSS can only traverse down the DOM (e.g. from parent to child).</p>

<p>Based on the data, XPath looks more favorable than it once was.</p>

<h2>Some Additional Food For Thought</h2>

<p>Not being able to traverse the DOM with CSS in older browsers isn't necessarily a bad thing. To me it's more of an indicator that your page has poor design and could benefit from some helpful markup. I outline an approach in <a href="http://elementalselenium.com/tips/25-tables">a previous tip</a> under the heading "But What About Older Browsers?".</p>

<p>Some other arguments in favor of CSS are that they are more readable, brief, and concise. While I tend to agree, it is a subjective call. Sauce Labs has <a href="http://saucelabs.com/resources/selenium/css-selectors">a good set of examples that demonstrate CSS and XPath side-by-side to accomplish both simple and advanced tasks</a>. It's worth a look for you to determine for yourself.</p>

<p>In <a href="https://twitter.com/bjburton">Ben Burton</a>'s talk (<a href="http://vimeo.com/44133409">Selenium WebDriver Best Practices</a>) he posits that you should use CSS because that's how applications are built. This makes the tests easier to write, talk about, and have others help maintain. This is also a point that Santi makes in his presentation.</p>

<p><a href="https://twitter.com/adamgoucher">Adam Goucher</a>'s advice is to adopt a more hybrid approach -- focusing first on IDs, then CSS, and leveraging XPath only when you <strong>need</strong> it (e.g. walking up the DOM). He says he does this without hesitation because it's the right tool for the task, and that XPath will always be more powerful for advanced locators.</p>

<h2>Which Do You Choose?</h2>

<p>It's a tough call to make. Especially now that we're armed with the knowledge that the choice is not as reliant on performance as it once was. But the choice is not as permanent as <a href="http://elementalselenium.com/tips/21-choosing-a-language">choosing a programming language</a>, and if you are using helpful abstraction (e.g. <a href="http://elementalselenium.com/tips/tags/page_object">Page Objects</a>) then leveraging a hybrid approach is simple to implement.</p>

<p>It's just a matter of finding what works for you and your team and not listening to all the hype.</p>

<p>Good luck and Happy Testing!</p><br>
<hr>
<a name ="tips_33"></a>
<h2>33. Css Vs. X Path, Under a Microscope <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/33-xpath-vs-css-revisited">http://elementalselenium.com/tips/33-xpath-vs-css-revisited</a></h2>
<h3>INTERMEDIATE BENCHMARKS</h3>
<h4>#selectors #xpath #css #css_selectors #locators #locator_strategy</h4>
<hr width="40%" align="left">
<p><strong>NOTE: This is part 2 of 3. For the first installment, <a href="http://elementalselenium.com/tips/32-xpath-vs-css">go here</a>. For the last installment, go <a href="http://elementalselenium.com/tips/34-xpath-vs-css-revisited-2">here</a>.</strong></p>

<h2>The Problem</h2>

<p>In a previous tip we reviewed <a href="http://elementalselenium.com/tips/32-xpath-vs-css">the performance of CSS vs. XPath against Sauce Labs</a>. While it demonstrated that each locator strategy is reasonably equivalent across browsers, it didn't adequately paint the whole picture for us.</p>

<p>Given that it was an end-to-end test there were a lot of variables at play -- Sauce startup, browser start up, and latency to and from the application under test. The unfortunate takeaway from that experiment could be that one driver may be faster than the other (e.g. IE vs Firefox), when in fact, that's not the case at all.</p>

<h2>A Solution</h2>

<p>To get a real taste of what the performance difference is between CSS and XPath, we will need to dig deeper. We'll do that by running everything from a local machine while using a performance benchmarking utility. We'll also want to focus on a specific Selenium action rather than the entire test run, and run things numerous times.</p>

<h2>An Example</h2>

<p>For this example, I set up a local Windows XP virtual machine. This was quick work thanks to the images made available by Microsoft. You can grab one <a href="http://www.modern.ie/en-us/virtualization-tools#downloads">here</a> and see <a href="http://webees.me/installing-virtualbox-for-mac-and-set-up-modern-ie/">a write-up walking your through setup in Virtual Box</a>.</p>

<p>After <a href="http://rubyinstaller.org/downloads/">installing Ruby (1.9.3)</a> I installed all available browsers and their equivalent browser drivers for Selenium use. You can learn more about how to set up different browsers to run locally in Selenium <a href="http://elementalselenium.com/tips/29-chrome-driver">here</a>.</p>

<p>For benchmarking I used the library that's available in Ruby's standard lib called 'benchmark'. You can learn more about it <a href="http://rubylearning.com/blog/2013/06/19/how-do-i-benchmark-ruby-code/">here</a>.</p>

<p>In order to get an adequate sample set of data, I ran the same test against each browser 100 times. And to weed out anomalies in the data I used the rehearsal feature of benchmark so that it would run the full test sequence, perform garbage collection, and then run it again.</p>

<p>To make things comparable, a few of the locators were updated to make for better matches in comparison to each other. And the specific action we measured is <code>find_element</code>. You can see the locators and test code used <a href="https://github.com/tourdedave/selenium-benchmark/blob/master/lib/page-objects/small_dom.rb">here</a>.</p>

<p>Here are the results.</p>

<h2>The Results</h2>

<p><strong>NOTE: The output is in seconds, and the results are for the total run time of 100 executions.</strong></p>

<p><a href="http://elementalselenium.com/img/local-browser-benchmarks.png"><img src="/img/local-browser-benchmarks.png" alt="local browser benchmarks"></a></p>

<h2>What The Results Tell Us</h2>

<p>On a whole, Internet Explorer is slower than the other drivers, but between CSS and XPath it looks like XPath is actually <strong>faster</strong> than CSS. Chrome and Opera have some differences, albeit much smaller, but they sway in both directions. In some cases CSS is faster, and in others, XPath. And Firefox looks to be a bit more optimized for CSS since it's mostly faster across the board.</p>

<p><strong>NOTE: Opera 12.16 was used since that is the last supported version within the Selenium project. That's because they switched to using Chromium and dropped Selenium support. That and Mozilla hired Opera's only WebDriver developer -- so, there's that.</strong></p>

<h2>Outro</h2>

<p>Even with these speed differences they are only a few seconds (or fractions of seconds) apart -- and that's for 100 executions. When you think about how it takes 30 seconds or more to complete a test run, this kind of difference is negligible.</p>

<p>As I noted in <a href="http://elementalselenium.com/tips/32-xpath-vs-css">my previous tip</a>, the choice between CSS and XPath can be a tough one to make. But now you are armed with more than enough data to make the choice for yourself. It's really just a matter of finding what works for you and your team and to not get weighed down by the hype and opinions around which one is better.</p>

<p>Happy Testing!</p>

<h2>Acknoledgements</h2>

<p>I'd like to give a huge shout out to <a href="https://twitter.com/AutomatedTester">David Burns</a> and <a href="https://twitter.com/bbbco">Brian Goad</a>! They helped make this tip possible by each helping in their own way. David for his feedback and guidance on <a href="https://www.youtube.com/watch?v=qQgDDAan4rM">how to do effective performance testing</a>. And Brian for his feedback, recommendations, and <a href="https://twitter.com/bbbco/status/421707164919418880">code contributions</a>. Thank you!</p><br>
<hr>
<a name ="tips_34"></a>
<h2>34. Css Vs. X Path, Under a Microscope (Part 2) <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/34-xpath-vs-css-revisited-2">http://elementalselenium.com/tips/34-xpath-vs-css-revisited-2</a></h2>
<h3>INTERMEDIATE BENCHMARKS</h3>
<h4>#selectors #xpath #css #css_selectors #locators #locator_strategy</h4>
<hr width="40%" align="left">
<p><strong>NOTE: This is part 3 of 3. For the first installment, <a href="http://elementalselenium.com/tips/32-xpath-vs-css">go here</a>. For the second installment, go <a href="http://elementalselenium.com/tips/33-xpath-vs-css-revisited">here</a>.</strong></p>

<h2>The Problem</h2>

<p>In <a href="http://elementalselenium.com/tips/33-xpath-vs-css-revisited">the last tip</a> I provided benchmarks that showed XPath and CSS performance across various browsers. Since then I've received feedback on some things that my test was missing -- most notably more browser coverage (e.g., Internet Explorer 9 and 10) and testing against a larger and deeper page.</p>

<h2>A Solution</h2>

<p>In order to make sure these benchmarks are as thorough as possible I've put together <a href="http://the-internet.herokuapp.com/large">an example that demonstrates a large and deep page</a>, and retooled <a href="https://github.com/tourdedave/selenium-benchmark/blob/master/lib/page-objects/large_dom.rb">my test script</a> accordingly. Otherwise, everything is pretty much the same as last time (e.g., dual runs to weed out anomalies, 100 test executions for time in seconds, etc.).</p>

<p>Let's dig into the results.</p>

<h2>The Results</h2>

<h3>In Table Form</h3>

<p><a href="/img/full-benchmark-data.png"><img src="/img/full-benchmark-data.png" alt="benchmark data in an ASCII table"></a></p>

<h3>In Chart Form</h3>

<p><img src="/img/chart-chrome.png" alt="chart of chrome"></p>

<p><img src="/img/chart-firefox.png" alt="chart of firefox"></p>

<p><img src="/img/chart-ie8.png" alt="chart of ie8"></p>

<p><img src="/img/chart-ie9.png" alt="chart of ie9"></p>

<p><img src="/img/chart-ie10.png" alt="chart of ie10"></p>

<p><img src="/img/chart-opera.png" alt="chart of opera"></p>

<h2>What The Results Tell Us</h2>

<p>Chrome and Firefox are clearly tuned for faster CSS performance. Internet Explorer 8 is a grab bag of CSS that won't work, an out of control XPath traversal that takes ~65 seconds, and a 38 second table traversal with no CSS result to compare it against.</p>

<p>In IE 9 and 10, XPath is faster overall. In Safari, it's a toss up, except for a couple of slower traversal runs with XPath. And across almost all browsers, <a href="https://github.com/tourdedave/selenium-benchmark/blob/master/lib/page-objects/large_dom.rb#L13">the nested sibling traversal</a> and <a href="https://github.com/tourdedave/selenium-benchmark/blob/master/lib/page-objects/large_dom.rb#L41">table cell traversal</a> done with XPath are an expensive operation.</p>

<p>That shouldn't be too surprising though since they are brittle and inefficient ways to write locators. Do try to avoid them.</p>

<h2>Outro</h2>

<p>So all in all there are two circumstances where XPath is markedly slower than CSS. But they are easily avoidable. Otherwise, the performance difference is slightly in favor of CSS for non-IE browsers and slightly in favor of XPath for IE browsers. Given that, I would recommend that you choose your locator strategy based on what works for you and your team. And really, it doesn't matter. If you can ensure that the primary elements on your page have unique IDs and Classes then that will always be faster than traversing across the DOM (regardless of which locator strategy you use).</p>

<p>If you want to do some benchmarking on your own, I wrapped up all the code I wrote into <a href="https://github.com/tourdedave/selenium-benchmark">this library</a>.</p>

<p>Happy Testing!</p>

<h2>Acknowledgements</h2>

<p>A huge thanks to <a href="https://twitter.com/AutomatedTester">David Burns</a>, <a href="https://twitter.com/bbbco">Brian Goad</a>, <a href="https://twitter.com/dimacus">Dima Kovalenko</a>, and <a href="https://twitter.com/shs96c">Simon Stewart</a> who provided great feedback and insight into the test and example design.</p><br>
<hr>
<a name ="tips_35"></a>
<h2>35. How To Verify Your Locators Without Selenium <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/verifying-locators">http://elementalselenium.com/tips/verifying-locators</a></h2>
<h3>BEGINNER TOOLS</h3>
<h4>#locators #css #xpath #firefinder #firebug #firefox</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Locators are the lifeblood of your Selenium tests. If you're fortunate enough to be working with unique IDs and Classes, then you're usually all set.</p>

<p>But this is rarely the case, and when you have to traverse a page to interact with hard to reach elements, or you need to run down odd test behavior, it can be a real challenge to verify that you have the correct locators to accomplish what you want.</p>

<h2>A Solution</h2>

<p>Instead of the painful and time consuming process of writing a test with locators, running it, and seeing what it does -- give <a href="https://addons.mozilla.org/en-US/firefox/addon/firefinder-for-firebug/">Firefinder</a> a try. It is an add-on to the web-development Firefox plugin called <a href="https://addons.mozilla.org/en-US/firefox/addon/firebug/">Firebug</a>.</p>

<p>You first need to install Firebug, then Firefinder. Once done, verifying locators is a trivial task, and it works for both CSS and XPath locators.</p>

<h2>An Example</h2>

<p>Let's try and find the locators necessary to traverse a few levels into a large set of nested divs.</p>
<div class="highlight"><pre># a snippet from http://the-internet.herokuapp.com/large

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'siblings'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-1.1'</span><span class="nt">&gt;</span>1.1
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-1.2'</span><span class="nt">&gt;</span>1.2<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-1.3'</span><span class="nt">&gt;</span>1.3<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-2.1'</span><span class="nt">&gt;</span>2.1
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-2.2'</span><span class="nt">&gt;</span>2.2<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-2.2'</span><span class="nt">&gt;</span>2.3<span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.1'</span><span class="nt">&gt;</span>3.1
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.2'</span><span class="nt">&gt;</span>3.2<span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.2'</span><span class="nt">&gt;</span>3.3<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.1'</span><span class="nt">&gt;</span>4.1
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.2'</span><span class="nt">&gt;</span>4.2<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'sibling-3.2'</span><span class="nt">&gt;</span>4.3<span class="nt">&lt;/div&gt;</span>
        ...
</pre></div>

<p>If we were to perform a <code>find_element</code> action using either of the following locators, they will work.</p>
<div class="highlight"><pre><span class="c1"># CSS</span>
<span class="s2">"div#siblings &gt; div:nth-of-type(1) &gt; div:nth-of-type(1)"</span>

<span class="c1"># XPath</span>
<span class="s2">"//div[@id='siblings']/div[1]/div[1]"</span>
</pre></div>

<p>But if we try to go one level deeper, they won't work.</p>
<div class="highlight"><pre><span class="c1"># CSS</span>
<span class="s2">"div#siblings &gt; div:nth-of-type(1) &gt; div:nth-of-type(1) &gt; div:nth-of-type(1)"</span>

<span class="c1"># XPath</span>
<span class="s2">"//div[@id='siblings']/div[1]/div[1]/div[1]"</span>
</pre></div>

<p>Fortunately with Firefinder we can actually see what our locators are doing without leaving the browser. Here's what it shows us for the locators that "worked".</p>

<p><img src="/img/firefinder/wrong-match-css.png" alt="wrong-match-css"></p>

<p><img src="/img/firefinder/wrong-match-xpath.png" alt="wrong-match-xpath"></p>

<p>Ah, our locators are scoping to the wrong part of the first level (1.2). What we need to do is reference the third part of each level (e.g., 1.3, 2.3, 3.3) in order to traverse deeper since the nested divs live under the third part of each level.</p>

<p>So if we try these locators instead, they will work.</p>
<div class="highlight"><pre><span class="c1"># CSS</span>
<span class="s2">"div#siblings &gt; div:nth-of-type(1) &gt; div:nth-of-type(3) &gt; div:nth-of-type(3)"</span>

<span class="c1"># XPath</span>
<span class="s2">"//div[@id='siblings']/div[1]/div[3]/div[3]"</span>
</pre></div>

<p>And we can confirm this before writing any test code by looking in Firefinder.</p>

<p><img src="/img/firefinder/right-match-css.png" alt="right-match-css"></p>

<p><img src="/img/firefinder/right-match-xpath.png" alt="right-match-xpath"></p>

<h2>Outro</h2>

<p>Hopefully this tip will help save you time and frustration when running down tricky locators in your tests. It definitely has for me.</p>

<p>I'd like to give a big thanks to <a href="https://twitter.com/bbbco">Brian Goad</a> for telling me about such a great tool. Alternatively, if you're comfortable with your browser development console then you can issue JavaScript commands to achieve a similar outcome (with no additional installs required).</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_36"></a>
<h2>36. Available Selenium Resources <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/36-available-resources">http://elementalselenium.com/tips/36-available-resources</a></h2>
<h3>BEGINNER COMMUNITY</h3>
<h4>#blogs #videos #talks #books #irc #forums #meetups #conferences #mailing_lists</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>There is information all around us when it comes to Selenium. But it it can be challenging to sift through it, or know where to look.</p>

<h2>A Solution</h2>

<p>Here is a list breaking down a majority of the Selenium resources available, and what they're useful for.</p>

<h2>Available Resources</h2>

<h3>Documentation &amp; Tips</h3>

<ul>
<li><a href="http://docs.seleniumhq.org/">Selenium HQ</a></li>
</ul>

<p>This is the official Selenium project documentation site. It's a bit dated, but there is loads of helpful information here. You just have to get the hang of how the navigate site to find what you need.</p>

<ul>
<li><a href="https://code.google.com/p/selenium/w/list">The Selenium Wiki</a></li>
</ul>

<p>This is where all the good stuff is -- mainly, documentation about the various language bindings and browser drivers. If you're not already familiar with it, take a look.</p>

<ul>
<li><a href="http://elementalselenium.com/tips">Elemental Selenium Archives</a></li>
</ul>

<p>Every tip I've written is freely available on the tips archive page. There are over 35 different Selenium problems and solutions covered.</p>

<h3>Blogs</h3>

<ul>
<li><a href="http://seleniumhq.wordpress.com/">The official Selenium blog</a></li>
</ul>

<p>This is where news of the Selenium project gets announced, and there's also the occasional round-up of what's going on in the tech space (as it relates to testing). Definitely worth a look.</p>

<ul>
<li><a href="http://it-kosmopolit.de/Selenium/blog/selenium-blogs/selenium_blogs.php">A list of "all" Selenium WebDriver blogs</a></li>
</ul>

<p>At some point, someone rounded up a large list of blogs from Selenium practitioners and committers. It's a pretty good list.</p>

<h3>Books</h3>

<ul>
<li><a href="http://www.amazon.com/Selenium-Testing-Tools-Beginners-Guide/dp/1849518300">Selenium 2 Testing Tools</a></li>
</ul>

<p>This book is by <a href="https://twitter.com/AutomatedTester">David Burns</a> and it is a tremendous and thorough resource. It outlines how to use Selenium, top-to-bottom. It's definitely worth having on your shelf.</p>

<ul>
<li><a href="http://www.amazon.com/Selenium-Testing-Cookbook-Gundecha-Unmesh/dp/1849515743/ref=pd_bxgy_b_img_z">Selenium Testing Tools Cookbook</a></li>
</ul>

<p>This is another good book outlining loads of great ways to leverage Selenium. While I haven't had a chance to finish reading it, it's clear that Gundecha has a very pragmatic approach that will yield great results.</p>

<ul>
<li><a href="http://seleniumguidebook.com">The Selenium Guidebook</a></li>
</ul>

<p>This is the book I wish existed when I first started out. It teaches you how to program, write tests, build a framework, and scale it. I think it's pretty good, but then again, I wrote it.</p>

<h3>Meetups</h3>

<ul>
<li><a href="http://seleniumhq.wordpress.com/2013/08/09/the-worlds-best-selenium-meetup/">The Selenium Hangout</a></li>
</ul>

<p>This is an entirely online meetup that is run by me and <a href="https://twitter.com/AutomatedTester">David Burns</a> where we talk about the latest in the Selenium community (e.g., the upcoming conference, the status of Selenium 3, etc.) and answer questions from the community. Videos are recorded and made available (along with notes) on <a href="http://seleniumhq.wordpress.com/">the official Selenium blog</a>.</p>

<ul>
<li><a href="http://selenium.meetup.com/">All Selenium Meetups listed on Meetup.com</a></li>
</ul>

<p>A listing of all in-person Selenium Meetups are available on Meetup.com. If you're near a major city, odds are there's one waiting for you.</p>

<ul>
<li><a href="http://sauceio.com/index.php/2011/10/so-you-want-to-start-a-selenium-meetup-group-now-what/">How to start your own Selenium Meetup</a></li>
</ul>

<p>If there's not a Selenium Meetup near you, start one! Sauce Labs has a great write up on how to do it.</p>

<h3>Conferences</h3>

<ul>
<li><a href="http://www.seleniumconf.org/">Selenium Conf</a></li>
</ul>

<p>This is a tremendous annual conference where practitioners and committers gather and share knowledge. All of the talks are top notch, as is the hallway track. I highly recommend it.</p>

<ul>
<li><a href="http://seleniumcamp.com/">Selenium Camp</a></li>
</ul>

<p>This is an annual Selenium conference in Europe. I haven't been yet, but it sounds like a good event.</p>

<ul>
<li><a href="http://watirmelon.com/2013/12/11/software-testing-conferences-2014/">List of other testing conferences</a></li>
</ul>

<p><a href="https://twitter.com/alisterscott">Alister Scott</a> has a good write-up of the testing conferences coming up this year.</p>

<h3>Videos</h3>

<ul>
<li><a href="http://www.youtube.com/user/seleniumconf/videos">Selenium Conference Talks</a></li>
</ul>

<p>All of the talks from The Selenium Conference are recorded and made freely available online. This is a tremendous resource.</p>

<ul>
<li><a href="http://www.youtube.com/results?search_query=selenium%20meetup&amp;sm=3">Selenium Meetup Talks</a></li>
</ul>

<p>Some of the Selenium Meetups make it a point to record their talks and publish them afterwards. Here are some of them. They are a great way to see what other people are doing and pick up some new tips.</p>

<ul>
<li><a href="http://www.youtube.com/playlist?list=PLjmE7QwH0u6dXyfzlZ10f2Yz6d3mE9QEi">Selenium Hangout</a></li>
</ul>

<p>All of the Selenium Hangout Meetups are recorded and made available. A lot of great stuff is discussed in them.</p>

<h3>Mailing Lists</h3>

<ul>
<li><a href="https://groups.google.com/forum/?fromgroups#!forum/selenium-users">Selenium Users Google Group</a></li>
<li><a href="http://www.linkedin.com/groups/Selenium-Test-Automation-User-Group-961927">Selenium LinkedIn Users Group</a></li>
</ul>

<p>The signal to noise ratio in these groups can be challenging at times. But you can occasionally find some answers to your questions.</p>

<ul>
<li><a href="http://tech.groups.yahoo.com/group/agile-testing/">Agile Testing Yahoo Group</a></li>
</ul>

<p>This list is less about Selenium and more about "testing" (in the <a href="http://www.satisfice.com/blog/archives/856">checking versus testing</a> sense). It's a great place to ask for sage advice, and to hang out and listen. You will learn some valuable insights here.</p>

<h3>Forums</h3>

<ul>
<li><a href="http://stackoverflow.com/questions/tagged/selenium">Stack Overflow</a></li>
<li><a href="http://www.quora.com/Selenium-testing-framework">Quora</a></li>
</ul>

<p>These are the usual forums where you can go looking for answers to questions you're facing (in addition to the mailing lists above).</p>

<h3>Issues</h3>

<ul>
<li><a href="https://code.google.com/p/selenium/issues/list">Selenium Issue Tracker</a></li>
</ul>

<p>If you're running into a specific and repeatable issue that just doesn't make sense, you may have found a bug in Selenium. You'll want to check the Selenium Issue Tracker to see if it has already been reported. If not, then create a new issue. But be sure to read <a href="http://jimevansmusic.blogspot.com/2012/12/not-providing-html-page-is-bogus.html">this post</a> before you do (so you can be sure that you have provided enough information).</p>

<h3>IRC</h3>

<p>The Selenium IRC Chat Channel is arguably the best way to connect with the Selenium community and get questions answered. This is where committers and practitioners hang out day-in and day-out. You can read more about what it is and how to access it <a href="http://elementalselenium.com/tips/20-irc-chat">here</a>.</p><br>
<hr>
<a name ="tips_37"></a>
<h2>37. How To Structure Your Test Code <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/37-oop">http://elementalselenium.com/tips/37-oop</a></h2>
<h3>ADVANCED DESIGN</h3>
<h4>#java #oop #object_oriented_programming #oop_testing #guest_post</h4>
<hr width="40%" align="left">
<p><strong>NOTE: This is a guest post from a fellow test practitioner Josh Grant. You can find him on Twitter at <a href="https://twitter.com/joshin4colours">@joshin4colours</a> and read his excellent testing blog <a href="http://simplythetest.tumblr.com/">here</a>.</strong></p>

<h2>The Problem</h2>

<p>Writing automated tests is pretty easy. Writing good and maintainable tests is much, much tougher. This is especially true as test projects grow in size and complexity.</p>

<h2>A Solution</h2>

<p>There are some approaches that can help structure tests in projects. I'm going to outline one such approach I've used with success. It has helped reduce test duplication and complexity while making tests easier to organize. It leans heavily on object-oriented programming (OOP) principles, which I think lend themselves pretty well to writing tests in a reasonably sized project.</p>

<h2>The Approach Explained</h2>

<p>In this approach, there are essentially two guidelines:</p>

<ul>
<li>One test case per class</li>
<li>Make smart use of inheritance</li>
</ul>

<p>The first point is the important one. Since we're trying to use OOP ideas, we want to focus on the class level.</p>

<p>Think of each class as a test case, and focus it on a particular aspect (or component) of the system you're testing. This provides an easy way to add new test cases (simply create a new class) and modify and update existing tests (by removing/disabling test methods within a class). It can greatly help organize your test suites by allowing existing tests (e.g., individual methods) to be easily combined together. </p>

<p>The second point is fairly straightforward. Inheritance is key feature of OOP, and thinking of tests as objects should be easy to grasp since tests should be well-defined.</p>

<p>Essentially, there are three levels of test classes:</p>

<ul>
<li>a single base class (contains common aspects of all tests)</li>
<li>one or more intermediate test classes (contains common actions for related groups of tests)</li>
<li>actual test classes (where tests live and run)</li>
</ul>

<p>Note the first two kinds of classes don't consist of tests; they're more for grouping common actions and behavior together.</p>

<p>Let's see an example.</p>

<h2>An Example</h2>

<p>Suppose you're testing a forum app like <a href="http://www.reddit.com">Reddit</a> and one of the main components under test is posting. A post is an initial entry with some comments and additional information. Let's say that some basic actions for working with posts are creating a post, deleting a post, and updating a post.</p>

<p>With that in mind, here is what our class structure would look like.</p>

<p><img alt="diagram of the approach" src="/img/diagram.png" style="background-color:white;"></p>

<p>Let's step through what it would look like in code.</p>

<h3>Base Class</h3>

<p>Using our approach, our base test class would look something like this:</p>
<div class="highlight"><pre><span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>

  <span class="kd">protected</span> <span class="nf">setUpBeforeTestClass</span><span class="o">(){</span>
    <span class="c1">// initialize a browser driver, connect to servers</span>
  <span class="o">}</span>

  <span class="kd">protected</span> <span class="nf">setUpBeforeTestMethod</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// initialize testPage</span>
    <span class="c1">// login to the app, if necessary</span>
  <span class="o">}</span>

  <span class="kd">protected</span> <span class="nf">tearDownAfterTestMethod</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// logout of the app, if necessary</span>
  <span class="o">}</span>

  <span class="kd">protected</span> <span class="nf">tearDownAfterTestClass</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// close connections, close browser as needed</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>Here, some things should become clear. Each test class starts by opening a browser driver and ends with closing a browser driver. Also, each test method starts with logging in, and ends with logging out.</p>

<p>This approach offers us some flexibility. For instance, opening and closing the driver could be moved to occur for every test method. Some lines of code would just need to get moved from one place to another within this class.</p>

<p><strong>NOTE: If we were in the Java or C# world, this class would be an abstract class, since we don't ever want to run a base test with generic operators. This assures that this class would only ever be inherited from instead of used directly.</strong></p>

<h3>Intermediate Class(es)</h3>

<p>Here's what an intermediate test class for posting would look like:</p>
<div class="highlight"><pre><span class="kd">class</span> <span class="nc">PostTest</span> <span class="kd">extends</span> <span class="n">Test</span> <span class="o">{</span>

  <span class="kd">protected</span> <span class="nf">setUpBeforeTestClass</span><span class="o">(){</span>
    <span class="c1">// no changes needed</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">setUpBeforeTestClass</span><span class="o">();</span>
  <span class="o">}</span>

  <span class="kd">protected</span> <span class="nf">setUpBeforeTestMethod</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// do the parent actions, then add some post-specific actions</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">setUpBeforeTestMethod</span><span class="o">();</span>
    <span class="n">testPage</span><span class="o">.</span><span class="na">goToPostPage</span><span class="o">();</span>

  <span class="o">}</span>

  <span class="kd">protected</span> <span class="nf">tearDownAfterTestMethod</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// logout of the app, if necessary</span>
  <span class="o">}</span>

  <span class="kd">protected</span> <span class="nf">tearDownAfterTestClass</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// close connections, close browser as needed</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>

<p>Looking at the two guiding principles above, we make good use of inheritance since a PostTest class <a href="http://en.wikipedia.org/wiki/Is-a">is a</a> Test class.</p>

<p>Notice that the only thing we've changed is setUpBeforeTestMethod, which now directs the browser to the posts page (e.g., <code>testPage.goToPostPage();</code>). Other methods could be overridden as well if needed, and other methods could be added here beyond setup and teardown methods. We could also include a page object here if needed. Also, if the language were so inclined, this class could be abstract.</p>

<p>Now, we can write some test classes to take advantage of our hard work. This is where we specify the actual tests that get run.</p>

<h3>Test Classes</h3>

<p>Remember that there are three post operations we'd like to focus on: creating a post, deleting a post, and updating a post. These sound like good candidates for individual test classes, which will encapsulate each test case. </p>

<p>Here's a test class for creating a post:</p>
<div class="highlight"><pre><span class="kd">class</span> <span class="nc">CreateNewPostTest</span> <span class="kd">extends</span> <span class="n">PostTest</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="nf">testCreateValidNewPost</span><span class="o">(){</span>
    <span class="c1">// test is ready to go!</span>
    <span class="n">testPage</span><span class="o">.</span><span class="na">createNewPost</span><span class="o">(</span><span class="n">postDetails</span><span class="o">);</span>
    <span class="k">assert</span> <span class="n">testPage</span><span class="o">.</span><span class="na">isPostPresent</span><span class="o">(</span><span class="n">postDetails</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nf">testCreateInvalidNewPost</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// test is ready to go!</span>
    <span class="n">testPage</span><span class="o">.</span><span class="na">createNewPost</span><span class="o">(</span><span class="n">invalidPostDetails</span><span class="o">);</span>
    <span class="k">assert</span> <span class="o">!</span><span class="n">testPage</span><span class="o">.</span><span class="na">isPostPresent</span><span class="o">(</span><span class="n">invalidPostDetails</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="c1">// and so on</span>
<span class="o">}</span>
</pre></div>

<p>This class shows both of the guiding principles stated above. It neatly defines the test case of creating a new post, with variations (which can be added or subtracted). It also makes good use of inheritance, since a CreateNewPostTest is a PostTest. One other benefit: this class is short and simple! All of the messy details are abstracted away in the previous classes, so this class can focus on doing it's job.</p>

<p>Let's look at a delete test class now:</p>
<div class="highlight"><pre><span class="kd">class</span> <span class="nc">DeleteNewPostTest</span> <span class="kd">extends</span> <span class="n">PostTest</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="nf">setUpBeforeTestMethod</span><span class="o">(){</span>
    <span class="c1">// create a post so we can delete it</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">setUpBeforeTestMethod</span><span class="o">();</span>
    <span class="n">testPage</span><span class="o">.</span><span class="na">createNewPost</span><span class="o">(</span><span class="n">postDetails</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="nf">testDeleteNewPost</span><span class="o">(){</span>
    <span class="c1">// test is ready to go!</span>
    <span class="n">testPage</span><span class="o">.</span><span class="na">deletePost</span><span class="o">(</span><span class="n">postDetails</span><span class="o">);</span>
    <span class="k">assert</span> <span class="o">!</span><span class="n">testPage</span><span class="o">.</span><span class="na">isPostPresent</span><span class="o">(</span><span class="n">postDetails</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="c1">// and so on</span>
<span class="o">}</span>
</pre></div>

<p>Here, we're able to modify the setup methods to create an object for deleting. This helps us isolate test methods to focus on a particular aspect of posts (deleting) without having to add unnecessary steps in the test itself. </p>

<h2>Outro</h2>

<p>Now, you may be thinking at this point, "This looks like a lot of work upfront", and you might be correct. For small test projects, this approach might be overkill. However, for projects that are not small, you can see some scaling advantages that OOP provides.</p>

<p>If more functionality is added to the app (moderating posts, closing posts), you can just add some more test classes since basic setup and teardown are done for you. As well, this approach helps isolate tests from one another so tests can be run independently. Lastly, this approach helps teams (beyond one or two people) break up tasks and responsibilities so large projects can be worked on efficiently.  </p>

<p>Go ahead, use OOP for writing tests.</p><br>
<hr>
<a name ="tips_38"></a>
<h2>38. How To Run Your Tests Headlessly with Xvfb <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/38-headless">http://elementalselenium.com/tips/38-headless</a></h2>
<h3>INTERMEDIATE INFRASTRUCTURE</h3>
<h4>#headless #xvfb</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>If you want to run your tests headlessly on a Continuous Integration (CI) server you'll quickly realize that you can't with an out-of-the-box setup since there is no display output for the browser to launch in.</p>

<h2>A Solution</h2>

<p>In order to run your tests using a browser that's loaded on your CI Server you will need to configure your tests to launch the browser virtually (e.g., using something like Xvfb).</p>

<h2>An Xvfb primer</h2>

<p><a href="http://en.wikipedia.org/wiki/Xvfb">Xvfb</a> (short for X virtual framebuffer) is an in-memory display server for UNIX-like operating system (e.g., Linux). It enables you to run graphical applications without a display (e.g., browser tests on a CI server) while also having the ability to take screenshots.</p>

<p>Let's take a look at an example.</p>

<h2>An Example</h2>

<p>Before we can use Xvfb, we need to install it (along with the browser we want if it's not already loaded).</p>

<p>In Linux we need to find the relevant package names for the package manager and install them (e.g., <code>apt-get install xvfb firefox</code> for Debian based systems like Ubuntu, <code>yum install Xvfb firefox</code> for RedHat based systems, etc.).</p>

<p>Now let's create a simple Selenium script.</p>
<div class="highlight"><pre><span class="c1"># filename: example1.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'The Internet'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">save_screenshot</span> <span class="s1">'example1.png'</span>
<span class="k">end</span>
</pre></div>

<p>Here we are loading a page, asserting the title (to make sure we're in the right place), and grabbing a screenshot (so we can make sure our Xvfb setup is working). The screenshot will render in the directory alongside the test script.</p>

<p>To run the script, it's just <code>ruby example1.rb</code> from the command-line.</p>

<p>Next we need to setup Xvfb -- and we have a few options.</p>

<h3>Option 1</h3>

<ul>
<li>Start Xvfb on a specific display port and background the process</li>
<li>Tell the terminal session to use the display port</li>
<li>Run the test</li>
</ul>
<div class="highlight"><pre>Xvfb :99 &amp;
<span class="nb">export </span><span class="nv">DISPLAY</span><span class="o">=</span>:99
ruby example1.rb
</pre></div>

<p><strong>NOTE: This approach will keep Xvfb running in the background until the process is killed.</strong></p>

<h3>Option 2</h3>

<ul>
<li>Use <code>xvfb-run</code> to launch the tests (no display port declaration necessary)</li>
</ul>
<div class="highlight"><pre>xvfb-run ruby example1.rb
</pre></div>

<p><strong>NOTE: This approach will start and stop Xvfb for you.</strong></p>

<h3>Option 3</h3>

<ul>
<li>Install <a href="https://github.com/leonid-shevtsov/headless">the headless gem</a></li>
<li>Update the test <code>setup</code> and <code>teardown</code> to use it</li>
<li>Run the test</li>
</ul>
<div class="highlight"><pre><span class="c1"># filename: example2.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="nb">require</span> <span class="s1">'headless'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@headless</span> <span class="o">=</span> <span class="no">Headless</span><span class="o">.</span><span class="n">new</span>
  <span class="vi">@headless</span><span class="o">.</span><span class="n">start</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="vi">@headless</span><span class="o">.</span><span class="n">destroy</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'The Internet'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">save_screenshot</span> <span class="s1">'example2.png'</span>
<span class="k">end</span>
</pre></div>

<p>In <code>setup</code> we are creating an instance of the headless library and issuing a <code>.start</code> command (which starts Xvfb). In <code>teardown</code> we stop Xvfb by with the <code>.destroy</code> after closing the browser with <code>@driver.quit</code>. The only thing that changed in our <code>run</code> action is the name of the screenshot (from <code>example1.png</code> to <code>example2.png</code>).</p>

<p>With the library in place, running the test (e.g., <code>ruby example2.rb</code>) will automatically run it headlessly -- starting and stopping Xvfb for us.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Xvfb starts</li>
<li>Test runs, launching a browser in a virtual framebuffer</li>
<li>Test passes and captures a screenshot from the browser</li>
<li>Xvfb terminates (unless using Option 1)</li>
</ul>

<h2>Choosing The Best Option</h2>

<p>The headless gem is a handy resource. But if you use it, you'll want to make its use configurable so it doesn't load every time. This will be helpful when running your tests in non-Linux environments.</p>

<p>If you're just looking to try out headless testing and you're unsure of how much time you want to invest, then using the Xvfb application (e.g., options 1 or 2) is a sound path since you won't need to update your test code to use it.</p>

<h2>Running Concurrent Builds</h2>

<p>If you're running tests headlessly across different builds at the same time (e.g., in parallel) on your CI server, then jobs will start break unexpectedly. This is because of a display port collision with Xvfb.</p>

<p>A good workaround is to use the CI build number as your Xvfb display port. This way each display port is unique. Each CI server is different, but you should have access to this value somehow. For example, this is made available through an environment variable in Jenkins.</p>

<p><strong>NOTE: Thanks to <a href="https://twitter.com/bbbco">Brian Goad</a> for contributing this workaround!</strong></p>

<h2>Outro</h2>

<p>Hopefully this tip has helped you get your tests running smoothly on your CI Server. For more information on taking screenshots with Selenium, check out <a href="http://elementalselenium.com/tips/16-take-screenshot-on-failure">Tip 16</a>. And to learn how to run a different browser locally (e.g., Chrome), check out <a href="http://elementalselenium.com/tips/29-chrome-driver">Tip 29</a>.</p>

<p>Stay tuned to future tips where I'll cover alternative approaches to running your tests headlessly.</p>

<p>Until then, Happy Testing!</p><br>
<hr>
<a name ="tips_39"></a>
<h2>39. How To Test HTML5 Drag and Drop <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/39-drag-and-drop">http://elementalselenium.com/tips/39-drag-and-drop</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#drag_and_drop #dnd #javascript #bug</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Exercising a page's dragging and dropping functionality used to be simple with <a href="http://selenium.googlecode.com/svn/trunk/docs/api/rb/Selenium/WebDriver/ActionBuilder.html">Selenium's Action Builder</a>, but sadly, <a href="https://code.google.com/p/selenium/issues/detail?id=6315">it won't work with HTML5 drag and drop</a>.</p>

<h2>A Solution</h2>

<p>As a workaround we can simulate dragging and dropping by executing JavaScript with Selenium. Let's dig in with an example.</p>

<h2>An Example</h2>

<p>You can see a simple HTML5 drag and drop example <a href="http://the-internet.herokuapp.com/drag_and_drop">here on the-internet</a>.</p>

<p>First, let's borrow <a href="https://gist.github.com/rcorreia/2362544">the JavaScript made available by rcorreia on GitHub</a> for this workaround and store it in a local file (e.g., <code>dnd.js</code>).</p>

<p>Now we can create a Selenium script to consume the JavaScript file, visit the page, execute the JavaScript, and perform an assertion.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>After including our dependent libraries, we wire up our <code>setup</code>, <code>teardown</code>, and <code>run</code> actions. Now we're ready to write our test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s2">"http://the-internet.herokuapp.com/drag_and_drop"</span>

  <span class="n">dnd_javascript</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span> <span class="o">+</span> <span class="s1">'/dnd.js'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="n">dnd_javascript</span><span class="o">+</span><span class="s2">"$('#column-a').simulateDragDrop({ dropTarget: '#column-b'});"</span><span class="p">)</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'column-a'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'B'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'column-b'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'A'</span>
<span class="k">end</span>
</pre></div>

<p>After loading the page we read in the <code>dnd.js</code> file and store it in a local variable. We then use Selenium to execute <code>dnd_javascript</code> along with the function calls and elements we want to work with. After that, it's just a simple matter of grabbing text from the page and making an assertion against it.</p>

<p>Since there are only two elements to drag and drop on the page, they should have switched places. So, <code>column-a</code> should now contain the text 'B', and <code>column-b</code> should contain the text 'A'.</p>

<h2>Outro</h2>

<p>Hopefully this tip has helped you figure out how to wrangle HTML5 dragging and dropping while there is a known bug for it in Selenium.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_40"></a>
<h2>40. How To Test For Disabled Elements <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/40-disabled-element">http://elementalselenium.com/tips/40-disabled-element</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#dropdown_list #dropdown_lists #disabled_element</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>On occasion you may have the need to check if an element on a page is disabled or enabled. Sounds simple enough, but how do you do it? It's not a well documented function of Selenium, especially across languages. So doing a trivial action like this can quickly become a pain.</p>

<h2>A Solution</h2>

<p>If we look at <a href="http://selenium.googlecode.com/git/docs/api/rb/Selenium/WebDriver/Element.html#enabled%3F-instance_method">the Selenium API documentation for Selenium's Element class</a> we can pretty easily discern that there is an available method (called <code>#enabled?</code>) to help us accomplish what we want.</p>

<p>Let's take a look at how to use it.</p>

<h2>An Example</h2>

<p>For this example we will use <a href="http://the-internet.herokuapp.com/dropdown">a dropdown list from the-internet</a>. In this list, there a few options to select, one which should be disabled. Let's find it and assert that it's disabled.</p>

<p>In our script we'll first want to require our dependent libraries and wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>
<span class="c1"># This is for RSpec's built in matchers</span>
<span class="c1"># e.g., this gives us .should be_true instead of .should == true</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now that we have that, we can wire up our test in a <code>run</code> block.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dropdown'</span>
  <span class="n">dropdowns</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">tag_name</span><span class="p">:</span> <span class="s1">'option'</span><span class="p">)</span>
  <span class="n">item_of_interest</span> <span class="o">=</span> <span class="n">dropdowns</span><span class="o">.</span><span class="n">find</span> <span class="p">{</span> <span class="o">|</span><span class="n">dropdown</span><span class="o">|</span> <span class="n">dropdown</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">'Please select an option'</span> <span class="p">}</span>
  <span class="n">item_of_interest</span><span class="o">.</span><span class="n">enabled?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_false</span>
<span class="k">end</span>
</pre></div>

<p>After loading the page, we find all of the elements that have an option tag (which are all of the items in the dropdown list). This will return an array, so we use <a href="http://ruby-doc.org/core-1.9.3/Enumerable.html#method-i-find">Ruby's Enumerable <code>.find</code> method</a> to walk through the collection and find the item we want based on a text comparison.</p>

<p>Once we have the element we want, it's just a simple matter of asking it if it's enabled with <code>.enabled?</code> (which gives us a boolean result) and performing an assertion against that.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Visit the page</li>
<li>Grab all dropdown list elements</li>
<li>Find the dropdown list element by it's text</li>
<li>Check to see if that element is enabled and assert that it isn't</li>
</ul>

<h2>Outro</h2>

<p>Hopefully this tip has helped make the simple task of seeing if an element is enabled or disabled more approachable.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_41"></a>
<h2>41. How To Run A Test On Multiple Browsers <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/41-one-test-multiple-browsers">http://elementalselenium.com/tips/41-one-test-multiple-browsers</a></h2>
<h3>INTERMEDIATE INFRASTRUCTURE</h3>
<h4>#multiple_browsers #cloud #sauce_labs</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>You'll occasionally have something that you want to test across multiple browsers. It would be nice to run your test once and have it execute against all of the browsers you care about. Unfortunately this functionality doesn't come out of the box with most testing frameworks.</p>

<h2>A Solution</h2>

<p>With the help of Sauce Labs, a collection, and a loop, we can easily specify a list of browsers and run a test against each of them.</p>

<p>Let's take a look at an example.</p>

<h2>An Example</h2>

<p>To start, we include our dependent libraries (<code>'selenium-webdriver'</code> to drive the browser, and <code>'rspec-expectations'</code> to perform our assertion) and then wire up <code>setup</code> and <code>teardown</code> methods.</p>

<p>In <code>setup</code> we are accepting two parameters -- <code>browser_name</code> and <code>browser_version</code>. We put these to use when specifying the browser and operating system capabilities for Sauce Labs, which gets stored in the <code>caps</code> variable. This variable then gets passed in as part of the <code>@driver</code> incantation.</p>

<p>And in <code>teardown</code> we destroy the browser session.</p>
<div class="highlight"><pre><span class="c1"># filename: example.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">browser_name</span><span class="p">,</span> <span class="n">browser_version</span><span class="p">)</span>
  <span class="n">caps</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Capabilities</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">browser_name</span><span class="o">.</span><span class="n">to_sym</span><span class="p">)</span>
  <span class="n">caps</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s1">'Windows XP'</span>
  <span class="n">caps</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">browser_version</span><span class="o">.</span><span class="n">to_s</span>

  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
    <span class="ss">:remote</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="s2">"http://</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_USERNAME'</span><span class="o">]</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_API_KEY'</span><span class="o">]</span><span class="si">}</span><span class="s2">@ondemand.saucelabs.com:80/wd/hub"</span><span class="p">,</span>
    <span class="n">desired_capabilities</span><span class="p">:</span> <span class="n">caps</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>
</pre></div>

<p>Note the <code>url:</code> in the <code>@driver</code> section above. It is concatenated from environment variables that are set at run time; like so.</p>
<div class="highlight"><pre><span class="nv">SAUCE_USERNAME</span><span class="o">=</span><span class="s1">'your sauce username'</span> <span class="nv">SAUCE_API_KEY</span><span class="o">=</span><span class="s1">'your sauce api key'</span> ruby example.rb
</pre></div>

<p>Next we specify the browsers and versions we care about in a collection (e.g., a Hash), create a <code>run</code> method, and wire it up to loop over the collection -- running <code>setup</code>, test actions, and <code>teardown</code> for each browser in the collection.</p>
<div class="highlight"><pre><span class="no">BROWSERS</span> <span class="o">=</span> <span class="p">{</span> <span class="n">firefox</span><span class="p">:</span> <span class="s1">'27'</span><span class="p">,</span>
             <span class="n">chrome</span><span class="p">:</span> <span class="s1">'32'</span><span class="p">,</span>
             <span class="n">internet_explorer</span><span class="p">:</span> <span class="s1">'8'</span> <span class="p">}</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="no">BROWSERS</span><span class="o">.</span><span class="n">each_pair</span> <span class="k">do</span> <span class="o">|</span><span class="n">browser</span><span class="p">,</span> <span class="n">browser_version</span><span class="o">|</span>
    <span class="n">setup</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="n">browser_version</span><span class="p">)</span>
    <span class="k">yield</span>
    <span class="n">teardown</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Once we have that, we wire up our test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'The Internet'</span>
<span class="k">end</span>
</pre></div>

<p>And when we run it, we should see three jobs appear in Sauce Labs.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Load Firefox, load the page, assert the title is correct</li>
<li>Load Chrome, load the page, assert the title is correct</li>
<li>Load IE, load the page, assert the title is correct</li>
</ul>

<h2>Outro</h2>

<p>Hopefully this tip has helped make multi-browser testing more approachable to you. In a future tip I'll cover how to make this approach more robust, taking into account different operating systems and making things run in parallel.</p>

<p>Until then, Happy Testing!</p><br>
<hr>
<a name ="tips_42"></a>
<h2>42. How To Run A Test On Multiple Browsers, In Parallel <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/42-one-test-multiple-browsers-parallel">http://elementalselenium.com/tips/42-one-test-multiple-browsers-parallel</a></h2>
<h3>INTERMEDIATE INFRASTRUCTURE</h3>
<h4>#parallelization #multiple_browsers #cloud #sauce</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In <a href="http://elementalselenium.com/tips/41-one-test-multiple-browsers">the last tip</a> I covered how to run a single test against multiple browsers. While this could come in handy, it is still a bit lacking.</p>

<p>Right now, the test is only being run one at a time (a.k.a. in series) for each browser in our list. If this were a longer running test and/or if there were more browsers we cared about, then this could quickly stack up to longer test run times.</p>

<h2>A Solution</h2>

<p>Let's remedy this by taking <a href="http://elementalselenium.com/tips/41-one-test-multiple-browsers">the previous tip's example</a> and parallelizing it with the help of <a href="http://www.tutorialspoint.com/ruby/ruby_multithreading.htm">threads</a>.</p>

<h2>An Example</h2>

<p>Our initial setup stays mostly the same. There are only a couple of minor changes we'll need to make.</p>
<div class="highlight"><pre><span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_USERNAME'</span><span class="o">]</span> <span class="o">=</span> <span class="s1">'your username'</span>
<span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_API_KEY'</span><span class="o">]</span>  <span class="o">=</span> <span class="s1">'your api key'</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>

<span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="n">browser_name</span><span class="p">,</span> <span class="n">browser_version</span><span class="p">)</span>
  <span class="n">caps</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Capabilities</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">browser_name</span><span class="o">.</span><span class="n">to_sym</span><span class="p">)</span>
  <span class="n">caps</span><span class="o">.</span><span class="n">platform</span> <span class="o">=</span> <span class="s1">'Windows XP'</span>
  <span class="n">caps</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">browser_version</span><span class="o">.</span><span class="n">to_s</span>

  <span class="no">Thread</span><span class="o">.</span><span class="n">current</span><span class="o">[</span><span class="ss">:driver</span><span class="o">]</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
    <span class="ss">:remote</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="s2">"http://</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_USERNAME'</span><span class="o">]</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'SAUCE_API_KEY'</span><span class="o">]</span><span class="si">}</span><span class="s2">@ondemand.saucelabs.com:80/wd/hub"</span><span class="p">,</span>
    <span class="n">desired_capabilities</span><span class="p">:</span> <span class="n">caps</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="no">Thread</span><span class="o">.</span><span class="n">current</span><span class="o">[</span><span class="ss">:driver</span><span class="o">].</span><span class="n">quit</span>
<span class="k">end</span>
</pre></div>

<p>Since we are working with threads, we will need to use variables that are thread safe. The best candidates are thread local variables. They have a global scope (similar to global variables) but are only accessible from within the thread that created it. This way we won't run into any odd collisions across simultaneous test runs.</p>

<p>So instead of instance variables (e.g., <code>@driver</code>) we are now storing each instance of Selenium in this new kind of variable and referencing it as needed (e.g., <code>Thread.current[:driver]</code>).</p>
<div class="highlight"><pre><span class="c1"># filename: example42.rb</span>

<span class="no">BROWSERS</span> <span class="o">=</span> <span class="p">{</span> <span class="n">firefox</span><span class="p">:</span> <span class="s1">'27'</span><span class="p">,</span>
             <span class="n">chrome</span><span class="p">:</span> <span class="s1">'32'</span><span class="p">,</span>
             <span class="n">internet_explorer</span><span class="p">:</span> <span class="s1">'8'</span> <span class="p">}</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">threads</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="no">BROWSERS</span><span class="o">.</span><span class="n">each_pair</span> <span class="k">do</span> <span class="o">|</span><span class="n">browser</span><span class="p">,</span> <span class="n">browser_version</span><span class="o">|</span>
    <span class="n">threads</span> <span class="o">&lt;&lt;</span> <span class="no">Thread</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
      <span class="n">setup</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="n">browser_version</span><span class="p">)</span>
      <span class="k">yield</span>
      <span class="n">teardown</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">threads</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">thread</span><span class="o">|</span> <span class="n">thread</span><span class="o">.</span><span class="n">join</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>Our browser list remains untouched, but our <code>run</code> method has been updated to spawn and join threads (which is how you finish a thread). With this setup a new thread will be spawned for each of the browsers in the list, perform its actions, and finish.</p>

<p>Will all of that in place, we just need to update our test to use the new thread local driver variable.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="no">Thread</span><span class="o">.</span><span class="n">current</span><span class="o">[</span><span class="ss">:driver</span><span class="o">].</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="no">Thread</span><span class="o">.</span><span class="n">current</span><span class="o">[</span><span class="ss">:driver</span><span class="o">].</span><span class="n">title</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s1">'The Internet'</span>
<span class="k">end</span>
</pre></div>

<p>If we run this script from the command line (<code>ruby examle42.rb</code>) and head over <a href="https://saucelabs.com/account">the Sauce Labs Account page</a>, then we should see three tests running simultaneously.</p>

<p>NOTE: the number of parallel sessions alotted to your Sauce Labs account will dictate how quickly your tests will finish. For instance, if you add two new browsers to <code>BROWSER_LIST</code> and run this, only 3 sessions will run in Sauce Labs, queuing the other two until some of the original sessions finish.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Simultaneously loads each browser in a Sauce Labs job</li>
<li>Each test loads the page and asserts the title is correct</li>
<li>Each session closes when it is complete</li>
</ul>

<h2>Outro</h2>

<p>There are alternative ways to run your tests in parallel. Some more notable approaches include:</p>

<ul>
<li>through a test framework (e.g., TestNG in Java)</li>
<li>through Continuous Integration</li>
<li>through a third-party library (e.g., <a href="https://github.com/grosser/parallel_tests">parallel_tests in Ruby</a>).</li>
</ul>

<p>For a full write-up on how to parallel_tests, check out <a href="http://elementalselenium.com/tips/27-parallel">tip 27</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_43"></a>
<h2>43. How To Test Forgot Password <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/43-forgot-password">http://elementalselenium.com/tips/43-forgot-password</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#forgot_password #email</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Testing e-mail can be a tricky process. Especially when dealing with things like forgot password. A lot of times this is something that gets checked manually. Or worse, it gets overlooked and ends up broken in production.</p>

<h2>A Solution</h2>

<p>By leveraging a third-party library we can perform an end-to-end test by accessing a forgot password email from a Gmail account headlessly (to get the information we need) and then put it to use with Selenium to make sure it works correctly.</p>

<p>Let's dig in with an example that uses <a href="http://the-internet.herokuapp.com/forgot_password">the forgot password example</a> on <a href="https://github.com/tourdedave/the-internet">the-internet</a>.</p>

<h2>An Example</h2>

<p>First let's include our dependent libraries (e.g., <code>selenium-webdriver</code> to control the browser, <code>rspec-expectations</code> and <code>RSpec::Matchers</code> for assertions, and <code>gmail</code> to access a Gmail account headlessly (<a href="https://github.com/dcparker/ruby-gmail">link</a>)) and create some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: forgot_password.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>
<span class="nb">require</span> <span class="s1">'gmail'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Once triggered, the forgot password e-mail should be received quickly. But since we're dealing with a third-party provider we'll want to build in some resiliency. So let's create a simple mechanism to retry our email lookup a configurable number of times and make it wait a handful of seconds in-between each attempt.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">try</span><span class="p">(</span><span class="n">number_of_times</span><span class="p">)</span>
  <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">item_of_interest</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="k">until</span> <span class="n">item_of_interest</span> <span class="o">!=</span> <span class="kp">nil</span> <span class="o">||</span> <span class="n">count</span> <span class="o">==</span> <span class="n">number_of_times</span>
    <span class="n">item_of_interest</span> <span class="o">=</span> <span class="k">yield</span>
    <span class="nb">sleep</span> <span class="mi">10</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>When calling this method, we will need to specify an integer for the number of times that we'd like to retry an action. And we'll specify the action by passing it to the method through the use of <code>yield</code> (which enables us to pass a block of code into the method -- just like we're doing for the <code>run</code> method). Between each attempt, the method will wait for <code>10</code> seconds.</p>

<p>Now let's wire up our test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/forgot_password'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'email'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'EMAIL_USERNAME'</span><span class="o">]</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'form_submit'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>

  <span class="n">gmail</span> <span class="o">=</span> <span class="no">Gmail</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'EMAIL_USERNAME'</span><span class="o">]</span><span class="p">,</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'EMAIL_PASSWORD'</span><span class="o">]</span><span class="p">)</span>
  <span class="n">try</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@email</span> <span class="o">=</span> <span class="n">gmail</span><span class="o">.</span><span class="n">inbox</span><span class="o">.</span><span class="n">emails</span><span class="p">(</span><span class="ss">:unread</span><span class="p">,</span> <span class="n">from</span><span class="p">:</span> <span class="s1">'no-reply@the-internet.herokuapp.com'</span><span class="p">)</span><span class="o">.</span><span class="n">last</span> <span class="p">}</span>
  <span class="n">message_body</span> <span class="o">=</span> <span class="vi">@email</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">raw_source</span>

  <span class="n">url</span> <span class="o">=</span>  <span class="n">message_body</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/https?:\/\/[\S]+/</span><span class="p">)</span><span class="o">.</span><span class="n">last</span>
  <span class="n">username</span> <span class="o">=</span> <span class="n">message_body</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/username: (.*)$/</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">0</span><span class="o">].</span><span class="n">strip</span>
  <span class="n">password</span> <span class="o">=</span> <span class="n">message_body</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/password: (.*)$/</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">0</span><span class="o">].</span><span class="n">strip</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="n">url</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">username</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span> <span class="n">password</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">current_url</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">'/secure'</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>

<p>We initiate the forgot password workflow by loading the page with the forgot password form, providing an email address, and submitting the form. We then access the Gmail account headlessly and retrieve the message body. Here is where we employ our <code>try</code> method (retrying the lookup action as many as <code>6</code> times).</p>

<p>Then we parse the email message body with regular expressions to find the URL &amp; user credentials and put these values to use with the browser session (which is still active) by visiting the URL and logging in.</p>

<p>Once done we assert that login was successful by checking to see if we gained access to a secure part of the site.</p>

<h2>Expected Behavior</h2>

<p>When we save this file and run it from the command-line (e.g., <code>ruby forgot_password.rb</code>), here is what will happen:</p>

<ul>
<li>Load the browser and initiate the forgot password workflow</li>
<li>Headlessly access Gmail and retrieve the email message body</li>
<li>Parse the message body for user credentials</li>
<li>Visit the site and login with the user credentials</li>
<li>Check that login was successful</li>
<li>Close the browser</li>
</ul>

<p><strong>NOTE: When running this script you can pass in the Gmail account username and password at runtime (e.g., <code>EMAIL_USERNAME=youremail@gmail.com EMAIL_PASSWORD=yourpassword ruby forgot_password.rb</code>).</strong></p>

<h2>Outro</h2>

<p>Your forgot password workflow might be different, so adapt as needed. And if you have other things in an e-mail message body that you need to parse for and aren't sure of the regular expressions you need -- give <a href="http://rubular.com/">Rubular</a> a try.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_44"></a>
<h2>44. How To Handle Exceptions <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/44-exception-handling">http://elementalselenium.com/tips/44-exception-handling</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#exceptions #exception_handling</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>It doesn't take long using Selenium before you run into error exceptions when trying to use what <em>seems</em> like a perfectly legitimate action. And they can be a bit of a shock if you're not sure what they are, how to handle them, or where to find documentation on them.</p>

<h2>A Solution</h2>

<p>Rather than let your tests get tripped up by exceptions, let's wrap them in a handler, and return a result our tests can use.</p>

<p>Let's take a look at an example.</p>

<h2>An Example</h2>

<p>NOTE: For this write-up we will use <a href="http://the-internet.herokuapp.com/login">the login example found on the-internet</a>.</p>

<p>To start things off, we require our dependent libraries (<code>selenium-webdriver</code> to drive the browser and <code>rspec-expectations</code> &amp; <code>RSpec::Matchers</code> to perform assertions). After that we wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> actions.</p>
<div class="highlight"><pre><span class="c1"># filename: exceptions_test.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>To demonstrate the problem, let's wire up a simple test to exercise the login page. For the final step, we will perform an assertion -- checking to see if the login form is not displayed.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/login'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'tomsmith'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'SuperSecretPassword!'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_false</span>
<span class="k">end</span>
</pre></div>

<p>When we run this (e.g., <code>ruby exceptions_test.rb</code>) our test will not complete -- throwing an exception on the last step.</p>
<div class="highlight"><pre>Unable to locate element: <span class="o">{</span><span class="s2">"method"</span>:<span class="s2">"id"</span>,<span class="s2">"selector"</span>:<span class="s2">"login"</span><span class="o">}</span> <span class="o">(</span>Selenium::WebDriver::Error::NoSuchElementError<span class="o">)</span>
</pre></div>

<p>In the Python Selenium bindings they have a section of actions called <a href="http://selenium.googlecode.com/git-history/selenium-2.30.0/docs/api/py/_modules/selenium/webdriver/support/expected_conditions.html">expected conditions</a>. One of them is designed specifically for this use case (called <code>visibility_of_element_located</code>). It checks to see if an element is displayed and returns <code>false</code> if it's not -- rather than throwing an exception.</p>

<p>Unfortunately the Ruby Selenium bindings do not come with this functionality built-in, and there are no plans to add them. So let's do it ourselves using some plain old Ruby.</p>

<p>We're going to need two things:</p>

<ol>
<li>A simple understanding exceptions and how to rescue them (here's <a href="http://www.skorks.com/2009/09/ruby-exceptions-and-exception-handling/">a quick Ruby primer on this topic</a>)</li>
<li>The name of the exception we want to rescue</li>
</ol>

<p>You can find a full list of the Selenium exceptions in Ruby <a href="https://selenium.googlecode.com/git/docs/api/rb/Selenium/WebDriver/Error.html">here</a>. But we shouldn't need them since our previous test run told us the name of the exception -- <code>Selenium::WebDriver::Error::NoSuchElementError</code>.</p>

<p>Let's put it to use by wrapping the last step in our test with a rescue block.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/login'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'tomsmith'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'SuperSecretPassword!'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
  <span class="k">begin</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span><span class="o">.</span><span class="n">should</span> <span class="n">be_false</span>
  <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">NoSuchElementError</span>
    <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Now if we run the test, it will pass. But this is far from a clean implementation. Let's spruce things up a little bit before we sign off on this.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">rescue_exceptions</span>
  <span class="k">begin</span>
    <span class="k">yield</span>
  <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">NoSuchElementError</span>
    <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">is_displayed?</span><span class="p">(</span><span class="n">locator</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="n">rescue_exceptions</span> <span class="p">{</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>By breaking apart our rescue block (into <code>rescue_exceptions</code>) and our <code>displayed?</code> lookup (into <code>is_displayed?</code>) we have a much cleaner implementation in our test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/login'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'username'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'tomsmith'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'password'</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="s1">'SuperSecretPassword!'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span><span class="p">)</span><span class="o">.</span><span class="n">submit</span>
  <span class="n">is_displayed?</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'login'</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">be_false</span>
<span class="k">end</span>
</pre></div>

<p>And if you wanted to add another exception to the mix, then you would simply add a new rescue along with the result you want in <code>rescue_exceptions</code>.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">rescue_exceptions</span>
  <span class="k">begin</span>
    <span class="k">yield</span>
  <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">NoSuchElementError</span>
    <span class="kp">false</span>
  <span class="k">rescue</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Error</span><span class="o">::</span><span class="no">StaleElementReferenceError</span>
    <span class="kp">false</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<ol>
<li>Visit the login page</li>
<li>Complete the login form</li>
<li>Submit the login form</li>
<li>Assert that the login form is not present</li>
</ol>

<h2>Outro</h2>

<p>Hopefully this tip has helped you learn how to work effectively with exceptions in Selenium.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_45"></a>
<h2>45. How To Test Checkboxes <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/45-checkboxes">http://elementalselenium.com/tips/45-checkboxes</a></h2>
<h3>BEGINNER TESTING</h3>
<h4>#checkboxes #attribute #selected</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Checkboxes are an often used element in web applications. But how do you work with them in your Selenium tests? Intuitively you may reach for a method that has the word 'checked' in it -- like <code>.checked?</code> or <code>.isChecked</code>. But this doesn't exist in Selenium. So how do you do it?</p>

<h2>A Solution</h2>

<p>There are two ways to approach this -- by seeing if an element has a <code>checked</code> attribute (a.k.a. performing an attribute lookup), or by asking an element if it has been <em>selected</em>.</p>

<p>Let's step through each approach to see the pros and cons of each.</p>

<h2>An Example</h2>

<p>For reference, here is the markup from <a href="http://the-internet.herokuapp.com/checkboxes">the page we will be testing against</a> (an example from <a href="https://github.com/tourdedave/the-internet">the-internet</a>).</p>
<div class="highlight"><pre><span class="nt">&lt;form&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span><span class="nt">&gt;</span> unchecked<span class="nt">&lt;br&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">checked=</span><span class="s">""</span><span class="nt">&gt;</span> checked
<span class="nt">&lt;/form&gt;</span>
</pre></div>

<p>We kick things off by requiring our dependent libraries (e.g., <code>selenium-webdriver</code> to drive the browser, and <code>rspec/expectations</code> &amp; <code>RSpec::Matchers</code> to handle our assertions) and wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods to abstract our test configuration.</p>
<div class="highlight"><pre><span class="c1"># filename: checkboxes.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Before we write any tests, let's walk through both checkbox approaches to see what Selenium gives us.</p>

<p>To do that we'll want to grab all of the checkboxes on the page, and iterate through them. Once using an attribute lookup, and again asking if the element is selected -- each time outputting the return value we get from Selenium.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/checkboxes'</span>
  <span class="n">checkboxes</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'input[type="checkbox"]'</span><span class="p">)</span>

  <span class="nb">puts</span> <span class="s2">"With .attribute('checked')"</span>
  <span class="n">checkboxes</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">checkbox</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">checkbox</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'checked'</span><span class="p">)</span><span class="o">.</span><span class="n">inspect</span> <span class="p">}</span>

  <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">With .selected?"</span>
  <span class="n">checkboxes</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">checkbox</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">checkbox</span><span class="o">.</span><span class="n">selected?</span><span class="o">.</span><span class="n">inspect</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>

<p>When we save our file and run it (e.g., <code>ruby checkboxes.rb</code> from the command-line), here is the output we'll see.</p>
<div class="highlight"><pre>With .attribute<span class="o">(</span><span class="s1">'checked'</span><span class="o">)</span>
nil
<span class="s2">"true"</span>

With .selected?
<span class="nb">false</span>
<span class="nb">true</span>
</pre></div>

<p>With the attribute lookup, depending on the state of the checkbox, we receive either a <code>nil</code> or a string with the value <code>"true"</code>. Whereas with <code>.selected?</code> we get a boolean (<code>true</code> or <code>false</code>) response.</p>

<p>Let's see what these approaches look like when put to use in a test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/checkboxes'</span>
  <span class="n">checkboxes</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'input[type="checkbox"]'</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">checkboxes</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'checked'</span><span class="p">))</span><span class="o">.</span><span class="n">not_to</span> <span class="n">be_nil</span>
  <span class="c1"># alternatively</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">checkboxes</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'checked'</span><span class="p">))</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s2">"true"</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>With an attribute lookup, the simplest thing to do is to assert that the return value is not <code>nil</code>. Alternatively we could have checked for the value <code>"true"</code>. Let's see what the other approach looks like.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/checkboxes'</span>
  <span class="n">checkboxes</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'input[type="checkbox"]'</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">checkboxes</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">selected?</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>

<p>When checking to see if a checkbox has been selected, it's a simple matter of checking for a boolean value.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Find all of the checkboxes</li>
<li>Assert that the last checkbox (the one that is supposed to be checked on page load) is checked</li>
</ul>

<h2>Outro</h2>

<p>Attribute lookups are built for pulling information out of the page for review. While they work in this circumstance, you might be better off using a selected lookup. But the approach you choose will depend on how the checkbox form you're testing is constructed. </p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_46"></a>
<h2>46. How To Run Your Tests Headlessly with Ghost Driver <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/46-headless-ghostdriver">http://elementalselenium.com/tips/46-headless-ghostdriver</a></h2>
<h3>INTERMEDIATE INFRASTRUCTURE</h3>
<h4>#headless #ghostdriver #phantomjs</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In a previous tip I covered <a href="http://elementalselenium.com/tips/38-headless">how to run tests headlessly with Xvfb</a>. It's a good approach, but what if you run into issues with it? Or better yet, what if you're left feeling underwhelmed by the speed of your test runs?</p>

<h2>A Solution</h2>

<p>Enter <a href="https://github.com/detro/ghostdriver">GhostDriver</a> and <a href="http://phantomjs.org/">PhantomJS</a>.</p>

<p>PhantomJS is a headless WebKit browser, and GhostDriver is an implementation of the WebDriver Wire Protocol that's built into PhantomJS.</p>

<p>Setup is simple and your local test execution speeds will be much faster as a result (since it's a lean browser that offers full JavaScript rendering that doesn't penalize you with slow startup times).</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>Before we get started we need to grab a copy of PhantomJS from <a href="http://phantomjs.org/download.html">the project download page</a>.</p>

<p>Once we have it we can launch it from the command-line by specifying a <code>--webdriver</code> flag along with a port (e.g., <code>=8001</code>).</p>
<div class="highlight"><pre>&gt; phantomjs --webdriver<span class="o">=</span>8001
PhantomJS is launching GhostDriver...
<span class="o">[</span>INFO  - 2014-04-16T02:07:51.015Z<span class="o">]</span> GhostDriver - Main - running on port 8001
</pre></div>

<p>Now that PhantomJS is running and ready to receive WebDriver commands (via GhostDriver), we can create an instance of Selenium that connects to it by using Selenium Remote.</p>

<p>To demonstrate, here's a simple test script.</p>
<div class="highlight"><pre><span class="c1"># filename: ghost_driver.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:remote</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="s1">'http://localhost:8001'</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'The Internet'</span>
<span class="k">end</span>
</pre></div>

<p>After pulling in our requisite libraries (e.g., <code>selenium-webdriver</code> to driver the browser and <code>rspec/expections</code> &amp; <code>RSpec::Matchers</code> for our assertion) we wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>

<p>The <code>run</code> block is our test. It visits the homepage of <a href="http://the-internet.herokuapp.com/">the-internet</a> and checks the title to verify the page loaded.</p>

<h2>Expected Behavior</h2>

<p>When we save this and run it (e.g., <code>ruby ghost_driver.rb</code> from the command-line) here is what will happen.</p>

<ul>
<li>Connect to PhantomJS</li>
<li>Load the site headlessly in PhantomJS</li>
<li>Grab the title text from the page</li>
<li>Assert that the text includes <code>'The Internet'</code></li>
<li>Close the headless browser</li>
</ul>

<h2>Outro</h2>

<p>You can also run GhostDriver within Selenium Grid. You can learn more about that <a href="https://github.com/detro/ghostdriver#register-ghostdriver-with-a-selenium-grid-hub">here</a>.</p>

<p>Hopefully this tip has helped you get started with an alternative approach to running your tests headlessly..</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_47"></a>
<h2>47. Explicit Vs Implicit Waits <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/47-waiting">http://elementalselenium.com/tips/47-waiting</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#waiting #dynamic_pages #explicit_waits #implicit_waits</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In order to make our Selenium tests resilient, we need to make them wait for certain elements to load. Elements that we want to interact with. This is especially true with JavaScript heavy pages. And the standard advice from the Selenium team is to use explicit waits (see <a href="http://elementalselenium.com/tips/23-dynamic-pages">tip 23</a> for a detailed explanation and example of explicit waits).</p>

<p>This is in lieu of an implicit wait (e.g., setting a default amount of time for Selenium to wait if it can't perform an action immediately) and/or static sleeps. Avoiding static sleeps should be obvious (e.g., don't force your tests to wait a <em>hard-coded</em> amount of time to perform an action -- it's bad news) but what about an implicit wait? Is there still value in using it? Or is it just old news that is likely to be deprecated in a future version of Selenium? And what about using them together?</p>

<h2>A Solution</h2>

<p>The short answer? Use explicit waits. Adding an implicit wait to your Selenium tests is simple enough and may seem intuitive. But there are cases where it simply doesn't help you like you think it will. And while you can combine explicit and implicit waits together (e.g., override an implicit wait with an explicit wait to make a Selenium action wait longer) -- you shouldn't. More on that later.</p>

<p>Let's dig in with some examples.</p>

<h2>An Example</h2>

<p>Let's step through some examples that deal with <a href="http://the-internet.herokuapp.com/dynamic_loading">dynamically loaded content</a> available on <a href="https://github.com/tourdedave/the-internet">the-internet</a>. There are two examples that are constructed differently but have the same behavior (e.g., when you click the button on the page a loading bar appears for 5 seconds then disappears and displays some text).</p>

<p>First, let's pull in our dependent libraries (e.g., <code>selenium-webdriver</code> to drive the browser, and <code>rspec/expectations</code> and <code>RSpec::Matchers</code> for our assertions) and wire up some simple methods (e.g., <code>setup</code>, <code>teardown</code>, and <code>run</code>) to handle our test configuration.</p>
<div class="highlight"><pre><span class="c1"># filename: waiting.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">manage</span><span class="o">.</span><span class="n">timeouts</span><span class="o">.</span><span class="n">implicit_wait</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Notice that in <code>setup</code> we are specifying an implicit wait of <code>3</code> seconds. This tells Selenium to retry each <code>find_element</code> action for up to 3 seconds. If it can complete the action in that amount of time, it will proceed onto the next command. Otherwise it will raise a timeout exception.</p>

<p>Now let's add our first test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dynamic_loading/1'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#start button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#finish'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#finish'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>In this example the element we're interested in is already on the page, just hidden. When we run this (e.g., <code>ruby waiting.rb</code> from the command-line) the <code>.displayed?</code> step won't trigger the implicit wait. Instead, it will immediately proceed to the text assertion which will fail because the progress bar hasn't finished loading.</p>

<p>Let's run the same test against the other dynamic loading example.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dynamic_loading/2'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#start button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#finish'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#finish'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>In this example the element we're interested in gets rendered <em>after</em> the loading bar. When we run this (e.g., <code>ruby waiting.rb</code> from the command-line) the <code>.displayed?</code> step will wait as we intend, but the assertion will still fail. That's because the implicit wait is not long enough (because the loading bar takes 5 seconds to complete).</p>

<p>Now we're at a cross-roads. Do we increase the implicit wait to account for this? That would be a simple enough fix for this example. But in real life it's not a great option since it would impact <em>all</em> of the tests that use this setup. Instead, we can use an explicit wait.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">timeout</span><span class="p">:</span> <span class="n">seconds</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dynamic_loading/2'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#start button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="n">wait_for</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#finish'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span> <span class="p">}</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#finish'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>If we wrap our <code>.displayed?</code> action in an explicit wait we are able to override the implicit wait and wait for up 10 seconds. Now when we run our test, our test will pass. And if we revisit our first example and do the same, then it will pass too.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dynamic_loading/1'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#start button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="n">wait_for</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#finish'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span> <span class="p">}</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#finish'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<h2>On Not Mixing Explicit and Implicit Waits</h2>

<p>If your test suite uses both explicit and implicit waits, then you're in for some pain (e.g., transient failures as you scale your test suite). For more details about this, check out <a href="http://stackoverflow.com/questions/15164742/combining-implicit-wait-and-explicit-wait-together-results-in-unexpected-wait-ti#answer-15174978">this StackOverflow answer</a> from <a href="https://twitter.com/jimevansmusic">Jim Evans</a> (a member of the Selenium core team).</p>

<p>The best thing is to only use explicit waits. We already have them in place, so we can go ahead and remove the implicit wait from our <code>setup</code> method.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<p>If we save the file and run it (e.g., <code>ruby waiting.rb</code> from the command-line) here is what will happen.</p>

<ul>
<li>Visit the page</li>
<li>Click the Start button</li>
<li>Wait for the progress bar to disappear</li>
<li>Assert that the finish text appears on the page</li>
</ul>

<h2>Outro</h2>

<p>While an implicit wait can be useful, providing you an initial blanket of cover, it's not ideal for every circumstance. Instead explicit waits are a better tool for the job since they provide more resilient and predictable results (even if they make your test code more verbose).</p>

<p>Regardless of the approach you choose, be sure to remember never to mix implicit and explicit waits together.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_48"></a>
<h2>48. How To Do Load Testing <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/48-load-testing">http://elementalselenium.com/tips/48-load-testing</a></h2>
<h3>ADVANCED TESTING</h3>
<h4>#load_testing</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>One of the most commonly asked questions in Selenium is <em>"How do you do load testing?"</em>. The often stated short answer is <em>"Well... you don't"</em>.</p>

<p>There are plenty of resources citing that while it <em>can</em> be done there are better tools for the job. Tools like <a href="https://jmeter.apache.org/">JMeter</a> are often recommended. But they can be intimidating and challenging to get started with.</p>

<p>If you start to go down this rabbit hole then there are a couple of options. You could stand up a Selenium Grid with a bunch of host nodes, run a big suite of tests in parallel, and hope for the best. You could also do this with a cloud provider (instead of maintaining your own Grid). But these are hard enough to get right when you're just trying to get your automated tests working well in the first place. Alternatively, you could go with a third-party provider like <a href="http://www.neustar.biz/services/web-performance/load-testing">Neustar</a> to help you on your way, but that might not be your cup of tea.</p>

<p>Regardless of the approach, it can be a bumpy road to do load testing.</p>

<h2>A Solution</h2>

<p>Rather than invest time, money, and frustration into JMeter, a Selenium infrastructure, or a third-party provider, we can generate a good amount of load by leveraging an existing Selenium script, a proxy server, and an HTTP client library along with some parallel threads.</p>

<p>With a proxy server we can capture the HTTP requests generated by Selenium and replay them with an HTTP client library in parallel -- effectively replicating the same actions hitting the web server simultaneously, in large numbers.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>Before we get started we'll need to <a href="http://bmp.lightbody.net/">download a copy of BrowserMob Proxy</a>. Once we have that, we'll want to include our requisite libraries:</p>

<ul>
<li><code>selenium-webdriver</code> to control the browser</li>
<li><code>browsermob/proxy</code> to configure/use BrowserMob Proxy</li>
<li><code>typhoeus</code> to replay HTTP requests</li>
</ul>

<p>After that, we can create methods to configure the proxy server (<code>configure_proxy</code>), set the browser profile to use the proxy server (<code>browser_profile</code>), pull these together so the test will have a working browser that uses the proxy server (<code>setup</code>), and tear things down after running the test (<code>teardown</code>).</p>
<div class="highlight"><pre><span class="c1"># filename: load.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'browsermob/proxy'</span>
<span class="nb">require</span> <span class="s1">'typhoeus'</span>

<span class="k">def</span> <span class="nf">configure_proxy</span>
  <span class="n">proxy_binary</span> <span class="o">=</span> <span class="no">BrowserMob</span><span class="o">::</span><span class="no">Proxy</span><span class="o">::</span><span class="no">Server</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'./browsermob-proxy/bin/browsermob-proxy'</span><span class="p">)</span>
  <span class="n">proxy_binary</span><span class="o">.</span><span class="n">start</span>
  <span class="n">proxy_binary</span><span class="o">.</span><span class="n">create_proxy</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">browser_profile</span>
  <span class="n">browser_profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="n">browser_profile</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="vi">@proxy</span><span class="o">.</span><span class="n">selenium_proxy</span>
  <span class="n">browser_profile</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@proxy</span> <span class="o">=</span> <span class="n">configure_proxy</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">browser_profile</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">close</span>
<span class="k">end</span>
</pre></div>

<p>Next we'll want to tell the proxy server to capture traffic and return a payload (a.k.a. a HTTP Archive, or HAR). For easier debugging later, we will want to add some error handling to output the results from each HTTP request that's replayed (<code>error_handling</code>).</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">capture_traffic</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">new_har</span>
  <span class="k">yield</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">har</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">error_handling</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
  <span class="n">request</span><span class="o">.</span><span class="n">on_complete</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">success?</span>
      <span class="nb">puts</span> <span class="s2">"success"</span>
    <span class="k">elsif</span> <span class="n">response</span><span class="o">.</span><span class="n">timed_out?</span>
      <span class="nb">puts</span> <span class="s2">"got a time out"</span>
    <span class="k">elsif</span> <span class="n">response</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">0</span>
      <span class="c1"># Could not get an http response, something's wrong.</span>
      <span class="nb">puts</span> <span class="n">response</span><span class="o">.</span><span class="n">return_message</span>
    <span class="k">else</span>
      <span class="c1"># Received a non-successful http response.</span>
      <span class="nb">puts</span> <span class="s2">"HTTP request failed: "</span> <span class="o">+</span> <span class="n">response</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">to_s</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Now for the meat of the issue -- replaying the requests.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">replay</span><span class="p">(</span><span class="n">http_requests</span><span class="p">,</span> <span class="n">number_of_replays</span><span class="p">,</span> <span class="n">debug</span> <span class="o">=</span> <span class="kp">false</span><span class="p">)</span>
  <span class="n">requests</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">http_requests</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span>
    <span class="n">requests</span> <span class="o">&lt;&lt;</span> <span class="no">Typhoeus</span><span class="o">::</span><span class="no">Request</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
      <span class="n">entry</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
      <span class="nb">method</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">method</span><span class="o">.</span><span class="n">downcase</span><span class="o">.</span><span class="n">to_sym</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">start_time</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
  <span class="nb">puts</span> <span class="s2">"Start time: </span><span class="si">#{</span><span class="n">start_time</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">threads</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">number_of_replays</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
    <span class="n">threads</span> <span class="o">&lt;&lt;</span> <span class="no">Thread</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
      <span class="n">requests</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">request</span><span class="o">|</span>
        <span class="n">error_handling</span> <span class="n">request</span> <span class="k">if</span> <span class="n">debug</span>
        <span class="n">request</span><span class="o">.</span><span class="n">run</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">threads</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">thread</span><span class="o">|</span> <span class="n">thread</span><span class="o">.</span><span class="n">join</span> <span class="p">}</span>
  <span class="n">finish_time</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
  <span class="nb">puts</span> <span class="s2">"Finish time: </span><span class="si">#{</span><span class="n">finish_time</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">number_of_replays</span><span class="si">}</span><span class="s2"> runs completed in </span><span class="si">#{</span><span class="n">finish_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">}</span><span class="s2"> seconds"</span>
<span class="k">end</span>
</pre></div>

<p>We start by iterating through each of the entries in the HAR payload, creating a new request for Typhoeus to use -- storing them all in an array.</p>

<p>After printing the current time to the terminal, we create a new thread and execute all of the Typhoeus HTTP requests within it (outputting the error handling for each request if a debug parameter is passed in). This gets repeated based on the number of times specified when <code>replay</code> is called.</p>

<p>After the threads run and terminate, we output the current time, and then list the total time run time along with the number of replays attempted.</p>

<p>We can now pull all of this together by implementing a simple <code>run</code> method.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="n">http_requests</span> <span class="o">=</span> <span class="n">capture_traffic</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
  <span class="n">teardown</span>
  <span class="n">replay</span><span class="p">(</span><span class="n">http_requests</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>If we wanted to see the debug output, we would pass in <code>true</code> as a third parameter like so:</p>
<div class="highlight"><pre><span class="n">replay</span><span class="p">(</span><span class="n">http_requests</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="kp">true</span><span class="p">)</span>
</pre></div>

<p>Now that everything's wired up, we can drop our Selenium actions into a run block.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dynamic_loading/2'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#start button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">timeout</span><span class="p">:</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#finish'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>If we run this script without debugging turned on, then we should see something like this:</p>
<div class="highlight"><pre>Start <span class="nb">time</span>: 2014-04-30 14:22:33 -0400
Finish <span class="nb">time</span>: 2014-04-30 14:23:10 -0400
100 runs completed in 37.575052 seconds
</pre></div>

<h2>Expected Behavior</h2>

<ul>
<li>Load a browser</li>
<li>Visit the page and complete the actions specified while capturing the HTTP requests</li>
<li>Close the browser and shutdown the proxy server</li>
<li>Replay the HTTP requests generated by Selenium 100 times in parallel</li>
</ul><br>
<hr>
<a name ="tips_49"></a>
<h2>49. How To Do Performance Testing <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/49-performance-testing">http://elementalselenium.com/tips/49-performance-testing</a></h2>
<h3>ADVANCED TESTING</h3>
<h4>#performance_testing #proxy #browsermob-proxy #yslow</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Odds are pretty good that your production application has some kind of performance monitoring in place (e.g., New Relic). This goes a long way towards identifying when something detrimental has been released into the wild.</p>

<p>But how do you catch performance issues before they reach production?</p>

<h2>A Solution</h2>

<p>By repurposing a Selenium script, we can run it through a proxy server and capture the HTTP traffic. With this traffic, we can run some simple checks to see if the application's performance has degraded.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>Before we get started we'll need to <a href="http://bmp.lightbody.net/">download a copy of BrowserMob Proxy</a>. Once we have that, we'll want to include our requisite libraries:</p>

<ul>
<li><code>selenium-webdriver</code> to control the browser</li>
<li><code>browsermob/proxy</code> to configure/user BrowserMob Proxy</li>
<li><code>rspec=expectations</code> and <code>RSpec::Matchers</code> for assertions</li>
<li><code>json</code> to consume JSON data for the performance checks</li>
</ul>

<p>After that, we can create methods to configure the proxy server (<code>configure_proxy</code>), set the browser profile to use the proxy server (<code>browser_profile</code>), pull these together so the test will have a working browser that uses the proxy server (<code>setup</code>), and tear things down after running the test (<code>teardown</code>).</p>
<div class="highlight"><pre><span class="c1"># filename: performance.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'browsermob/proxy'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>
<span class="nb">require</span> <span class="s1">'json'</span>

<span class="k">def</span> <span class="nf">configure_proxy</span>
  <span class="n">proxy_binary</span> <span class="o">=</span> <span class="no">BrowserMob</span><span class="o">::</span><span class="no">Proxy</span><span class="o">::</span><span class="no">Server</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'./browsermob-proxy/bin/browsermob-proxy'</span><span class="p">)</span>
  <span class="n">proxy_binary</span><span class="o">.</span><span class="n">start</span>
  <span class="n">proxy_binary</span><span class="o">.</span><span class="n">create_proxy</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">browser_profile</span>
  <span class="n">browser_profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="n">browser_profile</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="vi">@proxy</span><span class="o">.</span><span class="n">selenium_proxy</span>
  <span class="n">browser_profile</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@proxy</span> <span class="o">=</span> <span class="n">configure_proxy</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">browser_profile</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">close</span>
<span class="k">end</span>
</pre></div>

<p>Next we'll want to tell the proxy server to capture traffic and return a payload (a.k.a. a HTTP Archive, or HAR for short).</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">capture_traffic</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">new_har</span>
  <span class="k">yield</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">har</span>
<span class="k">end</span>
</pre></div>

<p>We then tie this all together with a <code>run</code> method. It will call <code>setup</code>, execute test commands while capturing traffic (<code>capture_traffic</code>), save the HAR to a uniquely named file (which is named with a time stamp), and tear everything down when it's done (<code>teardown</code>).</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="n">har</span> <span class="o">=</span> <span class="n">capture_traffic</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
  <span class="vi">@har_file</span> <span class="o">=</span> <span class="s2">"./selenium_</span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%m%d%y_%H%M%S"</span><span class="p">)</span><span class="si">}</span><span class="s2">.har"</span>
  <span class="n">har</span><span class="o">.</span><span class="n">save_to</span> <span class="vi">@har_file</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now we can put all of this to use by exercising a feature of our application with some Selenium commands.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dynamic_loading/2'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#start button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">timeout</span><span class="p">:</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#finish'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>If we run this script (e.g., <code>ruby performance.rb</code> from the command-line) then we will see the browser load, complete some actions, and close. After which, a HAR file will appear in the working directory.</p>

<p>This outputted file is what we'll use to perform some simple benchmark checks.</p>

<p>Rather than identify specific benchmarks to check, let's run through a gamut of them by leveraging a pre-existing benchmarking tool like <a href="https://developer.yahoo.com/yslow/">YSlow</a>. Fortunately, there is <a href="http://yslow.org/command-line-har/">a command-line YSlow tool</a> that can consume a HAR file and provide us with useful output.</p>

<p>It's a Node.js app. So first we'll need to <a href="http://nodejs.org/">install Node.js</a>, and then install the app (with <code>npm install yslow -g</code>).</p>

<p>After that, we can run it from the command line like so:</p>

<p><code>yslow --info basic --format plain example.har</code></p>

<p>This will consume a HAR file and output some helpful information -- including an overall score.</p>
<div class="highlight"><pre>size: 476.8K <span class="o">(</span>476888 bytes<span class="o">)</span>
overall score: A <span class="o">(</span>99<span class="o">)</span>
url: http://the-internet.herokuapp.com/dynamic_loading/2
<span class="c"># of requests: 16</span>
ruleset: ydefault
</pre></div>

<p>This overall score is what we are interested in. To get at it, we'll need to change the format type from <code>plain</code> to <code>json</code>.</p>

<p><code>yslow --info basic --format json example.har</code></p>

<p>This will return a Hash that we can then easily parse through to get the value we want (e.g., the overall score with a key of <code>"o"</code>).</p>
<div class="highlight"><pre><span class="o">{</span><span class="s2">"w"</span>:476887,<span class="s2">"o"</span>:99,<span class="s2">"u"</span>:<span class="s2">"http%3A%2F%2Fthe-internet.herokuapp.com%2Fdynamic_loading%2F2"</span>,<span class="s2">"r"</span>:16,<span class="s2">"i"</span>:<span class="s2">"ydefault"</span><span class="o">}</span>
</pre></div>

<p>Now we can automate the YSlow command-line execution and perform an assertion by adding the following to the end of our script.</p>
<div class="highlight"><pre><span class="n">performance_results</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span> <span class="sb">`yslow --info basic --format json </span><span class="si">#{</span><span class="vi">@har_file</span><span class="si">}</span><span class="sb">`</span>
<span class="n">performance_grade</span> <span class="o">=</span> <span class="n">performance_results</span><span class="o">[</span><span class="s2">"o"</span><span class="o">]</span>
<span class="n">performance_grade</span><span class="o">.</span><span class="n">should</span> <span class="n">be</span> <span class="o">&gt;</span> <span class="mi">95</span>
</pre></div>

<p>Now when we run this if the overall score drops below a 95 out of 100 then the test will fail.</p>

<p>From here we can wire this up to a Continuous Integration server and run it headlessly (either with <a href="http://elementalselenium.com/tips/38-headless">Xvfb</a> or <a href="http://elementalselenium.com/tips/46-headless-ghostdriver">GhostDriver</a>) to perform these checks in an ongoing basis.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Load the browser</li>
<li>Capture all requests through the proxy server</li>
<li>Save the captured requests to a HTTP Archive (HAR) file on disk</li>
<li>Run the HAR file through YSlow to get a numeric grade</li>
<li>Assert that the grade is above a certain level</li>
</ul>

<h2>Outro</h2>

<p>You can see the full code example <a href="https://gist.github.com/tourdedave/bc4b75fd6cdc1eef7860">here</a>.</p>

<p>For more insights into what HAR is and the many uses of it, check out <a href="http://www.igvita.com/2012/08/28/web-performance-power-tool-http-archive-har/">this write-up and video from Ilya Grigorik's blog</a>. You can also <a href="http://www.softwareishard.com/blog/har-12-spec/">check out the HAR spec</a>. And there's also <a href="https://www.youtube.com/watch?v=qQgDDAan4rM">a great presentation from David Burns and David Henderson at GTAC 2009</a> on using Selenium to do performance benchmarking.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_50"></a>
<h2>50. How To Work with Hovers <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/50-hovers">http://elementalselenium.com/tips/50-hovers</a></h2>
<h3>BEGINNER TESTING</h3>
<h4>#hovers #action_builder</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>If you need to work with hovers in your tests, it may not be obvious how to do this in Selenium. A quick search through the documentation will leave you where you started, forcing you to go spelunking through StackOverflow for the solution.</p>

<h2>A Solution</h2>

<p>By leveraging the <a href="https://selenium.googlecode.com/git/docs/api/rb/Selenium/WebDriver/ActionBuilder.html">Action Builder</a> in Selenium, we can handle more complex user interactions, like hovers. This is done by telling Selenium which element to move the mouse to.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>Our example application is available <a href="http://the-internet.herokuapp.com/hovers">here</a>. It has a few avatars displayed in a grid layout. When you hover over each of them, they display additional user information and a link to view the full profile. Let's write a test that will hover over the first one and grab the URL of the link from the hover.</p>

<p>First, we'll want to include our requisite libraries and wire up some <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: hover.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now we can write our Selenium actions and assertion.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/hovers'</span>
  <span class="n">avatar</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">class</span><span class="p">:</span> <span class="s1">'figure'</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">avatar</span><span class="p">)</span><span class="o">.</span><span class="n">perform</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">timeout</span><span class="p">:</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">class</span><span class="p">:</span> <span class="s1">'figcaption'</span><span class="p">)</span><span class="o">.</span><span class="n">displayed?</span>
  <span class="k">end</span>
  <span class="n">user_url</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'.figcaption &gt; a'</span><span class="p">)</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'href'</span><span class="p">)</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">user_url</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'http://the-internet.herokuapp.com/users/1'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>After loading the page, we find the first avatar and store it in a variable (<code>avatar</code>). We then use <a href="https://selenium.googlecode.com/git/docs/api/rb/Selenium/WebDriver/ActionBuilder.html#move_to-instance_method">the <code>move_to</code> function from action builder</a> and feed the <code>avatar</code> variable to it (which will trigger the hover).</p>

<p>Next, we perform an explicit wait, to make sure the hover is displayed before proceeding. We then grab the URL text from the hover and perform an assertion against it, making sure it's what we expect.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Hover over the first avatar</li>
<li>Grab the URL from the hover link</li>
<li>Assert that the URL is what we expected</li>
</ul>

<h2>Outro</h2>

<p>Hovers can sometimes be tricky when run across different browsers. If you want to test your scripts against different browsers, feel free to grab the code used to test this example across Firefox 27, Chrome 32, and Internet Explorer 8 -- available <a href="https://gist.github.com/tourdedave/72ef1b93b8d8a9e602f3">here</a>.</p><br>
<hr>
<a name ="tips_51"></a>
<h2>51. How To Work with Java Script Alerts <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/51-javascript-alerts">http://elementalselenium.com/tips/51-javascript-alerts</a></h2>
<h3>BEGINNER TESTING</h3>
<h4>#javascript_alerts #javascript_popups #javascript_dialogs</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>If your application triggers any JavaScript popups (a.k.a. alerts, dialogs, etc.) then you need to know how to handle them in your Selenium tests.</p>

<h2>A Solution</h2>

<p>Built into Selenium is the ability to switch to an alert window and either accept or dismiss it. This way your tests can continue unencumbered by dialog boxes that may feel just out of reach.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>Our example application is available <a href="http://the-internet.herokuapp.com/javascript_alerts">here</a>. It has various JavaScript Alerts available (e.g., an Alert, a Confirmation, and a Prompt). Let's demonstrate testing a confirmation dialog.</p>

<p>First, we'll include our requisite libraries and wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Next, we can write our test.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/javascript_alerts'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'button'</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">click</span>

  <span class="n">popup</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span>
  <span class="n">popup</span><span class="o">.</span><span class="n">accept</span>

  <span class="n">result</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'result'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'You clicked: Ok'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>Since we want to click on the second button to trigger a simple JavaScript confirmation dialog (which will have 'Ok' and 'Cancel' buttons) we need to find all of the buttons on the page using <code>find_elements</code> (since there are no unique IDs on the buttons) and click on the second one.</p>

<p>Since <code>find_elements</code> returns all found elements in an Array, we can assume that the first item can be selected using <code>[0]</code> and the second item with <code>[1]</code> (since arrays in Ruby start counting at 0). If we wanted to select the last one, we could use <code>[-1]</code>.</p>

<p>We then use Selenium's <code>switch_to.alert</code> method to focus on the JavaScript popup and use <code>accept</code> to click 'Ok'. If we wanted to click 'Cancel' we would have used <code>dismiss</code>.</p>

<p>After accepting the alert, our main browser window will regain focus. Since the app will display the result that we chose, we base our assertion off of that -- making sure that 'Ok' was clicked.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Click the second button on the page (to trigger a JavaScript alert dialog popup)</li>
<li>Accept the JavaScript alert</li>
<li>Assert that the result on the page is what we expect</li>
</ul>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_52"></a>
<h2>52. How To Use Selenium Grid <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/52-grid">http://elementalselenium.com/tips/52-grid</a></h2>
<h3>INTERMEDIATE INFRASTRUCTURE</h3>
<h4>#grid #selenium_grid #cross_browser</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>If you're looking to run your tests on different browser and operating system combinations but you're unable to justify using a third-party solution like <a href="https://saucelabs.com/">Sauce Labs</a> or <a href="http://www.browserstack.com/">Browser Stack</a> then what do you do?</p>

<h2>A Solution</h2>

<p>With <a href="https://github.com/SeleniumHQ/selenium/wiki/Grid2">Selenium Grid</a> you can stand up a simple infrastructure of various browsers on different operating systems to not only distribute test load, but also give you a diversity of browsers to work with.</p>

<h2>A brief Selenium Grid primer</h2>

<p>Selenium Grid is part of <a href="http://www.seleniumhq.org/">the Selenium project</a>. It lets you distribute test execution across several machines. You can connect to it with Selenium Remote by specifying the browser, browser version, and operating system you want. You specify these values through Selenium Remote's <code>Capabilities</code>.</p>

<p>There are two main elements to Selenium Grid -- a hub, and nodes. First you need to stand up a hub, and then you can connect (or "register") nodes to that hub. Nodes are where your tests will run, and the hub is responsible for making sure your tests end up on the right one (e.g., the machine with the operating system and browser you specified).</p>

<h2>An Example</h2>

<h3>Part 1: Grid Setup</h3>

<p>Selenium Grid comes built into the Selenium Standalone Server. So to get started we'll need to download the latest version from <a href="http://selenium-release.storage.googleapis.com/index.html">here</a>.</p>

<p>Once we have it we can start the hub.</p>
<div class="highlight"><pre>java -jar selenium-server-standalone-2.42.0.jar -role hub
</pre></div>

<p>After that we can register nodes to it.</p>
<div class="highlight"><pre>java -jar selenium-server-standalone-2.42.0.jar -role node -hub http://localhost:4444/grid/register
</pre></div>

<p><strong>NOTE: This example only demonstrates a single node on the same machine as the hub. To span nodes across multiple machines you will need to place the standalone server on each machine and launch it with the same registration command (replacing <code>http://localhost</code> with the location of your hub, and specifying additional parameters as needed).</strong></p>

<p>Now that the grid is running we can view the available browsers by visiting our Grid's console at <code>http://localhost:4444/grid/console</code>.</p>

<p>To refine the list of available browsers, we can specify an additional <code>-browser</code> parameter when registering the node. For instance, if we wanted to only offer Safari on a node, we could specify it with <code>-browser browserName=safari</code>, which would look like this:</p>
<div class="highlight"><pre>java -jar selenium-server-standalone-2.42.0.jar -role node -browser <span class="nv">browserName</span><span class="o">=</span>safari -hub http://localhost:4444/grid/register
</pre></div>

<p>We could also repeat this parameter again if we wanted to explicitly specify more than one browser.</p>
<div class="highlight"><pre>java -jar selenium-server-standalone-2.42.0.jar -role node -browser <span class="nv">browserName</span><span class="o">=</span>safari -browser <span class="nv">browserName</span><span class="o">=</span>chrome -browser <span class="nv">browserName</span><span class="o">=</span>firefox -hub http://localhost:4444/grid/register
</pre></div>

<p>There are numerous parameters that we can use at run time. You can see a full list <a href="https://github.com/SeleniumHQ/selenium/wiki/Grid2#optional-parameters">here</a>.</p>

<h3>Part 2: Test Setup</h3>

<p>Let's wire up a simple test script to use our new Grid.</p>

<p>First, we'll need to require our necessary libraries and wire up <code>setup</code>, <code>teardown</code>, and <code>run</code> methods. After that it's just a simple matter of adding in some Selenium commands and an assertion to make sure the browser is doing what we expect.</p>
<div class="highlight"><pre><span class="c1"># filename: grid.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
    <span class="ss">:remote</span><span class="p">,</span>
    <span class="n">url</span><span class="p">:</span> <span class="s1">'http://localhost:4444/wd/hub'</span><span class="p">,</span>
    <span class="n">desired_capabilities</span><span class="p">:</span> <span class="ss">:firefox</span><span class="p">)</span> <span class="c1"># you can also use :chrome, :safari, etc.</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'The Internet'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>Notice in this configuration we're using Selenium Remote (e.g., <code>Selenium::WebDriver.for(:remote,</code>) to run against the grid. And we are telling the grid which browser we want through the <code>desired_capabilities</code> (e.g., <code>:firefox</code>).</p>

<p>An alternative way to configure this would be to create a Selenium Remote Capabilities object for the browser we want, modify it as needed, and then pass it to <code>desired_capabilities</code>. Like so:</p>
<div class="highlight"><pre><span class="n">caps</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Capabilities</span><span class="o">.</span><span class="n">firefox</span>
<span class="n">caps</span><span class="o">[</span><span class="ss">:platform</span><span class="o">]</span> <span class="o">=</span> <span class="ss">:mac</span> <span class="c1"># you can also use :any, :win, or :x</span>

<span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span><span class="p">(</span>
  <span class="ss">:remote</span><span class="p">,</span>
  <span class="n">url</span><span class="p">:</span> <span class="s1">'http://localhost:4444/wd/hub'</span><span class="p">,</span>
  <span class="n">desired_capabilities</span><span class="p">:</span> <span class="n">caps</span><span class="p">)</span>
</pre></div>

<p>You can see a full list of the available Selenium <code>Capabilities</code> <a href="https://github.com/SeleniumHQ/selenium/wiki/DesiredCapabilities">here</a>.</p>

<h2>Expected Behavior</h2>

<p>When we save this file and run it (e.g., <code>ruby grid.rb</code> from the command-line) the test will run and the following things will happen:</p>

<ul>
<li>connect to the grid</li>
<li>the hub will determine which node has the necessary browser/platform combination and connect the test to it</li>
<li>the test will open an instance of the browser on the node</li>
<li>the test will run and close the browser when finished</li>
</ul>

<h2>Outro</h2>

<p>If you're looking to set up Selenium Grid to work with Internet Explorer or Chrome, be sure to read up on how to set them up since there is additional configuration required for each. And if you run into issues, be sure to check out the browser driver documentation for the browser you're working with:</p>

<ul>
<li><a href="https://github.com/SeleniumHQ/selenium/wiki/ChromeDriver">ChromeDriver</a></li>
<li><a href="https://github.com/SeleniumHQ/selenium/wiki/FirefoxDriver">FirefoxDriver</a></li>
<li><a href="https://github.com/SeleniumHQ/selenium/wiki/InternetExplorerDriver">InternetExplorerDriver</a></li>
<li><a href="https://github.com/SeleniumHQ/selenium/wiki/SafariDriver">SafariDriver</a></li>
</ul>

<p>Also, it's worth noting that while Selenium Grid is a great option for scaling your test infrastructure, it by itself will NOT give you parallelization. That is to say, it can handle as many connections as you throw at it (within reason), but you will still need to find a way to execute your tests in parallel. You can see some previous write-ups on how to accomplish this <a href="http://elementalselenium.com/tips/tags/parallelization">here</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_53"></a>
<h2>53. How To Add Growl Notifications To Your Tests <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/53-growl">http://elementalselenium.com/tips/53-growl</a></h2>
<h3>INTERMEDIATE REPORTING</h3>
<h4>#jquery #growl #growl_notifications #jquery-growl</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Good test reports are a fundamental component of successful test automation. But running down a test failure by looking at a test report can be a real pain sometimes.</p>

<p>Leaving you with no choice but to roll up your sleeves and get your hands dirty with debug statements, or step through things piece by piece -- all for the sake of trying to track down a transient issue.</p>

<h2>A Solution</h2>

<p>By leveraging something like <a href="http://ksylvest.github.io/jquery-growl/">jQuery Growl</a> you can output non-interactive debugging statements directly to the page you're testing. This way you can see helpful information and more-likely correlate it to the test actions that are being taken. This can a boon for your test runs when coupled with screenshots and/or video recordings of your test runs </p>

<p>Let's step through an example of how to set this up.</p>

<h2>An Example</h2>

<p>First, we'll include our requisite libraries and wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: growl.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Next we'll need to visit the page we want to display notifications on and do some work with JavaScript to load <a href="http://jquery.com/">jQuery</a>, jQuery Growl, and styles for jQuery Growl. After that, we can issue commands to jQuery Growl to make notification messages display on the page.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>

  <span class="c1"># Step 1: check for jQuery on the page, add it if needbe</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"if (!window.jQuery) {</span>
<span class="s2">    var jquery = document.createElement('script'); jquery.type = 'text/javascript';</span>
<span class="s2">    jquery.src = 'https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js';</span>
<span class="s2">    document.getElementsByTagName('head')[0].appendChild(jquery);</span>
<span class="s2">  }"</span><span class="p">)</span>

  <span class="c1"># Step 2: use jQuery to add jquery-growl to the page</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$.getScript('http://the-internet.herokuapp.com/js/vendor/jquery.growl.js')"</span><span class="p">)</span>

  <span class="c1"># Step 3: use jQuery to add jquery-growl styles to the page</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$('head').append('&lt;link rel=</span><span class="se">\"</span><span class="s2">stylesheet</span><span class="se">\"</span><span class="s2"> href=</span><span class="se">\"</span><span class="s2">http://the-internet.herokuapp.com/css/jquery.growl.css</span><span class="se">\"</span><span class="s2"> type=</span><span class="se">\"</span><span class="s2">text/css</span><span class="se">\"</span><span class="s2"> /&gt;');"</span><span class="p">)</span>

  <span class="c1"># Step 4: display a message with jquery-growl</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$.growl({ title: 'GET', message: '/' });"</span><span class="p">)</span>

  <span class="nb">sleep</span> <span class="mi">5</span> <span class="c1"># to keep the browser active long enough to see the notifications</span>
<span class="k">end</span>
</pre></div>

<p>And if we wanted to see color-coded notifications, then we could use one of the following:</p>
<div class="highlight"><pre>  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$.growl.error({ title: 'ERROR', message: 'your error message goes here' });"</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$.growl.notice({ title: 'Notice', message: 'your notice message goes here' });"</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$.growl.warning({ title: 'Warning!', message: 'your warning message goes here' });"</span><span class="p">)</span>
</pre></div>

<h2>Expected Behavior</h2>

<ul>
<li>Load the page</li>
<li>Display a set of notification messages in the top-right corner of the page</li>
<li>Notification messages disappear</li>
</ul>

<h2>Outro</h2>

<p>In order to use this approach, you will need to load jQuery Growl on every page you want to display output to -- which can be a bit of overhead. But if you want rich messaging like this, then that's the price you have to pay (unless you can get your team to add it to the application under test).</p>

<p>In a future tip I'll step through how to access Selenium logging output so we can wire it up to these notifications.</p>

<p>I'd like to give a big thanks to Jon Austen (<a href="https://twitter.com/austenjt">Twitter</a>, <a href="https://github.com/djangofan">GitHub</a>, <a href="http://jonausten.info/">Blog</a>) for giving me the idea to use jQuery Growl with Selenium.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_54"></a>
<h2>54. How To Access Selenium Logs In Real Time <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/54-logging">http://elementalselenium.com/tips/54-logging</a></h2>
<h3>ADVANCED LOGGING</h3>
<h4>#logging #logs #growl #growl_notifications</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Logging is a deep rabbit hole to fall down in Selenium. <a href="https://code.google.com/p/selenium/wiki/Logging">The documentation</a> isn't complete and the approach for each of the browser and language bindings is inconsistent and hard to find examples for.</p>

<h2>A Solution</h2>

<p>By accessing what we want through the <a href="https://code.google.com/p/selenium/wiki/JsonWireProtocol">WebDriver Wire Protocol</a>, we can get at the logs we want in a browser agnostic way that also gets us the information in real time.</p>

<h2>An Example</h2>

<p>First, we'll need to <a href="http://selenium-release.storage.googleapis.com/index.html">download a copy of Selenium Standalone Server</a> and launch it.</p>
<div class="highlight"><pre>java -jar selenium-server-standalone-2.42.0.jar
</pre></div>

<p>Next, we'll want to create a mechanism to access the Selenium Server logs through the WebDriver Wire Protocol via an HTTP library -- filtering out the logs we don't want and return the most recent one.</p>
<div class="highlight"><pre><span class="c1"># filename: logger.rb</span>

<span class="nb">require</span> <span class="s1">'rest-client'</span>
<span class="nb">require</span> <span class="s1">'json'</span>

<span class="k">class</span> <span class="nc">Logger</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
    <span class="vi">@session_id</span> <span class="o">=</span> <span class="n">session_id</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">latest</span>
    <span class="n">parse</span><span class="p">(</span><span class="n">fetch</span><span class="p">)</span><span class="o">.</span><span class="n">last</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">fetch</span>
    <span class="no">RestClient</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
      <span class="s2">"http://127.0.0.1:4444/wd/hub/session/</span><span class="si">#{</span><span class="vi">@session_id</span><span class="si">}</span><span class="s2">/log"</span><span class="p">,</span>
      <span class="p">{</span> <span class="s2">"type"</span> <span class="o">=&gt;</span> <span class="s2">"client"</span> <span class="p">}</span><span class="o">.</span><span class="n">to_json</span><span class="p">,</span>
      <span class="n">content_type</span><span class="p">:</span> <span class="ss">:json</span><span class="p">,</span>
      <span class="n">accept</span><span class="p">:</span> <span class="ss">:json</span>
    <span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="n">logs</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="o">[]</span>
    <span class="n">logs</span><span class="o">[</span><span class="s2">"value"</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span>
      <span class="n">msg</span> <span class="o">=</span> <span class="n">entry</span><span class="o">[</span><span class="s2">"message"</span><span class="o">]</span>
      <span class="k">unless</span> <span class="n">msg</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"session:"</span> <span class="ow">or</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"fetching logs"</span> <span class="ow">or</span>
          <span class="n">msg</span><span class="o">.</span><span class="n">include?</span> <span class="s2">"execute script"</span>
            <span class="n">messages</span> <span class="o">&lt;&lt;</span> <span class="n">msg</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="sr">/handle(.*)$/</span><span class="p">)</span><span class="o">[-</span><span class="mi">1</span><span class="o">][-</span><span class="mi">1</span><span class="o">]</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">messages</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>A couple of things to point out in this class.</p>

<p>The <code>session_id</code> will come from the instance of Selenium that gets created in our test (via Selenium Remote). This ID maps to a URI endpoint on the Selenium Server that we use to get the logging payload with an HTTP POST (see <code>fetch</code>). We are then taking that payload (which comes back as a JSON object in String form) and parsing it into JSON, iterating through it, grabbing the relevant bits we want (see <code>parse</code>). When that's all done, we return the last entry found (see <code>latest</code>).</p>

<p>And of <a href="https://code.google.com/p/selenium/wiki/Logging#Log_Types">all the available log types we can access</a>, we're grabbing the client logs (which will give us the real time actions taken in our test).</p>

<p><strong>NOTE: Each time we access the logs, it will clear the cache of logs. So the next time we access them, it will only return new entries.</strong></p>

<p>Now we're ready to wire up our test to use the Selenium Server, access our logger class, and output the latest log entries after each Selenium action.</p>
<div class="highlight"><pre><span class="c1"># filename: log_test.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>
<span class="n">require_relative</span> <span class="s1">'logger'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:remote</span><span class="p">,</span> <span class="n">url</span><span class="p">:</span> <span class="s1">'http://127.0.0.1:4444/wd/hub'</span>
  <span class="vi">@logger</span> <span class="o">=</span> <span class="no">Logger</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">session_id</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="nb">puts</span> <span class="vi">@logger</span><span class="o">.</span><span class="n">latest</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">click</span>
  <span class="nb">puts</span> <span class="vi">@logger</span><span class="o">.</span><span class="n">latest</span>
<span class="k">end</span>
</pre></div>

<p>When we run this (e.g., <code>ruby log_test.rb</code>), here's what we should see.</p>
<div class="highlight"><pre> Done: <span class="o">[</span>get: http://the-internet.herokuapp.com<span class="o">]</span>
 Done: <span class="o">[</span>click: 23 <span class="o">[[</span>FirefoxDriver: firefox on MAC <span class="o">(</span>2afa5f83-1aba-ad43-b1f3-9b4907ae9471<span class="o">)]</span> -&gt; css selector: a<span class="o">]]</span>
</pre></div>

<p>If we couple this with jQuery Growl Notifications (<a href="http://elementalselenium.com/tips/53-growl">covered in the last tip</a>) then we can really put this information to work.</p>

<p>Let's add some helper methods to add jQuery Growl to the page and display notification messages.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">add_growl_notifications</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"if (!window.jQuery) {</span>
<span class="s2">      var jquery = document.createElement('script'); jquery.type = 'text/javascript';</span>
<span class="s2">      jquery.src = 'https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js';</span>
<span class="s2">      document.getElementsByTagName('head')[0].appendChild(jquery);</span>
<span class="s2">    }"</span><span class="p">)</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$.getScript('http://the-internet.herokuapp.com/js/vendor/jquery.growl.js')"</span><span class="p">)</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$('head').append('&lt;link rel=</span><span class="se">\"</span><span class="s2">stylesheet</span><span class="se">\"</span><span class="s2"> href=</span><span class="se">\"</span><span class="s2">http://the-internet.herokuapp.com/css/jquery.growl.css</span><span class="se">\"</span><span class="s2"> type=</span><span class="se">\"</span><span class="s2">text/css</span><span class="se">\"</span><span class="s2"> /&gt;');"</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">display_growl_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$.growl({ title: 'Selenium', message: '</span><span class="si">#{</span><span class="n">message</span><span class="si">}</span><span class="s2">' });"</span><span class="p">)</span>
  <span class="nb">sleep</span> <span class="mi">2</span>
<span class="k">end</span>
</pre></div>

<p>Now let's update our test to perform an action and then display it through jQuery Growl notifications.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">add_growl_notifications</span>
  <span class="n">display_growl_message</span><span class="p">(</span><span class="vi">@logger</span><span class="o">.</span><span class="n">latest</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>When we run this (e.g., <code>ruby log_test.rb</code>), we should see the latest log action appear in a growl notification within the browser window.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Load the browser</li>
<li>Take an action</li>
<li>Grab the action from the logs</li>
<li>Display the action</li>
</ul>

<h2>Outro</h2>

<p>Stay tuned for a future tip where I'll cover how to wrap this behavior so it automatically occurs on every Selenium action for every page.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_55"></a>
<h2>55. How To Add A Wrapper To Your Selenium Tests <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/55-wrapper">http://elementalselenium.com/tips/55-wrapper</a></h2>
<h3>INTERMEDIATE INFRASTRUCTURE</h3>
<h4>#wrapper #growl #growl_notifications</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In <a href="http://elementalselenium.com/tips/54-logging">a previous tip</a> I stepped through how to access Selenium logs in real time. But the final implementation was a bit lacking. We had to explicitly request the logs after each test action, which is fine for one-offs. But what if we wanted information for <strong>every</strong> test action?</p>

<h2>A Solution</h2>

<p>Instead of hard-coding logging requests all over the place, we can leverage an event listener to give us the information we want -- automatically and for each Selenium action.</p>

<h2>A brief primer on Event Listeners in Selenium</h2>

<p>This functionality is built in to Selenium in what's called the <a href="https://code.google.com/p/selenium/source/browse/rb/lib/selenium/webdriver/support/abstract_event_listener.rb">AbstractEventListener</a>. This is a class which comes preloaded with helper methods that enable us to add behavior before and after common Selenium actions -- here's a list of the available methods:</p>

<ul>
<li><code>before_navigate_to</code></li>
<li><code>after_navigate_to</code></li>
<li><code>before_navigate_back</code></li>
<li><code>after_navigate_back</code></li>
<li><code>before_navigate_forward</code></li>
<li><code>after_navigate_forward</code></li>
<li><code>before_find</code></li>
<li><code>after_find</code></li>
<li><code>before_click</code></li>
<li><code>after_click</code></li>
<li><code>before_change_value_of</code></li>
<li><code>after_change_value_of</code></li>
<li><code>before_execute_script</code></li>
<li><code>after_execute_script</code></li>
<li><code>before_quit</code></li>
<li><code>after_quit</code></li>
<li><code>before_close</code></li>
<li><code>after_close</code></li>
</ul>

<p>We can pick and choose from each of these methods and specify the additional behavior we want to occur. After that, it's just a simple matter of passing this information to Selenium when creating a browser instance.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>To start, let's create a <code>Wrapper</code> class that inherits from <code>AbstractEventListener</code> and add our behavior there.</p>

<p>The helper methods we're interested in are <code>after_navigate_to</code>, <code>before_find</code>, <code>after_find</code>, <code>before_click</code>, and <code>after_click</code> and they each require different arguments to be specified. See <a href="https://code.google.com/p/selenium/source/browse/rb/lib/selenium/webdriver/support/abstract_event_listener.rb#30">here</a> for details.</p>

<p>And to make things interesting, let's wire up <a href="http://elementalselenium.com/tips/53-growl">jQuery Growl notifications</a>.</p>
<div class="highlight"><pre><span class="c1"># filename: wrapper.rb</span>

<span class="k">class</span> <span class="nc">Wrapper</span> <span class="o">&lt;</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Support</span><span class="o">::</span><span class="no">AbstractEventListener</span>

  <span class="k">def</span> <span class="nf">after_navigate_to</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">driver</span><span class="p">)</span>
    <span class="n">add_growl</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
    <span class="n">display_growl</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">"Navigated to </span><span class="si">#{</span><span class="n">url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">before_find</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">driver</span><span class="p">)</span>
    <span class="n">display_growl</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">"Finding element </span><span class="si">#{</span><span class="n">what</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">after_find</span><span class="p">(</span><span class="n">by</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">driver</span><span class="p">)</span>
    <span class="n">display_growl</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">"Found element </span><span class="si">#{</span><span class="n">what</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">before_click</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">driver</span><span class="p">)</span>
    <span class="n">display_growl</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">"Clicking on </span><span class="si">#{</span><span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="vi">@pre_click_url</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">current_url</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">after_click</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">driver</span><span class="p">)</span>
    <span class="k">unless</span> <span class="vi">@pre_click_url</span> <span class="o">==</span> <span class="n">driver</span><span class="o">.</span><span class="n">current_url</span>
      <span class="n">add_growl</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
      <span class="n">display_growl</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">"URL changed to </span><span class="si">#{</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="k">def</span> <span class="nf">add_growl</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
     <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"if (!window.jQuery) {</span>
<span class="s2">        var jquery = document.createElement('script'); jquery.type = 'text/javascript';</span>
<span class="s2">        jquery.src = 'https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js';</span>
<span class="s2">        document.getElementsByTagName('head')[0].appendChild(jquery);</span>
<span class="s2">      }"</span><span class="p">)</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$.getScript('http://the-internet.herokuapp.com/js/vendor/jquery.growl.js')"</span><span class="p">)</span>

    <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$('head').append('&lt;link rel=</span><span class="se">\"</span><span class="s2">stylesheet</span><span class="se">\"</span><span class="s2"> href=</span><span class="se">\"</span><span class="s2">http://the-internet.herokuapp.com/css/jquery.growl.css</span><span class="se">\"</span><span class="s2"> type=</span><span class="se">\"</span><span class="s2">text/css</span><span class="se">\"</span><span class="s2"> /&gt;');"</span><span class="p">)</span> 

    <span class="nb">sleep</span> <span class="mi">1</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">display_growl</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s2">"$.growl({ title: 'Selenium', message: '</span><span class="si">#{</span><span class="n">message</span><span class="si">}</span><span class="s2">' });"</span><span class="p">)</span>
    <span class="nb">sleep</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>Our Event Listener helper methods give us access to the driver object at the precise moments we want in our test steps, and by wiring up growl notifications (see <code>add_growl</code> and <code>display_growl</code>) we can now display notification messages in the browser window automatically without any additional work in our test code.</p>

<p>Let's go ahead and wire up our test code to use this new wrapper.</p>
<div class="highlight"><pre><span class="c1"># filename: wrapper_test.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="n">require_relative</span> <span class="s1">'wrapper'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="n">listener</span><span class="p">:</span> <span class="no">Wrapper</span><span class="o">.</span><span class="n">new</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'a'</span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">click</span>
<span class="k">end</span>
</pre></div>

<p>Everything here is pretty standard with the exception of two small changes to handle our wrapper. We first need to include the file (<code>require_relative 'wrapper'</code>) and then pass in an instance of the wrapper to Selenium (<code>listener: Wrapper.new</code>).</p>

<p>Now if we run our test (<code>ruby wrapper_test.rb</code>) then we will see notification messages appear around each of the test actions as they occur.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Load the browser</li>
<li>Load jQuery if it's not already loaded</li>
<li>Load jQuery Growl and it's styles</li>
<li>Display notifications in the browser window for each of the test actions</li>
</ul>

<h2>See a Demo</h2>

<iframe src="//player.vimeo.com/video/98736887" width="500" height="313" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>

<p><br>
Happy Testing!</p><br>
<hr>
<a name ="tips_56"></a>
<h2>56. How To Automatically Retry Failed Tests <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/56-retry-failed-tests">http://elementalselenium.com/tips/56-retry-failed-tests</a></h2>
<h3>ADVANCED PATTERNS</h3>
<h4>#retry #failure_retry #reliability</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>You want reliable tests. But no matter how hard you try, you're going to run into intermittent test failures. These can be frustrating time wasters that distract you and your team and begin to erode the trust placed in the automated tests. Once that begins, it's a slippery slope.</p>

<h2>A Solution</h2>

<p>Rather than rerun your entire test suite to suss out transient failures -- you can log which tests fail, and retry just those a second time.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>Let's assume we have a bunch of tests written in <a href="http://rspec.info/">RSpec</a>, which would look something like this:</p>
<div class="highlight"><pre>??? spec
    ??? 11_spec.rb
    ??? 1_spec.rb
    ??? 2_spec.rb
    ??? 3_spec.rb
    ??? 4_spec.rb
    ??? 5_spec.rb
    ??? 6_spec.rb
    ??? 7_spec.rb
    ??? 8_spec.rb
    ??? 9_spec.rb
    ??? this_spec.rb
</pre></div>

<p>And let's assume that we will execute these tests in parallel (using <a href="https://github.com/grosser/parallel_tests">parallel_tests</a>).</p>

<p>Some of the tests will pass, and some of them will fail. In order to track which ones fail, we will want to keep a log. The simplest way to do this would be to output a list of failures to a file. That way the list of failures will persist after the suite of tests completes, so we can perform a retry action using the list of failures.</p>

<p>Thankfully RSpec comes with some of the plumbing to help accomplish this -- through the use of a <a href="https://github.com/dchelimsky/rspec/wiki/Custom-Formatters">custom formatter</a>; specifically the <a href="http://rubydoc.info/gems/rspec-core/2.6.4/RSpec/Core/Formatters/BaseFormatter">base formatter</a>.</p>

<p>Let's create one.</p>
<div class="highlight"><pre><span class="c1"># filename: failure_catcher.rb</span>

<span class="nb">require</span> <span class="s1">'rspec/core/formatters/base_formatter'</span>

<span class="k">class</span> <span class="nc">FailureCatcher</span> <span class="o">&lt;</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Formatters</span><span class="o">::</span><span class="no">BaseFormatter</span>

  <span class="c1"># create files called rspec_#.failures with a list of failed examples</span>
  <span class="k">def</span> <span class="nf">dump_failures</span>
    <span class="k">return</span> <span class="k">if</span> <span class="n">failed_examples</span><span class="o">.</span><span class="n">empty?</span>
    <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">"rspec</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'TEST_ENV_NUMBER'</span><span class="o">]</span><span class="si">}</span><span class="s2">.failures"</span><span class="p">,</span> <span class="s2">"w+"</span><span class="p">)</span>
    <span class="n">failed_examples</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
      <span class="n">f</span><span class="o">.</span><span class="n">puts</span> <span class="n">retry_command</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">retry_command</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
    <span class="n">example_name</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">full_description</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="p">,</span> <span class="s2">"</span><span class="se">\\\"</span><span class="s2">"</span><span class="p">)</span>
    <span class="s2">"-e </span><span class="se">\"</span><span class="si">#{</span><span class="n">example_name</span><span class="si">}</span><span class="se">\"</span><span class="s2">"</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>In order to extend the base formatter we first need to require it, and then inherit from it when declaring our class (e.g., <code>&lt; RSpec::Core::Formatters::BaseFormatter</code>).</p>

<p>After that we have access to the helper method we want (e.g., <code>dump_failures</code>). In <code>dump_failures</code> we can access detailed information about each failed test through the <code>failed_examples</code> accessor.</p>

<p>After checking to see if there are any failed examples, we create a new uniquely named file (leveraging the environment variable created by our parallel executor), iterate through all of the failed examples, and store a properly formatted retry execution command with the name of the failed test.</p>

<p>To use this formatter we'll need to specify it at run-time, and to leverage a retry action we'll need to wrap our run-time execution. Let's wire all of this up using <a href="https://github.com/jimweirich/rake">Rake</a>.</p>
<div class="highlight"><pre><span class="c1"># filename: Rakefile</span>

<span class="k">def</span> <span class="nf">gather_failures</span>
  <span class="n">opts</span> <span class="o">=</span> <span class="s2">""</span>
  <span class="n">files</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'*.failures'</span><span class="p">)</span>
  <span class="n">files</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span> <span class="n">opts</span> <span class="o">&lt;&lt;</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\n/</span><span class="p">,</span> <span class="s1">' '</span><span class="p">)</span> <span class="p">}</span>
  <span class="n">all_failures</span> <span class="o">=</span> <span class="s1">'./all.failures'</span>
  <span class="no">File</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">all_failures</span><span class="p">,</span> <span class="n">opts</span><span class="o">.</span><span class="n">rstrip</span><span class="p">)</span>
  <span class="k">return</span> <span class="no">File</span><span class="o">.</span><span class="n">read</span> <span class="n">all_failures</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="n">files</span> <span class="o">=</span> <span class="s1">''</span><span class="p">)</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">"rm </span><span class="si">#{</span><span class="n">files</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span> <span class="k">unless</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"</span><span class="si">#{</span><span class="n">files</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="n">empty?</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="n">params</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="k">if</span> <span class="n">params</span><span class="o">[</span><span class="ss">:test_options</span><span class="o">].</span><span class="n">include?</span> <span class="s1">'-e'</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:test_options</span><span class="o">].</span><span class="n">split</span><span class="p">(</span><span class="sr">/failed/</span><span class="p">)</span><span class="o">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="nb">puts</span> <span class="s2">"Retrying </span><span class="si">#{</span><span class="n">count</span><span class="si">}</span><span class="s2"> failed tests!"</span>
  <span class="k">end</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">"parallel_rspec -n </span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:processes</span><span class="o">]</span> <span class="o">||</span> <span class="mi">5</span><span class="si">}</span><span class="s2"> \</span>
<span class="s2">          --test-options '</span><span class="si">#{</span><span class="n">params</span><span class="o">[</span><span class="ss">:test_options</span><span class="o">]</span><span class="si">}</span><span class="s2">' spec"</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">processes</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
  <span class="n">launch</span><span class="p">(</span><span class="n">processes</span><span class="p">:</span> <span class="n">processes</span><span class="p">,</span>
    <span class="n">test_options</span><span class="p">:</span> <span class="s1">'--require ./failure_catcher.rb \</span>
<span class="s1">    --format FailureCatcher'</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">rerun</span><span class="p">(</span><span class="n">processes</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
  <span class="n">launch</span><span class="p">(</span><span class="n">processes</span><span class="p">:</span> <span class="n">processes</span><span class="p">,</span> <span class="n">test_options</span><span class="p">:</span> <span class="n">gather_failures</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">desc</span> <span class="s2">"parallel test execution with failure retries"</span>
<span class="n">task</span> <span class="ss">:run_tests</span><span class="p">,</span> <span class="ss">:number_of_processes</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="p">,</span> <span class="n">args</span><span class="o">|</span>
  <span class="n">run</span> <span class="n">args</span><span class="o">[</span><span class="ss">:number_of_processes</span><span class="o">]</span>
  <span class="k">unless</span> <span class="vg">$?</span><span class="o">.</span><span class="n">success?</span>
    <span class="n">rerun</span> <span class="n">args</span><span class="o">[</span><span class="ss">:number_of_processes</span><span class="o">]</span>
    <span class="n">cleanup</span> <span class="s1">'*.failures'</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>There are five methods and one Rake task. The first two methods (<code>gather_failures</code> and <code>cleanup</code>) are for rounding up a list of failed tests from the *.failure files and deleting them when we're finished. The next three methods (<code>launch</code>, <code>run</code>, and <code>rerun</code>) are for executing the test suite and retrying just the failures.</p>

<p>The Rake task is where we tie everything together.</p>

<p>In it we make the number of concurrent processes configurable through the use of an optional run-time argument. We then call <code>run</code> (passing in the argument) which executes the full suite. After the suite completes, we perform a check against the exit code to see if there were any failures. If there were, then we call <code>rerun</code> (along with the argument for number of processes),  and then call <code>cleanup</code> to remove the failure files.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Tests execute in parallel</li>
<li>A list of failed tests get stored in output files (one for each process)</li>
<li>Failed tests get rerun</li>
<li>Output files for failed tests get deleted</li>
</ul>

<h2>Outro</h2>

<p>Hat-tip to <a href="https://github.com/dblock/rspec-rerun">rspec-rerun</a> for the initial implementation, and to <a href="http://artsy.github.io/blog/2012/05/15/how-to-organize-over-3000-rspec-specs-and-retry-test-failures/">the write-up that led me there</a>.</p>

<p>I've made the code for this example available <a href="https://github.com/tourdedave/better-rspec-rerun">here</a>. And if you're interested in a more targeted retry approach, check out <a href="http://elementalselenium.com/tips/10-retry-test-actions">this previous tip</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_57"></a>
<h2>57. How To Prepare Your Tests For Continuous Integration <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/57-junit-xml">http://elementalselenium.com/tips/57-junit-xml</a></h2>
<h3>BEGINNER REPORTING</h3>
<h4>#xml #junit_xml #ci #continuous_integration #reporting</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>If you want your Selenium tests to automatically run and report failures to you and your team, you'll want to wire them up to a <a href="http://en.wikipedia.org/wiki/Continuous_integration">Continuous Integration</a> (CI) server. In order to make the most of this setup, you'll need to make sure your test suite outputs a machine readable test report.</p>

<p>But what does this entail? How do you set it up? And will it work when running things in parallel?</p>

<h2>A Solution</h2>

<p>CI servers work with a standardized report format called JUnit XML, which is a standard offering across testing frameworks. If it's not something available off the shelf for your framework, odds are there's a plugin to enable it.</p>

<p>The report will include test results (e.g., failure messages and stack traces) and test metrics (e.g., start time, end time, number of tests, etc.). Your CI server (once configured to do so) will consume this report after each test run and tell you when things pass and fail. It will also offer trend data over time to help determine the stability of your test suite.</p>

<p>Let's step through an example of how to configure a test suite in order to output a JUnit XML report.</p>

<h2>An Example</h2>

<p>In <a href="http://rspec.info/">RSpec</a>, you need a plugin to configure JUnit XML output. There are two popular ones:</p>

<ul>
<li><a href="https://github.com/natritmeyer/yarjuf">yarjuf</a></li>
<li><a href="https://github.com/sj26/rspec_junit_formatter">rspec<em>junit</em>formatter</a></li>
</ul>

<p>Let's step through how to use the latter of the two.</p>

<p>After installing rspec<em>junit</em>formatter, we need to specify two new parameters at run-time: a formatter, and an output file.</p>
<div class="highlight"><pre>rspec --format RspecJunitFormatter  --out rspec.xml
</pre></div>

<p>Running tests with these parameters will format the test results into JUnit XML and pipe them into an <code>rspec.xml</code> file (and overwrite it on subsequent runs).</p>

<p>If we didn't want to type these parameters out every time, we could place them into an RSpec command helper file (<code>.rspec</code>).</p>
<div class="highlight"><pre><span class="c1"># filename: .rspec</span>

<span class="o">--</span><span class="nb">format</span> <span class="no">RspecJunitFormatter</span>
<span class="o">--</span><span class="n">out</span> <span class="n">rspec</span><span class="o">.</span><span class="n">xml</span>
</pre></div>

<p>Now if we want to run our tests in parallel (using something like <a href="https://github.com/grosser/parallel_tests">parallel_tests</a>), then we will want to generate a uniquely named file for each parallel process. For that we can use interpolation, thanks to <a href="http://www.stuartellis.eu/articles/erb/">ERB</a> and an environment variable made available by parallel_tests.</p>

<p>We can also use an RSpec helper file provided by parallel_tests (<code>.parallel_rspec</code>).</p>
<div class="highlight"><pre><span class="c1"># filename: .parallel_rspec</span>

<span class="o">--</span><span class="nb">format</span> <span class="no">RspecJunitFormatter</span>
<span class="o">--</span><span class="n">out</span> <span class="n">results</span><span class="o">/</span><span class="n">result</span><span class="o">&lt;%=</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'TEST_ENV_NUMBER'</span><span class="o">]</span> <span class="o">%&gt;.</span><span class="n">xml</span>
</pre></div>

<p>If we had numerous tests and ran the suite using <code>parallel_rspec</code>, then the final result would be a series of JUnit XML files (e.g., results1.xml, results2.xml, etc.) in a results folder.</p>

<p>And if we only wanted JUnit XML to be used when running on a CI server, then we can add a conditional to our .parallel_rspec file.</p>
<div class="highlight"><pre><span class="c1"># filename: .parallel_rspec</span>

<span class="o">&lt;</span><span class="sx">% if </span><span class="no">ENV</span><span class="o">[</span><span class="s1">'CI'</span><span class="o">]</span> <span class="sx">%&gt;</span>
<span class="sx">--format RspecJunitFormatter</span>
<span class="sx">--out results/result&lt;%= ENV['TEST_ENV_NUMBER'] %&gt;</span><span class="o">.</span><span class="n">xml</span>
<span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
</pre></div>

<p>Now all we need to do is specify a CI environment variable at run time in order to trigger JUnit XML output (e.g., <code>CI=on parallel_rspec</code>).</p>

<h2>Outro</h2>

<p>Stay tuned for future tips where I'll cover human-readable reporting (e.g., HTML reports with screenshots), as well as a CI server roundup.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_58"></a>
<h2>58. How To Slice and Dice Your Tests with Tags <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/58-tagging">http://elementalselenium.com/tips/58-tagging</a></h2>
<h3>BEGINNER TAGGING</h3>
<h4>#tagging #tags #annotations #test_packs</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>As your test suite grows you'll likely employ some kind of folder structure to help make sense of everything -- grouping like tests together. But what do you do when you want to run a set of tests that span across your organizational structure? Especially when your organizational structure isn't set in stone?</p>

<h2>A Solution</h2>

<p>By applying some metadata to your tests, you can specify a filter at runtime to execute a focused group of tests -- effectively creating a dynamic test suite that takes into account all of your tests, returning just the ones you want.</p>

<p>Here are some tagging ideas to help get you started:</p>

<ul>
<li><code>wip</code> (e.g., work in progress)</li>
<li><code>smoke</code> (e.g., smoke tests)</li>
<li><code>moneymakers</code> (e.g., the user paths that correlate to the bottom line of the business)</li>
<li><code>component name</code></li>
<li><code>story number</code> (e.g., traceability to your development stories)</li>
</ul>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>In RSpec, this metadata and filtered execution is referred to as <a href="https://www.relishapp.com/rspec/rspec-core/v/2-4/docs/command-line/tag-option">tags</a> (or tagging).</p>

<p>A tag is a simple key/value pair that can be specified within any test file. Alternatively, you can specify just a key (as a symbol) for the tag.</p>

<p>Here is an example spec file with a <code>:smoke</code> tag applied to the entire file.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/example_spec.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="n">describe</span> <span class="s1">'Login'</span><span class="p">,</span> <span class="ss">:smoke</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'succeeded'</span> <span class="k">do</span>
    <span class="c1"># test code goes here</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'failed'</span> <span class="k">do</span>
    <span class="c1"># test code goes here</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>To run this, you would specify <code>--tag</code> and the tag name (without the <code>:</code>) as a runtime parameter, like so:</p>
<div class="highlight"><pre>rspec --tag smoke
</pre></div>

<p>Alternatively, you can ignore tags with a <code>~</code> prepended to the tag name.</p>
<div class="highlight"><pre>rspec --tag ~smoke
</pre></div>

<p>You can also tag each individual test and specify multiple tags at run time.</p>
<div class="highlight"><pre><span class="c1"># filename: spec/example_spec.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="n">describe</span> <span class="s1">'Login'</span> <span class="k">do</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="k">end</span>

  <span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'succeeded'</span><span class="p">,</span> <span class="ss">:smoke</span> <span class="k">do</span>
    <span class="c1"># test code goes here</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'failed'</span><span class="p">,</span> <span class="ss">:wip</span> <span class="k">do</span>
    <span class="c1"># test code goes here</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>To run just the smoke tag and negate the wip tag, you would do the following:</p>
<div class="highlight"><pre>rspec --tag smoke --tag ~wip
</pre></div>

<h2>A note about tagging in RSpec</h2>

<p>If you're running RSpec 2 or earlier, the following config is required:</p>
<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'rspec'</span>
<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="p">{</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">c</span><span class="o">.</span><span class="n">treat_symbols_as_metadata_keys_with_true_values</span> <span class="o">=</span> <span class="kp">true</span> <span class="p">}</span>
</pre></div>

<p>Otherwise, you'll have to specify tags using the standard key/value syntax (e.g., <code>:smoke</code> would be <code>smoke: true</code>).</p>

<h2>Expected Behavior</h2>

<ul>
<li>Run the test suite</li>
<li>The test suite identifies which tests to run based on the tags provided</li>
<li>Executes the filtered set of tests, ignoring the rest</li>
</ul>

<h2>Outro</h2>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_59"></a>
<h2>59. How To Generate an HTML Test Report <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/59-html-reporting">http://elementalselenium.com/tips/59-html-reporting</a></h2>
<h3>INTERMEDIATE REPORTING</h3>
<h4>#reporting #html #html_reporting #screenshot</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In order to make your tests relevant, you need to be able to know when there's a failure and what caused it. You can easily <a href="http://elementalselenium.com/tips/16-take-screenshot-on-failure">take screenshots on failure</a> and <a href="http://elementalselenium.com/tips/57-junit-xml">prepare your tests for continuous integration</a>. But how do you weave these together into a human readable format that can help you and your team diagnose test failures quickly?</p>

<p>The general approach is to create an HTML report with test results and failure screenshots intertwined. But this is easier said than done since there is no proven standard -- leaving you to code your own approach based on the test framework you're using.</p>

<h2>A Solution</h2>

<p>By leveraging a language agnostic library like <a href="https://github.com/allure-framework/allure-core/wiki">Allure</a> you can easily generate a robust human readable HTML report from each of your test runs.</p>

<h2>A brief primer on Allure</h2>

<p>What is Allure? Their documentation page says it best.</p>

<blockquote>
<p>Allure Framework is a flexible, lightweight multi-language framework for writing self-documenting tests, with the ability to store attachments, such as screenshots, logs and so on.</p>
</blockquote>

<p>It has adaptors for testing frameworks across numerous programming languages. You can see a full list <a href="https://github.com/allure-framework/allure-core/wiki#gathering-information-about-tests">here</a>.</p>

<p>It works in two-steps; first gathering test results information (storing it in an XML file) and then using that information to generate the HTML report. You can see an example HTML report of theirs <a href="https://github.com/allure-examples">here</a> (select <strong>Log in as guest</strong> and click <code>Log in</code> when you see a login prompt).</p>

<p>Let's dig in with an example of how to put Allure to use.</p>

<h2>An Example</h2>

<p>For this example we'll be using RSpec and the <a href="http://github.com/allure-framework/allure-rspec">Allure RSpec adaptor</a>.</p>
<div class="highlight"><pre><span class="c1"># filename: reporting_spec.rb</span>

<span class="nb">require</span> <span class="s1">'rspec'</span>
<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'allure-rspec'</span>
<span class="nb">require</span> <span class="s1">'nokogiri'</span>
<span class="nb">require</span> <span class="s1">'uuid'</span>

<span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="o">.</span><span class="n">include</span> <span class="no">AllureRSpec</span><span class="o">::</span><span class="no">Adaptor</span>

  <span class="n">c</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
  <span class="k">end</span>

  <span class="n">c</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="k">unless</span> <span class="n">example</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">nil?</span>
      <span class="n">attach_file</span><span class="p">(</span><span class="s2">"screenshot"</span><span class="p">,</span>
        <span class="vi">@driver</span><span class="o">.</span><span class="n">save_screenshot</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">pwd</span><span class="p">,</span> <span class="s2">"results/</span><span class="si">#{</span><span class="no">UUID</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">generate</span><span class="si">}</span><span class="s2">.png"</span><span class="p">)))</span>
    <span class="k">end</span>

    <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="k">end</span>

<span class="k">end</span>

<span class="no">AllureRSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="n">c</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="s2">"results/allure"</span>
<span class="k">end</span>
</pre></div>

<p>After including our requisite libraries we configure RSpec and Allure.</p>

<p><code>nokogiri</code> is necessary for <code>allure-rspec</code> to run, and <code>uuid</code> is useful for creating uniquely named screenshot files. In our <code>RSpec.configure</code> block, we configure Selenium to start before each test and quit after each test. After each test, we are also checking to see if an exception raised (e.g., a test failed), if so, then we capture a screenshot with Selenium (wrapping this action with <code>attach_file</code>). <code>attach_file</code> is an Allure method which tells it where the screenshot lives so it includes it in the XML output (and ultimately the final HTML report).</p>

<p>In our <code>AllureRSpec.configure</code> block we are specifying a folder for the XML files that get generated. This is for ease of organization. There is a default path that Allure will use if one is not specified.</p>

<p>Now we can create our tests -- one to demonstrate a pass, and another for a failure.</p>
<div class="highlight"><pre><span class="n">describe</span> <span class="s2">"Reporting"</span> <span class="k">do</span>

  <span class="n">it</span> <span class="s1">'passes'</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://www.google.com'</span>
    <span class="n">expect</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'fails'</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://www.google.com'</span>
    <span class="n">expect</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>When we save this file and run it from the command line (e.g., <code>rspec reporting_spec.rb</code>) it will output screenshots and XML files to a <code>results</code> folder in the project root.</p>

<p>Armed with test results we are now ready to grab a copy of <a href="https://github.com/allure-framework/allure-cli">the Allure command-line report generator</a> and turn this output into an HTML report. After running the Allure command-line report generator from the root of our project we will see an <code>output</code> directory which with contain the final HTML report:</p>
<div class="highlight"><pre>java -jar /path/to/allure/jar/file ./results/allure
</pre></div>

<p>You can see an example of the final HTML report <a href="http://allure-reporting.herokuapp.com/index.html#/home">here</a>.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Tests run, capturing screenshots for each failure</li>
<li>Test results are recorded along with screenshot information into Allure XML files</li>
<li>Running the Allure Report Generator outputs an HTML report which contains test data and screenshots</li>
</ul>

<h2>Outro</h2>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_60"></a>
<h2>60. How To Generate A List Of Tags from Your Tests <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/60-list-tags">http://elementalselenium.com/tips/60-list-tags</a></h2>
<h3>ADVANCED TAGGING</h3>
<h4>#tagging #tags #annotations #test_packs</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In <a href="http://elementalselenium.com/tips/58-tagging">a previous tip</a> I covered how to slice and dice your tests with tags. It's a powerful tool for targeted test execution as well as a lightweight form of documentation. But what happens when you want to see a summary of the tags you're using across all of your tests?</p>

<p>Unfortunately, most solution don't offer this kind of functionality out of the box -- leaving you to manually rifle through your tests to get a sense of things.</p>

<h2>A Solution</h2>

<p>By leveraging the before and after hooks in our test framework, we can interrogate each test in one fell swoop to get the tags and generate a simple report.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>To do this in RSpec, we're going to leverage <code>RSpec.configure</code> in a file called <code>tag_lister.rb</code>. To keep things simple, let's wrap this behavior in a method called <code>list_tags</code> and have it live within a module called <code>TagLister</code>.</p>
<div class="highlight"><pre><span class="c1"># filename: tag_lister.rb</span>

<span class="nb">require</span> <span class="s1">'rspec'</span>

<span class="k">module</span> <span class="nn">TagLister</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">list_tags</span>
    <span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
      <span class="n">c</span><span class="o">.</span><span class="n">add_setting</span> <span class="ss">:tags</span>
      <span class="n">c</span><span class="o">.</span><span class="n">before</span><span class="p">(</span><span class="ss">:suite</span><span class="p">)</span> <span class="p">{</span> <span class="no">RSpec</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">}</span>
</pre></div>

<p>In our RSpec configuration we first need to create a place to store the tag data, so we add a setting called <code>tags</code> and make it a hash.</p>

<p>Now we're ready to step through each test to find the tag data.</p>
<div class="highlight"><pre><span class="c1"># filename: tag_lister.rb</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>
      <span class="n">c</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
        <span class="n">tag_recorder</span> <span class="o">=</span> <span class="no">RSpec</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">tags</span>
        <span class="n">standard_keys</span> <span class="o">=</span> <span class="o">[</span><span class="ss">:example_group</span><span class="p">,</span>
                         <span class="ss">:block</span><span class="p">,</span>
                         <span class="ss">:description_args</span><span class="p">,</span>
                         <span class="ss">:caller</span><span class="p">,</span>
                         <span class="ss">:execution_result</span><span class="p">,</span>
                         <span class="ss">:full_description</span><span class="p">,</span>
                         <span class="ss">:line_number</span><span class="p">,</span>
                         <span class="ss">:file_path</span><span class="p">,</span>
                         <span class="ss">:description</span><span class="p">,</span>
                         <span class="ss">:described_class</span><span class="p">,</span>
                         <span class="ss">:location</span><span class="o">]</span>
        <span class="n">example</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
          <span class="n">this_tag</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">key</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span> <span class="k">unless</span> <span class="n">standard_keys</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
          <span class="k">unless</span> <span class="n">this_tag</span><span class="o">.</span><span class="n">nil?</span>
            <span class="n">tag_recorder</span><span class="o">[</span><span class="n">this_tag</span><span class="o">]</span> <span class="o">=</span> <span class="o">[]</span> <span class="k">unless</span> <span class="n">tag_recorder</span><span class="o">[</span><span class="n">this_tag</span><span class="o">]</span>
            <span class="n">tag_recorder</span><span class="o">[</span><span class="n">this_tag</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="o">[</span>
              <span class="n">example</span><span class="o">.</span><span class="n">metadata</span><span class="o">[</span><span class="ss">:full_description</span><span class="o">]</span><span class="p">,</span>
              <span class="n">example</span><span class="o">.</span><span class="n">metadata</span><span class="o">[</span><span class="ss">:file_path</span><span class="o">]</span><span class="p">,</span>
              <span class="n">example</span><span class="o">.</span><span class="n">metadata</span><span class="o">[</span><span class="ss">:line_number</span><span class="o">]</span>
            <span class="o">]</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
</pre></div>

<p>In <code>around(:each)</code> we're able to interogate each test (a.k.a. <code>example</code>) to see if it contains any data in addition to the standard set of keys that we can expect from RSpec. If it does, then we assume that these additional keys are tags and store the test name, path to test file, and line number of the test file that uses this tag (or these tags).</p>

<p>We store this information in an array (and potentially an array of arrays) within our <code>tags</code> hash. Here's a sample data set to help wrap your head around it:</p>
<div class="highlight"><pre><span class="p">{</span><span class="s2">"wip:true"</span><span class="o">=&gt;[[</span><span class="s2">"One passes"</span><span class="p">,</span> <span class="s2">"./spec/one_spec.rb"</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">"One fails"</span><span class="p">,</span> <span class="s2">"./spec/one_spec.rb"</span><span class="p">,</span> <span class="mi">3</span><span class="o">]]</span><span class="p">,</span>
<span class="s2">"smoke:true"</span><span class="o">=&gt;[[</span><span class="s2">"Three passes"</span><span class="p">,</span> <span class="s2">"./spec/three_spec.rb"</span><span class="p">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">,</span> <span class="o">[</span><span class="s2">"Three fails"</span><span class="p">,</span> <span class="s2">"./spec/three_spec.rb"</span><span class="p">,</span> <span class="mi">3</span><span class="o">]]</span><span class="p">,</span>
<span class="s2">"story:BIZ-1234"</span><span class="o">=&gt;[[</span><span class="s2">"Two passes"</span><span class="p">,</span> <span class="s2">"./spec/two_spec.rb"</span><span class="p">,</span> <span class="mi">2</span><span class="o">]]</span><span class="p">,</span> <span class="s2">"story:BIZ-1235"</span><span class="o">=&gt;[[</span><span class="s2">"Two fails"</span><span class="p">,</span> <span class="s2">"./spec/two_spec.rb"</span><span class="p">,</span> <span class="mi">3</span><span class="o">]]</span><span class="p">}</span>
</pre></div>

<p>Now that we have all of the tags and the test data that shows where they are in use, we can generate a simple report with it.</p>
<div class="highlight"><pre><span class="c1"># filename: tag_lister.rb</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>
      <span class="n">c</span><span class="o">.</span><span class="n">after</span><span class="p">(</span><span class="ss">:suite</span><span class="p">)</span> <span class="k">do</span>
        <span class="n">tags</span> <span class="o">=</span> <span class="no">RSpec</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">tags</span>

        <span class="k">case</span> <span class="no">ENV</span><span class="o">[</span><span class="s1">'TAG_SORT_ORDER'</span><span class="o">]</span>
        <span class="k">when</span> <span class="s1">'alphabetical'</span>
          <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">tag</span><span class="o">|</span> <span class="n">tag</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="p">}</span>
        <span class="k">when</span> <span class="s1">'usage'</span>
          <span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span><span class="o">.</span><span class="n">sort_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">tag</span><span class="o">|</span> <span class="n">tag</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">count</span> <span class="p">}</span><span class="o">.</span><span class="n">reverse</span>
        <span class="k">end</span>

        <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span>
        <span class="nb">puts</span> <span class="s2">"***************"</span>
        <span class="nb">puts</span> <span class="s2">"* TAGS IN USE *"</span>
        <span class="nb">puts</span> <span class="s2">"***************"</span>
        <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>

        <span class="n">tags</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tag</span><span class="o">|</span>
          <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">tag</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="si">}</span><span class="s2"> (used </span><span class="si">#{</span><span class="n">tag</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">count</span><span class="si">}</span><span class="s2"> times)"</span>
          <span class="n">tag</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">test_data</span><span class="o">|</span>
            <span class="nb">puts</span> <span class="s2">"  </span><span class="si">#{</span><span class="n">test_data</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">#{</span><span class="n">test_data</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">test_data</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">"</span>
          <span class="k">end</span>
        <span class="k">end</span>

        <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="si">#{</span><span class="n">tags</span><span class="o">.</span><span class="n">count</span><span class="si">}</span><span class="s2"> tags in use: sorted in </span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">'TAG_SORT_ORDER'</span><span class="o">]</span><span class="si">}</span><span class="s2"> order"</span>

      <span class="k">end</span>
    <span class="k">end</span>
</pre></div>

<p>There are a couple of different ways we'll likely want to see the tag data. So we wire up the ability to sort alphabetically by tag name as well as by usage in descending order (e.g., the number of times a tag is used). In our current tagging data structure, <code>tag[0]</code> is the tag name (a.k.a. the hash key) and <code>tag[1]</code> is the array that contains an array (or multiple arrays) of test data.</p>

<p>After sorting the tags, we output a heading (e.g., <code>* TAGS IN USE*</code>), iterate through the collection of tag &amp; test data, and close things out with a summary statement (listing the total tag count and sorting method used).</p>

<p>Now we just need to pull in our test files, start RSpec, and then add a trigger to run everything.</p>
<div class="highlight"><pre><span class="c1"># filename: tag_lister.rb</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>
    <span class="n">tests</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Dir</span><span class="o">.</span><span class="n">getwd</span><span class="p">,</span> <span class="s1">'spec/**/*'</span><span class="p">))</span>
    <span class="no">RSpec</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">Runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tests</span><span class="p">)</span>

  <span class="k">end</span>
<span class="k">end</span>

<span class="no">ENV</span><span class="o">[</span><span class="s1">'TAG_SORT_ORDER'</span><span class="o">]</span> <span class="o">=</span> <span class="no">ARGV</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">||</span> <span class="s1">'usage'</span>
<span class="no">TagLister</span><span class="o">.</span><span class="n">list_tags</span>
</pre></div>

<p>This script is built to live one level up from the test directory. And it assumes that the test directory is called <code>spec</code>.</p>

<p>We make it so we can pass an argument at runtime, which then gets fed into the tag sorting environment variable (<code>ENV['TAG_SORT_ORDER']</code>). If no argument is provided, we default the value to <code>'usage'</code>.</p>

<p>When we save this and run it with <code>ruby tag_lister.rb</code>, we should see a report outputted in the terminal.</p>

<p>Here is an example:</p>
<div class="highlight"><pre>......

***************
* TAGS IN USE *
***************

wip:true <span class="o">(</span>used 2 <span class="nb">times</span><span class="o">)</span>
  One passes <span class="o">(</span>./spec/one_spec.rb:2<span class="o">)</span>
  One fails <span class="o">(</span>./spec/one_spec.rb:3<span class="o">)</span>
smoke:true <span class="o">(</span>used 2 <span class="nb">times</span><span class="o">)</span>
  Three passes <span class="o">(</span>./spec/three_spec.rb:2<span class="o">)</span>
  Three fails <span class="o">(</span>./spec/three_spec.rb:3<span class="o">)</span>
story:BIZ-1234 <span class="o">(</span>used 1 <span class="nb">times</span><span class="o">)</span>
  Two passes <span class="o">(</span>./spec/two_spec.rb:2<span class="o">)</span>
story:BIZ-1235 <span class="o">(</span>used 1 <span class="nb">times</span><span class="o">)</span>
  Two fails <span class="o">(</span>./spec/two_spec.rb:3<span class="o">)</span>

4 tags in use: sorted in usage order


Finished in 0.00106 seconds <span class="o">(</span>files took 0.09029 seconds to load<span class="o">)</span>
6 examples, 0 failures
</pre></div>

<h2>Expected Behavior</h2>

<ul>
<li>Iterate over each test, collecting tags and their test data</li>
<li>Display a report of tags in use (sorted based on run-time preference)</li>
</ul>

<h2>Outro</h2>

<p>If you'd like to see the code and example specs used to generate the above report, you can find them <a href="https://github.com/tourdedave/rspec-list-tags">here</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_61"></a>
<h2>61. How To Press Keyboard Keys <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/61-keyboard-keys">http://elementalselenium.com/tips/61-keyboard-keys</a></h2>
<h3>BEGINNER TESTING</h3>
<h4>#keyboard #keys #key_presses #tab #enter</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>On occasion you'll come across functionality that requires the use of keyboard key presses in your tests.</p>

<p>Perhaps you'll need to use the tab key to traverse from one portion of the page to another, back out of somekind of menu or overlay with the escape key, or even submit a form with Enter.</p>

<p>But how do you do it and where do you start?</p>

<h2>A Solution</h2>

<p>We can issue a keyboard key press by using the <a href="https://selenium.googlecode.com/git/docs/api/rb/Selenium/WebDriver/ActionBuilder.html#send_keys-instance_method"><code>send_keys</code> method in Selenium's Action Builder</a>. This will send the key press to the element that's currently in focus in the browser (so we don't have to specify a locator along with it).</p>

<p>When using this approach, we need to specify the keyboard key as a symbol (e.g. tab is <code>:tab</code>). You can see a full of keyboard key symbols <a href="http://selenium.googlecode.com/svn/trunk/docs/api/rb/Selenium/WebDriver/Keys.html">here</a>.</p>

<p>Let's step through an example.</p>

<h2>An Example</h2>

<p>First we'll set up our requisite libraries to drive the browser (e.g., <code>selenium-webdriver</code>) and perform an assertion (e.g., <code>rspec/expections</code> and <code>RSpec::Matchers</code>). After that, we'll create some <code>setup</code>, <code>teardown</code>, and <code>run</code> methods for simple test execution.</p>
<div class="highlight"><pre><span class="c1"># filename: key_presses.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now we can wire up our test.</p>

<p>Let's use an example from <a href="https://github.com/tourdedave/the-internet">the-internet</a> that will display what key was pressed. We can then use this display text to perform our assertion.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/key_presses'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="ss">:tab</span><span class="p">)</span><span class="o">.</span><span class="n">perform</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'result'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'You entered: TAB'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<p>If we save this and run it (e.g. <code>ruby key_presses.rb</code> from the command-line) here is what should occur.</p>

<ul>
<li>Load the page</li>
<li>Press a key</li>
<li>The site displays which key was pressed</li>
<li>Selenium reads the text displayed and checks to see if it is correct</li>
</ul>

<h2>Outro</h2>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_62"></a>
<h2>62. An Introduction To Web Consistency Testing <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/62-web-consistency-testing">http://elementalselenium.com/tips/62-web-consistency-testing</a></h2>
<h3>INTERMEDIATE STRATEGY</h3>
<h4>#web_consistency_testing #guest_post</h4>
<hr width="40%" align="left">
<p><strong>NOTE: This is a guest post from Kevin Menard. He's the maintainer of Selenium Grid, a co-founder of a Selenium-based automated visual testing platform (<a href="https://mogotest.com/">Mogotest</a>), and the father of Web Consistency Testing. You can find him at <a href="https://twitter.com/nirvdrum">@nirvdrum on Twitter</a> and on <a href="http://elementalselenium.com/tips/20-irc-chat">the Selenium IRC Chat channel</a> (as <code>nirvdrum</code>). But what is Web Consistency Testing exactly and why is it important? Enter Kevin.</strong></p>

<p>Most of our testing is verification testing, whether it be for the Web or for another problem domain. If I click a button to submit a form, does it POST the data to the server? Do I get back the correct HTTP status code? Does my database update with the correct values?</p>

<p>Unit, functional, and integration testing almost exclusively fall into the category of verification testing. While there is immense value there, it's a local maximum. And as with most local maxima, we as an industry have been stuck there for a while. We find better ways to test server interactions or a new language for integration testing. But, we haven't solved any new problems.</p>

<p>Verification testing helps ensure things work, within our specified constraints. Ostensibly those have been chosen to match how customers will interact with the site or application. But, it's not enough to just test data and its manipulation. Nowadays usability, design, and the overall user experience are what separate the winners from the losers. As customers and potential customers alike access web properties on a growing number of devices, while simultaneously demanding a higher quality Web, we need to expand our definition of testing to better match a user's expectations.</p>

<p>The first interaction most users will have with a site is visual <sup><a href="#footnote_1">1</a></sup>. However, many of us perform no visual testing of any sort. Others rely on an error-prone, expensive manual QA process. And a small number have attempted automated testing through image comparisons with varying levels of success. Why have we ignored testing what is arguably the most important part of the Web experience?</p>

<p>As I researched this topic, the most frequent answer I've heard is that how a page looks is related to style and we can't test style. While to a certain degree that's true, a web browser has a structured representation of a site called the DOM. The DOM contains a materialized view of any transformations performed by CSS or JavaScript and it's represented as a tree, which means traversing and comparing two DOMs is a fairly straightforward process.</p>

<p>Accepting that there's a technical solution to the problem, visual testing has still been prohibitively expensive for many. Maintaining a cluster of browsers in a lab meant a lot of software licenses and hardware had to be purchased, along with a salary to maintain those machines. Fortunately, cloud computing is changing that landscape. Not only can machines be acquired with necessary licenses for much cheaper, but by enabling Testing as a Service (TaaS) applications, the maintenance and computation costs can be distributed across many customers, further driving the price of such services down.</p>

<p>And finally, previous attempts at visual testing were mostly based upon image comparisons. These tests required pixel-perfect results and could only highlight a region that rendered incorrectly. While certainly better than nothing, analyzing those results and determining where the error lay was another laborious process, so many avoided it.</p>

<p>Web Consistency Testing is a new approach to automated visual testing of web sites &amp; applications. It places emphasis on the user, answering the simple question: does this page look right? Rather than get bogged down with pixel-perfect renders<sup><a href="#footnote_2">2</a></sup>, it adapts to the browser and device it's being tested in and tests for a consistent user experience in that configuration. By focusing on issues that actually affect users rather than minute differences detected by computers, we can reduce the cost of testing and free up designers &amp; developers to work on things that truly matter.</p>

<p>Web Consistency Testing is an automated visual comparison between two renderings of a site. Those renderings can span many dimensions, with the most obvious example being cross-browser. But the same process can be used to catch visual regressions, cross-locale problems, and differences in rendering due to bandwidth constraints over a time interval (e.g., to test slow mobile devices).</p>

<p>Any detected differences within a configurable tolerance threshold are reported back as CSS selectors for the elements in error, along with associated context about the error such as the element's position on the page, dimensions, opacity, and classification of error. Rather than provide a simple pass/fail mechanism, we want to provide scoped information that will allow a web developer to isolate the problem and fix it quickly.</p>

<p>Additionally, visual issues tend to have cascading effects.  E.g., if a DIV is off by 200px along the y-axis, it's almost certainly going to push all elements that follow it down by 200px. Reporting each of those other elements as a problem is a red herring, as fixing the root problem will likely fix all the cascading problems as well. With Web Consistency Testing, we normalize each error as it's detected so we can continue testing the rest of the page as if no problem occurred. This allows us to surface only root issues and eliminate false negatives.</p>

<p>And perhaps the best part about Web Consistency Testing is that it avoids a common problem with front-end tests in general: they become obsolete whenever a major structural change is made. Since the input to a Web Consistency Test is the "reference" copy of a site, the tests are always up-to-date and adapt along with the site. Even better - they don't require any test code authoring so anyone in an organization can set up a test. Just configure some URLs to test and indicate what the "reference" copy is and you're good to go. When testing is easier to perform, it's easier to adopt, and we can help foster a culture of testing in an organization.</p>

<p>Web Consistency Testing is still in its infancy. I've been studying and refining these approaches over the past 4 years and have put them into practice in an enterprise-grade implementation called <a href="https://mogotest.com/">Mogotest</a>. I really think the industry is in a testing rut and we have the opportunity to push forward in a better direction. I doubt Web Consistency Testing is going to be the end game, but so far the results have been phenomenal. By questioning the traditional forms of web testing I have been able to achieve things I never thought possible.</p>

<p>If you're interested in learning more, please check out <a href="http://webconsistencytesting.com/">http://webconsistencytesting.com/</a>.  I've been collecting materials over there and there's a discussion group where I try to answer questions. While I do have a commercial interest in this, my intention is to develop these ideas publicly and move the state of web testing forward as a community. I'm a long-time open source contributor and will gladly help anyone looking to build out their own toolchain.</p>

<p></p><div class="footnote" id="footnote_1" style="font-size: smaller;">1 My apologies for those with visual impairments - accessibility testing is also a very important and overlooked facet.</div><br>
<div class="footnote" id="footnote_2" style="font-size: smaller;">2 Although you could tune it for pixel-perfect if that's a requirement for your site or application.</div><br><p></p><br>
<hr>
<a name ="tips_63"></a>
<h2>63. How To Right Click <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/63-right-click">http://elementalselenium.com/tips/63-right-click</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#right-click #right_click #context_menu #action_builder #context_click</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Sometimes you'll run into an app that has functionality hidden behind a right-click menu (a.k.a. context menu). These menus tend to be system level menus that are untouchable by Selenium. So how do you test this functionality?</p>

<h2>A Solution</h2>

<p>By leveraging <a href="https://selenium.googlecode.com/git/docs/api/rb/Selenium/WebDriver/ActionBuilder.html">Selenium's Action Builder</a> we can issue a right-click command (a.k.a. <a href="https://selenium.googlecode.com/git/docs/api/rb/Selenium/WebDriver/ActionBuilder.html#context_click-instance_method"><code>context_click</code></a>).</p>

<p>We can then select an option from the menu with keyboard keys which we can accomplish by using <a href="https://selenium.googlecode.com/git/docs/api/rb/Selenium/WebDriver/ActionBuilder.html#send_keys-instance_method"><code>send_keys</code></a> with the correct keyboard key values (you can see a full list <a href="http://selenium.googlecode.com/svn/trunk/docs/api/rb/Selenium/WebDriver/Keys.html">here</a>).</p>

<p>And we can chain these actions together into one one command before triggering it.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>Let's start by pulling in the necessary libraries (<code>selenium-webdriver</code> to load &amp; drive the browser and <code>rspec-expectations</code> &amp; <code>RSpec::Matchers</code> to perform an assertion) and wiring up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: right_click.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec-expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now we're ready to write our test.</p>

<p>Let's use an example from <a href="https://github.com/tourdedave/the-internet">the-internet</a> that will render a custom context menu when we right-click on a specific area of the page. Clicking this custom menu option will trigger a JavaScript alert.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/context_menu'</span>
  <span class="n">menu_area</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span> <span class="nb">id</span><span class="p">:</span> <span class="s1">'hot-spot'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">action</span><span class="o">.</span><span class="n">context_click</span><span class="p">(</span><span class="n">menu_area</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="ss">:arrow_down</span><span class="p">)</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="ss">:enter</span><span class="p">)</span><span class="o">.</span><span class="n">perform</span>
  <span class="n">alert</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">switch_to</span><span class="o">.</span><span class="n">alert</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">alert</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="s1">'You selected a context menu'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<p>If we save this file and run it (e.g., <code>ruby right_click.rb</code>) from the command-line) here is what will happen:</p>

<ul>
<li>Load the page</li>
<li>Right-click on the area which will render a custom context menu</li>
<li>Select the custom context menu option with keyboard keys</li>
<li>A JavaScript alert appears</li>
<li>Grab the text of the JavaScript alert</li>
<li>Assert that the text from the alert is what we expect</li>
</ul>

<h2>Outro</h2>

<p>To learn more about context menus, you can read <a href="http://blog.teamtreehouse.com/building-html5-context-menus">this write-up from the Tree House blog</a>.</p>

<p>And for more thorough walkthroughs on keyboard keys and JavaScript alerts in Selenium, you can go <a href="http://elementalselenium.com/tips/61-keyboard-keys">here</a> and <a href="http://elementalselenium.com/tips/51-javascript-alerts">here</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_64"></a>
<h2>64. How To Simulate Slow Connections <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/64-limit-bandwidth">http://elementalselenium.com/tips/64-limit-bandwidth</a></h2>
<h3>ADVANCED TOOLS</h3>
<h4>#browsermob-proxy</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>With Selenium you have the luxury of cross browser testing. But what happens when you also need to test how your application behaves on a slow connection?</p>

<h2>A Solution</h2>

<p>With the help of a proxy server like <a href="http://bmp.lightbody.net/">Browsermob Proxy</a> we can simulate bandwidth limitations and run our tests to see if they fall down. In order to do this, we'll also need to adjust our test's timeouts.</p>

<h2>A Brief Primer on Browsermob Proxy</h2>

<p>Browsermob Proxy is a server which sits between your browser and the outside world. You connect to it by configuring a browser profile to use it.</p>

<p>As listed on <a href="https://github.com/lightbody/browsermob-proxy#features">the Browsermob GitHub page</a>, here are some of the benefits:</p>

<ul>
<li>blacklisting and whitelisting certain URL patterns</li>
<li>simulating various bandwidth and latency</li>
<li>remapping DNS lookups</li>
<li>flushing DNS caching</li>
<li>controlling DNS and request timeouts</li>
<li>automatic BASIC authorization</li>
</ul>

<p>You can also capture HTTP status codes with it as well. You can see a write-up on how to do that <a href="http://elementalselenium.com/tips/17-retrieve-http-status-codes">here</a>.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>We'll be using <a href="https://github.com/jarib/browsermob-proxy-rb"><code>browsermob-proxy-rb</code></a> as our Ruby interface to the proxy server (which we'll need to download from <a href="http://bmp.lightbody.net/">here</a>).</p>

<p>We'll also need to download the Selenium Standalone Server from <a href="http://selenium-release.storage.googleapis.com/index.html">here</a> and run it in the terminal (e.g., <code>java -jar selenium-server-standalone-2.42.2.jar</code>). This is necessary because we'll need to use Selenium Remote in order to increase the page load timeout. Under normal circumstances this wouldn't be necessary -- you can see <a href="https://code.google.com/p/selenium/issues/detail?id=7608">this open issue</a> for details.</p>

<p>Now that we have that sorted, we can wire-up our test script. First we'll want to pull in our requisite libraries.</p>
<div class="highlight"><pre><span class="c1"># filename: bandwidth_limit.rb</span>

<span class="nb">require</span> <span class="s1">'browsermob/proxy'</span>
<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>
</pre></div>

<p>Next, we'll want to configure the proxy server and bind it to a Selenium browser profile.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">configure_proxy</span>
  <span class="n">server</span> <span class="o">=</span> <span class="no">BrowserMob</span><span class="o">::</span><span class="no">Proxy</span><span class="o">::</span><span class="no">Server</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'./browsermob-proxy-2.0-beta-9/bin/browsermob-proxy'</span><span class="p">)</span>
  <span class="n">server</span><span class="o">.</span><span class="n">start</span>
  <span class="vi">@proxy</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">create_proxy</span>
  <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="n">profile</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="vi">@proxy</span><span class="o">.</span><span class="n">selenium_proxy</span>
  <span class="k">return</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Capabilities</span><span class="o">.</span><span class="n">firefox</span><span class="p">(</span><span class="n">firefox_profile</span><span class="p">:</span> <span class="n">profile</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>Now we can set the increased timeout, create an instance of Selenium, and specify our bandwidth limit.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">setup</span>
  <span class="n">client</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Http</span><span class="o">::</span><span class="no">Default</span><span class="o">.</span><span class="n">new</span>
  <span class="n">client</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">300</span> <span class="c1"># seconds</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:remote</span><span class="p">,</span> <span class="n">desired_capabilities</span><span class="p">:</span> <span class="n">configure_proxy</span><span class="p">,</span> <span class="n">http_client</span><span class="p">:</span> <span class="n">client</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">upstream_kbps</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="n">downstream_kbps</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>We set the timeout to 5 minutes and specified a upload limit of 20 KBPS and a download limit of 30 KBPS (which is similar to a slow hotel connection or dial-up).</p>

<p>Now we just need to wire up teardown and run actions.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">close</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>All that's left now is to write our test. A simple page load and copy assertion will suffice (to make sure the page actually loaded).</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">class</span><span class="p">:</span> <span class="s1">'heading'</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span><span class="p">(</span><span class="s1">'Welcome to the Internet'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<p>If we save this file and run it (e.g., <code>ruby bandwidth_limit.rb</code> from the command-line) here is what will happen:</p>

<ul>
<li>Start the proxy server and configure a connection to it</li>
<li>Set a high timeout for Selenium</li>
<li>Load an instance of Selenium</li>
<li>Configure a bandwidth limit in in the proxy connection</li>
<li>Load the page (slowly)</li>
<li>Grab the text from the page heading</li>
<li>Perform an assertion against the text to make sure it loaded</li>
</ul>

<h2>Outro</h2>

<p>It's not clear in <code>browsermob-proxy-rb</code> what options and functionality are available since the library is light on documenation. But the code is easy to read and has good comments. It's worth looking at <a href="https://github.com/jarib/browsermob-proxy-rb/blob/master/lib/browsermob/proxy/client.rb">the client class</a> to see what's available.</p>

<p>For instance, in addition to the upstream and downstream bandwidth limitation options, you can also specify latency. You can see that <a href="https://github.com/jarib/browsermob-proxy-rb/blob/master/lib/browsermob/proxy/client.rb#L174">here</a>.</p>

<p>Alternative to <code>browsermob-proxy-rb</code>, you can also set the bandwidth limits through the Browsermob Proxy Rest API (e.g., through a PUT request). You can find out more about that on <a href="https://github.com/lightbody/browsermob-proxy#rest-api">the Browsermob Proxy GitHub page</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_65"></a>
<h2>65. How To Visually Verify Your Locators <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/65-highlight-elements">http://elementalselenium.com/tips/65-highlight-elements</a></h2>
<h3>INTERMEDIATE TESTING</h3>
<h4>#guest_post #highlight #javascript #locators</h4>
<hr width="40%" align="left">
<p>This is a pseudo guest post from Brian Goad. I've adapted a blog post of his with permission. You can see the original <a href="http://swdandruby.wordpress.com/2013/07/19/did-i-select-the-right-element/">here</a>. Brian is a Test Engineer at <a href="http://www.digitalsmiths.com/">Digitalsmiths</a>. You can follow him on Twitter at <a href="https://twitter.com/bbbco">@bbbco</a> and check out his testing blog <a href="http://swdandruby.wordpress.com/">here</a>.</p>

<h2>The Problem</h2>

<p>It's likely that you'll run into odd test behavior that makes you question the locators you're using in a test. But how do you interrogate your locators to make sure they are doing what you expect?</p>

<h2>A Solution</h2>

<p>By leveraging some simple JavaScript and CSS styling, we can highlight the element on the page that we're targeting. This way we can visually inspect it to make sure it is the one that we want.</p>

<p>Let's take a look at an example.</p>

<h2>An Example</h2>

<p>For our initial setup let's pull in the <code>selenium-webdriver</code> gem and wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>
<div class="highlight"><pre><span class="c1"># filename: highlight.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now let's create a <code>highlight</code> helper method that will accept a Selenium WebDriver <code>element</code> and a time to wait (e.g., <code>duration</code>) as arguments.</p>

<p>By setting a duration, we can control how long to highlight an element on the page before reverting the styling back. And we can make this an optional argument by setting a default (e.g., 3 seconds).</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">highlight</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">duration</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

  <span class="c1"># store original style so it can be reset later</span>
  <span class="n">original_style</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s2">"style"</span><span class="p">)</span>

  <span class="c1"># style element with yellow border</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span>
    <span class="s2">"arguments[0].setAttribute(arguments[1], arguments[2])"</span><span class="p">,</span>
    <span class="n">element</span><span class="p">,</span>
    <span class="s2">"style"</span><span class="p">,</span>
    <span class="s2">"border: 2px solid red; border-style: dashed;"</span><span class="p">)</span>

  <span class="c1"># keep element highlighted for a spell and then revert</span>
  <span class="k">if</span> <span class="n">duration</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="nb">sleep</span> <span class="n">duration</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span>
      <span class="s2">"arguments[0].setAttribute(arguments[1], arguments[2])"</span><span class="p">,</span>
      <span class="n">element</span><span class="p">,</span>
      <span class="s2">"style"</span><span class="p">,</span>
      <span class="n">original_style</span><span class="p">)</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>There are three things going on here.</p>

<ol>
<li>We store the style of the element so we can revert it back when we're done</li>
<li>We change the style of the element so it visually stands out (e.g., a red dashed border)</li>
<li>We revert the style of the element back after 3 seconds</li>
</ol>

<p>We're accomplishing the style change through JavaScript's <code>setAttribute</code> function. And we're executing it with Selenium's <code>execute_script</code> command.</p>

<p>Now to use this in our test is simple, we just prepend a <code>find_element</code> action with the <code>highlight</code> command.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/large'</span>
  <span class="n">highlight</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="s1">'sibling-2.3'</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<p>If you were to save this file and run it (e.g., <code>ruby highlight.rb</code> from the command-line), here is what you would see.</p>

<ol>
<li>Load the page</li>
<li>Find the element</li>
<li>Change the styling of the element so it has a red dashed-line border</li>
<li>Wait 3 seconds</li>
<li>Revert the styling to remove the border</li>
</ol>

<h2>Outro</h2>

<p>If you wanted to take this a step further, you could leverage this approach along with an interactive debugger. You can read more about how to do that <a href="http://elementalselenium.com/tips/14-interactive-prompts-revisited">here in Brian's other guest post</a>.</p>

<p>Alternatively, you could verify your locators by using a browser plugin like FireFinder. You can read more about how to do that <a href="http://elementalselenium.com/tips/verifying-locators">here in this previous tip</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_66"></a>
<h2>66. How To Remove Third Party Resources <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/66-blacklist">http://elementalselenium.com/tips/66-blacklist</a></h2>
<h3>ADVANCED TOOLS</h3>
<h4>#browsermob-proxy #proxy</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>There are plenty of external resources that get loaded onto a page that aren't directly relevant to the functionality you're testing (e.g., Facebook widgets, Analytics, JavaScript snippets, etc.). And these externals resources have the potential to negatively impact your test runs due to slow load times.</p>

<p>So how do you protect your tests from these things that seem outside of your control?</p>

<h2>A Solution</h2>

<p>By leveraging a proxy server in our tests, we can block the external resources we don't want to load by adding them to a blacklist.</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p><strong>NOTE: For a brief primer on proxy servers (specifically Browsermob Proxy), check out <a href="http://elementalselenium.com/tips/64-limit-bandwidth">this tip</a>.</strong></p>

<p>To get started we'll need to pull in our requisite libraries (e.g., <code>browsermob/proxy</code> to control the proxy server, <code>selenium-webdriver</code> to drive the browser, and <code>rspec/expectations</code> to perform assertions). After that, we'll configure the proxy server and wire up some simple <code>setup</code>, <code>teardown</code>, and <code>run</code> methods.</p>

<p>As part of <code>setup</code> we'll want to configure the blacklist. To do that we'll just need a regular expression to find the resource, and the status code we'd like the resource to be changed to (e.g., we'll be changing a resource that normally loads as a <code>200</code> to a <code>404</code>).</p>
<div class="highlight"><pre><span class="c1"># filename: blacklist.rb</span>

<span class="nb">require</span> <span class="s1">'browsermob/proxy'</span>
<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">configure_proxy</span>
  <span class="n">server</span> <span class="o">=</span> <span class="no">BrowserMob</span><span class="o">::</span><span class="no">Proxy</span><span class="o">::</span><span class="no">Server</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'./browsermob-proxy-2.0-beta-9/bin/browsermob-proxy'</span><span class="p">)</span>
  <span class="n">server</span><span class="o">.</span><span class="n">start</span>
  <span class="vi">@proxy</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">create_proxy</span>
  <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="n">profile</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="vi">@proxy</span><span class="o">.</span><span class="n">selenium_proxy</span>
  <span class="k">return</span> <span class="n">profile</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">configure_proxy</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">blacklist</span><span class="p">(</span><span class="s1">'http:\/\/the-internet.herokuapp.com\/slow_external'</span><span class="p">,</span> <span class="mi">404</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">close</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now we're ready to wire up our test. Let's use an example from <a href="https://github.com/tourdedave/the-internet">the-internet</a> that has a slow loading resource (e.g., it has a rogue GET request that takes 30 seconds to load).</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">new_har</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/slow'</span>
  <span class="n">entry</span> <span class="o">=</span> <span class="vi">@proxy</span><span class="o">.</span><span class="n">har</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">find</span> <span class="p">{</span> <span class="o">|</span><span class="n">e</span><span class="o">|</span> <span class="n">e</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">include?</span> <span class="s1">'slow_external'</span> <span class="p">}</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span><span class="o">.</span><span class="n">not_to</span> <span class="n">be_nil</span>
  <span class="n">expect</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>

<p>We start the test by creating a new HTTP Archive (HAR) for tracking. We then load the example page, find the entry for the slow loading resource from the HAR, and perform our assertions against it.</p>

<h2>Expected Behavior</h2>

<p>Now if we save this file and run it (e.g., <code>ruby blacklist.rb</code> from the command-line), here is what will happen:</p>

<ul>
<li>Load the page</li>
<li>Find the entry we want from the HTTP Archive</li>
<li>Check that the entry exists</li>
<li>Check that the HTTP status code for the entry is what we set it to be</li>
</ul>

<h2>Outro</h2>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_67"></a>
<h2>67. How To Test For Broken Images <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/67-broken-images">http://elementalselenium.com/tips/67-broken-images</a></h2>
<h3>ADVANCED TESTING</h3>
<h4>#broken_image #broken_images #proxy #browsermob-proxy #http_library #javascript</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Selenium is built to mimic human actions (e.g., clicking, typing, dragging, dropping, etc.). So how do you use it to test for broken images?</p>

<h2>A Solution</h2>

<p>Out of the box, Selenium is not equipped to handle this. But regardless, there are several ways to accomplish this.</p>

<p>We can use a proxy server or an HTTP library to check status codes of the images. If they don't load correctly, then they'll register with a non <code>200</code> status code (likely a <code>404</code>). Alternatively, we can use JavaScript.</p>

<p>Lets look at an example of each.</p>

<h2>A Proxy Example</h2>

<p>In this example, we'll use Browsermob Proxy. For a primer on what this is and how to use it, check out <a href="http://elementalselenium.com/tips/64-limit-bandwidth">this tip</a>.</p>
<div class="highlight"><pre><span class="c1"># filename: broken_image_1.rb</span>

<span class="nb">require</span> <span class="s1">'browsermob/proxy'</span>
<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">configure_proxy</span>
  <span class="n">server</span> <span class="o">=</span> <span class="no">BrowserMob</span><span class="o">::</span><span class="no">Proxy</span><span class="o">::</span><span class="no">Server</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'./browsermob-proxy-2.0-beta-9/bin/browsermob-proxy'</span><span class="p">)</span>
  <span class="n">server</span><span class="o">.</span><span class="n">start</span>
  <span class="vi">@proxy</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">create_proxy</span>
  <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="n">profile</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="vi">@proxy</span><span class="o">.</span><span class="n">selenium_proxy</span>
  <span class="k">return</span> <span class="n">profile</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">configure_proxy</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">close</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">new_har</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/broken_images'</span>

  <span class="n">all_images</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">tag_name</span><span class="p">:</span> <span class="s1">'img'</span><span class="p">)</span>

  <span class="n">broken_images</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">all_images</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">img</span><span class="o">|</span>
    <span class="n">broken_images</span> <span class="o">&lt;&lt;</span> <span class="vi">@proxy</span><span class="o">.</span><span class="n">har</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">find</span> <span class="k">do</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span>
      <span class="n">entry</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="n">img</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'src'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">entry</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">404</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">expect</span><span class="p">(</span><span class="n">broken_images</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_empty</span>
<span class="k">end</span>
</pre></div>

<p>After configuring the proxy server and setting up Selenium, here are the steps that are taken in our test:</p>

<ol>
<li>Find all images on the page</li>
<li>Iterate through each image, finding a match for the <code>src</code> attribute with a <code>404</code> status code</li>
<li>Store the broken images in a collection</li>
<li>Assert that the broken images collection is empty</li>
</ol>

<h2>An HTTP Library Example</h2>

<p>For this example, we'll use a simple HTTP library called <a href="https://github.com/rest-client/rest-client"><code>rest-client</code></a>.</p>
<div class="highlight"><pre><span class="c1"># filename: broken_image_2.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="nb">require</span> <span class="s1">'rest-client'</span>

  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/broken_images'</span>

  <span class="n">all_images</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span><span class="p">(</span><span class="n">tag_name</span><span class="p">:</span> <span class="s1">'img'</span><span class="p">)</span>

  <span class="n">all_images</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">img</span><span class="o">|</span>
    <span class="no">RestClient</span><span class="o">.</span><span class="n">get</span> <span class="n">img</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">'src'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">result</span><span class="o">|</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">code</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">200</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>

<p>By using an HTTP library we get the same outcome as we saw with a proxy server. There are additional requests being made as a result, but it's much faster and has far less overhead.</p>

<p>Here are the steps taken in the test:</p>

<ol>
<li>Find all images on the page</li>
<li>Iterate through each image, grabbing the <code>src</code> attribute and performing an HTTP GET</li>
<li>Assert the status code of the image is <code>200</code></li>
</ol>

<h2>A JavaScript Example</h2>
<div class="highlight"><pre><span class="c1"># filename: broken_image_2.rb</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/broken_images'</span>

  <span class="n">all_images</span> <span class="o">=</span> <span class="vi">@driver</span><span class="o">.</span><span class="n">find_elements</span> <span class="n">tag_name</span><span class="p">:</span> <span class="s1">'img'</span>

  <span class="n">broken_images</span> <span class="o">=</span> <span class="n">all_images</span><span class="o">.</span><span class="n">reject</span> <span class="k">do</span> <span class="o">|</span><span class="n">image</span><span class="o">|</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span>
      <span class="s2">"return arguments[0].complete &amp;&amp; \</span>
<span class="s2">        typeof arguments[0].naturalWidth != </span><span class="se">\"</span><span class="s2">undefined</span><span class="se">\"</span><span class="s2"> &amp;&amp; \</span>
<span class="s2">        arguments[0].naturalWidth &gt; 0"</span><span class="p">,</span>
      <span class="n">image</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">expect</span><span class="p">(</span><span class="n">broken_images</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">be_empty</span>
<span class="k">end</span>
</pre></div>

<p>This is the leanest approach since it requires no additional setup or extra requests. It's just a matter of using an <code>execute_script</code> command and specifying some JavaScript.</p>

<p>Here are the steps taken in the test:</p>

<ol>
<li>Find all images on the page</li>
<li>Iterate through each image, reject the ones that are valid</li>
<li>Return a collection of broken images</li>
<li>Assert that the broken images collection is empty</li>
</ol>

<h2>Outro</h2>

<p>Your circumstance may vary, so choose the approach that works best for you.</p>

<p>A big thanks to Brian Goad for the JavaScript solution and pointing me towards <a href="http://stackoverflow.com/questions/16784534/find-broken-images-in-page-image-replace-by-another-image/">the StackOverflow post where he first came across this</a>.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_68"></a>
<h2>68. How To Do Load Testing with J Meter and Selenium <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/68-load-testing-revisited">http://elementalselenium.com/tips/68-load-testing-revisited</a></h2>
<h3>ADVANCED TESTING</h3>
<h4>#jmeter #load_testing</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>In <a href="http://elementalselenium.com/tips/48-load-testing">a previous tip</a> I demonstrated a way to accomplish a simple load test with a Selenium script and an HTTP library. While it works, it's only useful for rudimentary test cases.</p>

<p>For more involved test cases and more powerful load generation, we're going to need something stronger.</p>

<h2>A Solution</h2>

<p>JMeter is the defacto open source load testing solution that is used in industry. The hardest part of using it is authoring the test cases (e.g., in the JMeter GUI). Thankfully we can sidestep that by repurposing our Selenium tests into initial JMeter scripts. To do this we'll need a proxy server, the HTTP Archive (HAR) each test generates, and a HAR to JMeter XML (JMX) converter.</p>

<p>When we're done, we'll have working JMeter test cases that we can modify and run (either from the GUI or the command-line).</p>

<p>Let's dig in with an example.</p>

<h2>An Example</h2>

<p>We'll first need to <code>require</code> our requisite libraries (e.g., <code>selenium-webdriver</code> for Selenium, <code>browsermob/proxy</code> for our proxy, and <code>convert</code> to convert -- a local file to convert the HAR to JMX).</p>

<p>Then we'll need to launch the proxy (e.g., <code>configure_proxy</code>), connect it to a browser profile (e.g., <code>browser_profile</code>), and tell Selenium to use this as it launches the browser (e.g., <code>setup</code>).</p>
<div class="highlight"><pre><span class="c1"># filename: har.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'browsermob/proxy'</span>
<span class="n">require_relative</span> <span class="s1">'convert'</span>

<span class="k">def</span> <span class="nf">configure_proxy</span>
  <span class="n">proxy_binary</span> <span class="o">=</span> <span class="no">BrowserMob</span><span class="o">::</span><span class="no">Proxy</span><span class="o">::</span><span class="no">Server</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">'./browsermob-proxy-2.0-beta-9/bin/browsermob-proxy'</span><span class="p">)</span>
  <span class="n">proxy_binary</span><span class="o">.</span><span class="n">start</span>
  <span class="n">proxy_binary</span><span class="o">.</span><span class="n">create_proxy</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">browser_profile</span>
  <span class="n">profile</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Firefox</span><span class="o">::</span><span class="no">Profile</span><span class="o">.</span><span class="n">new</span>
  <span class="n">profile</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="vi">@proxy</span><span class="o">.</span><span class="n">selenium_proxy</span>
  <span class="n">profile</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@proxy</span> <span class="o">=</span> <span class="n">configure_proxy</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:firefox</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">browser_profile</span>
<span class="k">end</span>
</pre></div>

<p>Now we need to make sure each test run closes the proxy and cleans up the browser (e.g., <code>teardown</code>). We'll also want to add a helper method to capture the traffic and wire everything up with a central <code>run</code> method.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">close</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">capture_traffic</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">new_har</span>
  <span class="k">yield</span>
  <span class="vi">@proxy</span><span class="o">.</span><span class="n">har</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="vi">@har</span> <span class="o">=</span> <span class="n">capture_traffic</span> <span class="p">{</span> <span class="k">yield</span> <span class="p">}</span>
  <span class="n">teardown</span>
<span class="k">end</span>
</pre></div>

<p>Now it's a simple matter of specifying the Selenium actions and outputting the HAR to a file.</p>
<div class="highlight"><pre><span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com/dynamic_loading/2'</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#start button'</span><span class="p">)</span><span class="o">.</span><span class="n">click</span>
  <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">::</span><span class="no">Wait</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">timeout</span><span class="p">:</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">until</span> <span class="k">do</span>
    <span class="vi">@driver</span><span class="o">.</span><span class="n">find_element</span><span class="p">(</span><span class="n">css</span><span class="p">:</span> <span class="s1">'#finish'</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="vi">@har</span><span class="o">.</span><span class="n">save_to</span> <span class="s1">'./selenium.har'</span>
</pre></div>

<p>If we save this and run it (e.g., <code>ruby har.rb</code> from the command-line) it will launch the browser, run the Selenium commands, and create a new file called <code>selenium.har</code> (or overwrite it if there's one there already).</p>

<p>Now we're ready to convert the HAR file to JMeter XML. To do that, we can use <a href="https://github.com/flood-io/ruby-jmeter/blob/master/examples/basic_har.rb">the basic HAR converter</a> that is available in the examples of <a href="https://github.com/flood-io/ruby-jmeter">the <code>ruby-jmeter</code> gem</a> (thanks to the fine folks at <a href="https://flood.io/">flood.io</a>).</p>

<p>With a few modifications, it's ready for our needs.</p>
<div class="highlight"><pre><span class="c1"># filename: convert.rb</span>

<span class="nb">require</span> <span class="s1">'ruby-jmeter'</span>
<span class="nb">require</span> <span class="s1">'recursive-open-struct'</span>
<span class="nb">require</span> <span class="s1">'json'</span>
<span class="nb">require</span> <span class="s1">'pry-debugger'</span>

<span class="k">module</span> <span class="nn">HARtoJMX</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">convert</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">har</span> <span class="o">=</span> <span class="no">RecursiveOpenStruct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">),</span> <span class="n">recurse_over_arrays</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>

    <span class="nb">test</span> <span class="k">do</span>
      <span class="n">cache</span>

      <span class="n">cookies</span>

      <span class="n">header</span> <span class="o">[</span> 
        <span class="p">{</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">'Accept-Encoding'</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s1">'gzip,deflate,sdch'</span> <span class="p">},</span>
        <span class="p">{</span> <span class="nb">name</span><span class="p">:</span> <span class="s1">'Accept'</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="s1">'text/javascript, text/html, application/xml, text/xml, */*'</span> <span class="p">}</span>
      <span class="o">]</span>

      <span class="n">threads</span> <span class="n">count</span><span class="p">:</span> <span class="mi">1</span> <span class="k">do</span>

        <span class="n">har</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">collect</span> <span class="p">{</span><span class="o">|</span><span class="n">entry</span><span class="o">|</span> <span class="n">entry</span><span class="o">.</span><span class="n">pageref</span> <span class="p">}</span><span class="o">.</span><span class="n">uniq</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">page</span><span class="o">|</span>

          <span class="n">transaction</span> <span class="nb">name</span><span class="p">:</span> <span class="n">page</span> <span class="k">do</span>
            <span class="n">har</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span><span class="o">|</span><span class="n">request</span><span class="o">|</span> <span class="n">request</span><span class="o">.</span><span class="n">pageref</span> <span class="o">==</span> <span class="n">page</span> <span class="p">}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span>
              <span class="k">next</span> <span class="k">unless</span> <span class="n">entry</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="o">=~</span> <span class="sr">/http/</span>
              <span class="n">params</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">postData</span> <span class="o">&amp;&amp;</span> <span class="n">entry</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">postData</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">collect</span> <span class="p">{</span><span class="o">|</span><span class="n">param</span><span class="o">|</span> <span class="o">[</span><span class="n">param</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">param</span><span class="o">.</span><span class="n">value</span><span class="o">]</span> <span class="p">}</span><span class="o">.</span><span class="n">flatten</span>
              <span class="nb">self</span><span class="o">.</span><span class="n">send</span> <span class="n">entry</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">to_h</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">downcase</span><span class="p">,</span> <span class="n">entry</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="n">fill_in</span><span class="p">:</span> <span class="no">Hash</span><span class="o">[*</span><span class="n">params</span><span class="o">]</span> <span class="k">do</span>
                <span class="n">with_xhr</span> <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">to_s</span> <span class="o">=~</span> <span class="sr">/XMLHttpRequest/</span>
              <span class="k">end</span>
            <span class="k">end</span>
          <span class="k">end</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span><span class="o">.</span><span class="n">jmx</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>

<p>Now let's put it to use in our Selenium script.</p>
<div class="highlight"><pre><span class="c1"># filename: har.rb</span>

<span class="o">.</span><span class="n">.</span><span class="o">.</span>

<span class="no">HARtoJMX</span><span class="o">.</span><span class="n">convert</span> <span class="s1">'selenium.har'</span>
<span class="c1"># the default filename output is `jmeter.jmx`</span>
</pre></div>

<p>Assuming you've <a href="http://jmeter.apache.org/download_jmeter.cgi">downloaded a copy of JMeter</a> you're ready to run your load test.</p>

<p>To execute it from the command-line you'll need to specify the path to the JMeter binary executable, a couple of arguments, and the path to the JMX file.</p>
<div class="highlight"><pre>./apache-jmeter-2.11/bin/jmeter -n -t ./jmeter.jmx
</pre></div>

<p><code>-n</code> tells JMeter ot run in non-GUI mode, and <code>-t</code> is used to specify the path to the JMX file.</p>

<h2>Expected Behavior</h2>

<ul>
<li>Selenium runs the test in Firefox while connected to the proxy server</li>
<li>The HTTP Archive (HAR) is exported to a file on disk</li>
<li>The HAR file is converted to a JMeter XML (JMX) file</li>
<li>JMeter is launched from the command-line and runs using the new JMX file</li>
</ul>

<h2>Outro</h2>

<p>Alternatively, you could open up the JMeter GUI, load the JMX file, and add on to it/reconfigure it/etc. This is a <em>much</em> better place to start from since it saves you loads of up front busy work creating the load test from scratch.</p>

<p>From here, it would be pretty trivial to add in a data set (e.g., <a href="https://wiki.apache.org/jmeter/JMeterFAQ#How_do_I_parameterize_my_JMeter_test_cases.3F">parameterize the test case</a>), increase the number of concurrent users, and change all kinds of simulated user behavior.</p>

<p>If you go this route, be sure to take a look at the JMeter Wiki. It's got loads of good information.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_69"></a>
<h2>69. How To Use Safari <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/69-safari">http://elementalselenium.com/tips/69-safari</a></h2>
<h3>BEGINNER SETUP</h3>
<h4>#safari #drivers #safaridriver #different_browsers</h4>
<hr width="40%" align="left">
<h2>The Problem</h2>

<p>Running your Selenium tests on a different browser locally or on a Grid tends to require additional setup.</p>

<p>It's usually a simple matter of looking at the documentation for the browser driver and following the steps outlined. But when it comes to <a href="https://code.google.com/p/selenium/wiki/SafariDriver">SafariDriver</a>, things aren't quite that simple.</p>

<p>If you're running a newer version of Safari and trying to run your Selenium tests with it, you'll see an error stating <code>Unable to establish a connection with the SafariDriver extension</code>.</p>

<p><img src="/img/safari-error.png"></p>

<h2>A Solution</h2>

<p>By manually installing the Safari Driver we will be able to work around this issue. Thankfully each version of Selenium has a prebuilt version of it.</p>

<h2>An Example</h2>

<p>The prebuilt SafariDriver extension can be found in the Selenium source code on GitHub <a href="https://github.com/SeleniumHQ/selenium/raw/master/javascript/safari-driver/prebuilt/SafariDriver.safariextz">here</a>. Download it and double-click it to install. After that, you will need to enable it.</p>

<p>To do that:</p>

<ol>
<li>open <code>Safari</code></li>
<li>go to <code>Preferences</code></li>
<li>click on the <code>Extensions</code> tab</li>
<li>Make sure <code>Enable WebDriver</code> for <code>WebDriver 2.38.0</code> is checked</li>
<li>Close <code>Safari</code></li>
</ol>

<p><img src="/img/safari-extension.png"></p>

<p>Now if we open up the Ruby terminal (e.g., <code>irb</code>) and launch a Selenium instance, here's what we'd see.</p>
<div class="highlight"><pre>&gt; irb
irb<span class="o">(</span>main<span class="o">)</span>:001:0&gt; require <span class="s1">'selenium-webdriver'</span>
irb<span class="o">(</span>main<span class="o">)</span>:002:0&gt; <span class="nv">driver</span> <span class="o">=</span> Selenium::WebDriver.for :safari
</pre></div>

<p><img src="/img/safari-success.png"></p>

<p>A successful communication between Safari and the Selenium Driver extension has occurred.</p>

<p>Now if we wire up a simple test, we can see that everything works as we expect.</p>
<div class="highlight"><pre><span class="c1"># filename: safari.rb</span>

<span class="nb">require</span> <span class="s1">'selenium-webdriver'</span>
<span class="nb">require</span> <span class="s1">'rspec/expectations'</span>
<span class="kp">include</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">Matchers</span>

<span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">WebDriver</span><span class="o">.</span><span class="n">for</span> <span class="ss">:safari</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">teardown</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">quit</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">run</span>
  <span class="n">setup</span>
  <span class="k">yield</span>
  <span class="n">teardown</span>
<span class="k">end</span>

<span class="n">run</span> <span class="k">do</span>
  <span class="vi">@driver</span><span class="o">.</span><span class="n">get</span> <span class="s1">'http://the-internet.herokuapp.com'</span>
  <span class="n">expect</span><span class="p">(</span><span class="vi">@driver</span><span class="o">.</span><span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eql</span> <span class="s1">'The Internet'</span>
<span class="k">end</span>
</pre></div>

<h2>Expected Behavior</h2>

<p>If you save the file and run it (e.g., <code>ruby safari.rb</code> from the command-line), here is what you will see.</p>

<ul>
<li>Safari opens</li>
<li>The home page of <a href="http://github.com/tourdedave/the-internet">the-internet</a> loads</li>
<li>The title of the page is checked to make sure it's what we expect</li>
<li>Safari closes</li>
<li>The test passes without issue</li>
</ul>

<h2>Outro</h2>

<p>Keep in mind that Safari can load without you realizing it (since it doesn't obtain focus when launching with Selenium). When that happens you'll just need to switch to Safari in order to see what the test is doing.</p>

<p>If you're running into this issue on a remote node or Grid, you will need to install and enable the extension on each of the nodes with Safari in order to resolve the error.</p>

<p>Happy Testing!</p><br>
<hr>
<a name ="tips_70"></a>
<h2>70. How To Use Selenium Grid Reliably <a href="#top">top</a>
 <a href="http://elementalselenium.com/tips/70-grid-extras">http://elementalselenium.com/tips/70-grid-extras</a></h2>
<h3>INTERMEDIATE INFRASTRUCTURE</h3>
<h4>#grid #grid_extras #selenium_grid</h4>
<hr width="40%" align="left">
<p><strong>NOTE: This is a guest post from Dima Kovalenko. He's a core committer to the Selenium project and <a href="https://github.com/groupon/Selenium-Grid-Extras">Selenium-Grid-Extras</a>. You can find him at <a href="https://twitter.com/dimacus">@dimacus on Twitter</a> or on <a href="http://elementalselenium.com/tips/20-irc-chat">the Selenium IRC chat channel</a> as <code>dimacus</code>. You can also check out <a href="http://agilesoftwaretesting.com/">his testing blog</a> or <a href="http://www.amazon.com/Selenium-Design-Patterns-Best-Practices-ebook/dp/B00NVDAWXI/">his Selenium book</a>.</strong></p>

<h2>The Problem</h2>

<p>When I first encountered Selenium Grid, I was extremely happy and impressed by the possibilities. The idea of testing multiple browsers and computers at the same time is great! By using the Grid, we were able to collect all of the obsolete computers that were collecting dust in IT closets and make them do some work. </p>

<p>Shortly after setting up the first Grid at work, we started to see some odd behaviors. Windows computers would start running extremely slow, doubling and tripling the execution time.</p>

<p>From time to time Internet Explorer would crash and not close properly, which would lead to all subsequent Internet Explorer to not close after the test is complete; after 20 or 30 test runs, the computer would have dozens of Internet Explorer instances open. This lead to an all familiar crashing sight:</p>

<p><img src="https://dl.dropboxusercontent.com/u/529524/Elemental%20Selenium/Grid%20Extras/crash.png" alt="an all familiar Windows crashing sight"></p>

<p>At this point the computer would become unresponsive, and all subsequent tests running on the node would crash with strange errors. Dozens of similar errors occurred during the execution of a test suite on Windows, Linux and OSX nodes. After a while I had to give up and run our tests without the Grid.</p>

<h2>A Solution</h2>

<p>A couple of years after that Selenium Grid 2.0 came out. It had many of the previous issues fixed. However, the fixes only applied to stabilizing <em>the web browser</em>, some of the OS level problems still persisted. But the advantages of Grid 2.0 outweighed the short falls, so we decided to invest some time in setting up the Grid once more.</p>

<p>This time around I decided to supplement the Selenium Grid with some helper scripts, giving birth to <a href="https://github.com/groupon/Selenium-Grid-Extras">the Selenium Grid Extras project</a>.</p>

<h2>A Selenium Grid Extras Primer</h2>

<p>The idea behind the project was to fix some of the issues that come up outside of the web browser. By cleaning up the node before and after each test at the Operating System level has improved the stability of our test dramatically.</p>

<p>Lets take a look at some of the clean up tasks that Selenium Grid Extras performs to give stability to the Grid Node:</p>

<h3>Explicitly kill web browser after each test</h3>

<p>After a test run is complete, Selenium Grid Extras tries to kill any remaining or crashed instances of the browser used. Unlike the kill command that comes from within WebDriver, this kill command is OS level one, which is taskkill firefox and kill -9 firefox equivalent.  This guarantees that the node is still in a good working condition before each test starts.</p>

<h3>Modify settings for Internet Explorer</h3>

<p>There are multiple settings that need to be tweaked to allow IE tests to run properly. These include setting the Protected Mode and Mixed Content Modes on and off. When Selenium Grid Extras is launched, it modifies all of these settings for a hassle free test execution.</p>

<h3>Periodically restart Grid Nodes</h3>

<p>No matter how well an application is written, it will have some memory leaks and issues. We found that restarting the Java process from time to time is the fastest and most reliable to clear the air. When the Grid Node is not in use, Selenium Grid Extras restarts the Java process to clear up the JVM of any remaining memory leaks that can cause instability.</p>

<h3>Restart the OS after several test runs</h3>

<p>To add one more level of clean up, we restart the whole Operating System after certain amount of test runs. This helps to clear up any remaining items that might have crashed in the Operating System. Restarting the whole machine every 10 to 20 test runs is a huge boost in stability.</p>

<h2>Put Into Practice</h2>

<p>Because of these clean up measures, we were able to run close to <strong>180,000 test sessions</strong> on a Grid of 15 machines in the month of November, with only <strong>2% failure rate</strong> due to node instability. </p>

<p><strong>NOTE: A single session can execute more than a single test. A failure due to instability applies to the browser not opening up or some other unrelated crash on the Operating System. This does not include failures of tests because the website itself was broken or test flakiness.</strong></p>

<h2>Another Advantage</h2>

<p>Stability isn't the only advantage of using Selenium Grid Extras; one of the most exciting features is the ability to <em>automatically</em> record the video of the running test session. Lets take a look at an example of a test run:</p>

<p><img src="https://dl.dropboxusercontent.com/u/529524/Elemental%20Selenium/Grid%20Extras/video.png" alt="screencap of video recording"></p>

<p>The video recording happens at the OS level and <strong>records not only the browser but also some information about the current node</strong> (shown in the bottom left corner). Recording at the OS level allows us to review a test failure more effectively. Sometimes a test fails without an obvious reason, but after reviewing the video we will discover that a system update or a pop-up blocker is to blame for the test failure.</p>

<p><img src="https://dl.dropboxusercontent.com/u/529524/Elemental%20Selenium/Grid%20Extras/popup.gif" alt="example failure due to pop-up being blocked"></p>

<h2>Outro</h2>

<p>I hope that using Selenium Grid Extras will assist you at your job and save you some of the confusion you might run in from time to time when using Selenium Grid.</p><br>
<hr>
<a href="#top">top</a>
</body></html>
